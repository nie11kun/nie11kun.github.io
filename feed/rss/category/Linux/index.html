<?xml version="1.0" encoding="UTF-8"?>
<rdf:RDF
xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns="http://purl.org/rss/1.0/"
xmlns:dc="http://purl.org/dc/elements/1.1/">
<channel rdf:about="https://blog.niekun.net/feed/rss/category/Linux/">
<title>Marco Nie - Linux</title>
<link>https://blog.niekun.net/category/Linux/</link>
<description></description>
<items>
<rdf:Seq>
<rdf:li resource="https://blog.niekun.net/archives/2621.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2613.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2611.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2572.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2570.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2457.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2454.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2451.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2448.html"/>
<rdf:li resource="https://blog.niekun.net/archives/2321.html"/>
</rdf:Seq>
</items>
</channel>
<item rdf:about="https://blog.niekun.net/archives/2621.html">
<title>systemd 服务加载 env 环境变量</title>
<link>https://blog.niekun.net/archives/2621.html</link>
<dc:date>2022-04-11T11:21:00+08:00</dc:date>
<description>最近在测试中发现，通过 systemd service 启动的 python 脚本无法加载系统 bashrc 内定义的环境变量。需要在 uint 中定义自定义环境变量才能生效。首先建立自定义环境变量文件，如： /etc/env_addon，其中定义需要的环境变量：ENV1=abcd
ENV2=5678然后在 unit 的 service 块中加入 EnvironmentFile 指向建立的环境变量文件：[Unit]
Description=demo
After=network.target nss-lookup.target

[Service]
User=root
EnvironmentFile=/etc/env_addon
ExecStart=/usr/bin/python /path/main.py
Restart=on-failure

[Install]
WantedBy=multi-user.target重新加载并重启服务：sudo systemctl daemon-reload
sudo systemctl restart demo.service如果需要系统的 ~/.bashrc 同时加载这个自定义的环境变量文件，可以在 bashrc 中加入下面内容：set -a; source /etc/env_addon; set +a重新加载环境：source ~/.bashrc参考链接：Using a user's .bashrc in a systemd serviceUsing environment variables in systemd units Environment directive</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2613.html">
<title>修改虚拟交换机 MTU 提高 esxi 虚拟机网络速度</title>
<link>https://blog.niekun.net/archives/2613.html</link>
<dc:date>2022-04-10T12:59:50+08:00</dc:date>
<description>最近发现我的局域网内网下的网速很慢，只有500M左右，达不到 1000M 的速度。我是通过 ipert3 进行测速的。家里的网络是通过 esxi 下安装的 openwrt，ubuntu 等虚拟机控制的，通过 esxi 管理页面可以看到接口都运行在 1000M 全双工模式下，说明网线链接是没有问题的：经过查询发现可以通过修改虚拟交换机的 mtu 值到 9000 来提高网络吞吐量从而加快网速。修改 mtu进入虚拟交换机栏：点击每一个交换机进入设置界面，点击上面的 edit：将 mtu 设置为 9000，并保存配置：虚拟交换机里修改完后，进入 vmkernel NICs 栏：点击 vmk0 进入设置界面，同样的点击 edit 修改其 mtu 为 9000 并保存：以上就完成了整个虚拟环境 mtu 值的修改，再次通过 iperf3 测速，速率能达到 800M。iperf3 使用下面简单介绍使用 iperf3 测试内网传输速率。首先在接收端以下指令运行在服务模式：iperf3 -s然后再发送端执行以下指令启动测速：iperf3 -c xxx.xxx.xxx.xxx -t 30以上指令中将地址替换为接收端 IP 地址，-t 参数可以设置测速时间，单位为秒。参考链接关于 ESXi 虚拟机间拷贝速度慢的问题IPERF: How to test network Speed,Performance,Bandwidth</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2611.html">
<title>esxi 配置自定义 ssl 证书</title>
<link>https://blog.niekun.net/archives/2611.html</link>
<dc:date>2022-04-10T12:39:50+08:00</dc:date>
<description>我家里的主机使用 esxi 管理多个 vm 虚拟机，之前的文章介绍过 esxi 的安装及使用：ESXi 的安装与使用，需要安装的可以参考。通过浏览器访问  vcenter 管理界面默认会强制 https 模式，但是访问端并没有安装 vcenter 管理网页的证书，所以会提示不安全的链接，下面介绍如何在 esxi 上安装自定义域名的 ssl 证书，并在客户机上安装。开启 sshesxi 上的操作是通过 ssh 的方式，所以首先需要打开 esxi 的 ssh 访问权限。访问 esxi 管理界面，在 host 菜单栏，选择 action - sevices - enable ssh：打开 ssh 只对本次开机有效，重启 esxi 后会再次默认关闭。然后就可以通过 ssh 访问 esxi。创建证书首先备份当前证书文件，防止修改错误无法恢复，进入 /etc/vmware/ssl 目录，新建 bak 文件夹，将目录内的 rui.crt, rui.csr, rui.key 文件移动到 bak 文件夹内：cd /etc/vmware/ssl
mkdir bak
mv rui.* bak/然后在 /etc/vmware/ssl 下新建文件 webclient.cnf 编辑文件内容如下：[ req ]

default_bits = 2048

default_keyfile = rui.key

distinguished_name = req_distinguished_name

encrypt_key = no

prompt = no

string_mask = nombstr

req_extensions = v3_req

[ v3_req ]

basicConstraints = CA:FALSE

keyUsage = digitalSignature, keyEncipherment, dataEncipherment

extendedKeyUsage = serverAuth, clientAuth

subjectAltName = DNS:&lt;esxi.domain.name&gt;, DNS:&lt;esxi&gt;, IP:&lt;xxx.xxx.xxx.xxx&gt; 

[ req_distinguished_name ]

countryName = US

stateOrProvinceName = VA

localityName = SomeCity

0.organizationName = WOW

organizationalUnitName = Software

commonName = &lt;esxi.domain.name&gt;

[ alt_names ]

DNS.1 = &lt;esxi.domain.name&gt;

DNS.2 = &lt;esxi&gt;

IP.1 = &lt;xxx.xxx.xxx.xxx&gt;注意，将以上内容中尖括号&lt;&gt;中的内容替换为你实际的域名和IP地址，不需要保留尖括号。文件修改并保存后，执行下面命令创建证书文件：# 创建加密 key，它用来保证证书生效及运行
openssl genrsa -out /etc/vmware/ssl/rui.key 2048

# 创建一个证书注册请求文件，会用到上面创建的配置文件信息并保存到 key 中
openssl req -new -nodes -out /etc/vmware/ssl/rui.csr -keyout /etc/vmware/ssl/rui.key -config /etc/vmware/ssl/webclient.cnf

# 生成证书，使用了 x509 标准格式。其中定义了证书 730 天的有效期，也就是2年，可以根据需要自行更改时间
openssl x509 -req -days 730 -in /etc/vmware/ssl/rui.csr -signkey /etc/vmware/ssl/rui.key -out /etc/vmware/ssl/rui.crt -extensions v3_req -extfile /etc/vmware/ssl/webclient.cnf以上命令执行完成后，就在目录下生成了 rui.key, rui.csr, rui.crt 三个文件。我们只需要将 rui.crt 证书文件复制到客户机上安装，可以通过任何方式复制出来，例如 sftp，winscp 等。esxi 上需要重启系统后新的证书才能生效。注意重启后 ssh 功能可能需要重新打开。客户端安装证书在 macOS 上安装证书，双击复制出来的 rui.crt 安装即可。安装后需要设置为信任，进入 keychain access 中，在 system 栏点击 certificates 菜单项就能找到刚刚安装的证书，双击证书进入属性，点击 trust 菜单，将 when using this certificate 设置为 always trust 即可，关闭时会提示输入密码。此时我们就可以以 https 访问 esxi web 管理页面并且不会报证书错误了。参考链接How to Replace Your Default ESXi SSL Certificate With a Self-Signed Certificate</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2572.html">
<title>openwrt 修改进程 Socket 句柄数</title>
<link>https://blog.niekun.net/archives/2572.html</link>
<dc:date>2022-04-03T08:50:00+08:00</dc:date>
<description>最近在使用中发现一个软件 log 中出现大量的报错：/core/transport/internet/tcp: failed to accepted raw connections &gt; accept tcp [::]:18919: accept4: too many open files查询后知道这是进程占用的句柄数超出了系统最大值导致的。由于我的系统是 openwrt 所以下面介绍如何修改某个进程的最大句柄数限制。首先查询当前系统当前的句柄限制值：ulimit -n

1024也可以查询当前系统的其他所有限制参数：ulimit -a返回 1024 表示当前系统每个进程的限制值是 1024。然后我们查询下当前系统进程中占用情况：lsof -n |awk '{print $2}'|sort|uniq -c |sort -nr|more

     8790 2390
     41 2638
     27 1914
     26 1
     25 2127
     23 2166
     23 1976
     23 1704可以看到进程PID号 2390 就占用了 8790 个句柄，这肯定超出了系统限制，我们看看这个 2390 到底是那个程序：ps | grep 2390

 2390 root     5005m S    /usr/bin/v2ray -confdir /etc/v2ray/conf.d
 6815 root      1072 R    grep 2390发现的确是我报错的那个程序占用了这个进程。然后我们查询系统可以设置的最大句柄数：cat /proc/sys/fs/file-max

101238返回值说明当前系统可以设置最大句柄数为 101238.想要修改句柄数需要在对应进程的 procd init script 脚本修改内容，在 start_service 中增加：        procd_set_param limits core=&quot;unlimited&quot;
        procd_set_param limits nofile=&quot;101200&quot;
        procd_set_param limits nproc=&quot;101200&quot;limits 参数可以设置系统的一些限制值，openwrt 可用的限制值名称可以在官方文档找到：https://openwrt.org/docs/guide-developer/procd-init-scripts#service_parameters以上就将系统限制设置为一个较大的值，修改完成后重启这个进程即可。参考链接Linux命令：TCP连接高并发时Socket句柄数的修改procd-init-scripts#service_parametersprocd-init-script-example#advanced_optionsopenwrt procd init script 自启动脚本服务</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2570.html">
<title>iptables 配置透明代理注意事项</title>
<link>https://blog.niekun.net/archives/2570.html</link>
<dc:date>2022-04-03T08:33:00+08:00</dc:date>
<description>之前介绍过通过 dnsmasq 配合 iptables 实现对 ip 地址的流量过滤，dnsmasq 获取到流量后标记 ipset 然后通过 iptables 识别 ipset 然后将流量送往指定地址。通过 dnsmasq ipset 和 iptables 对域名流量的控制iptables 使用教程这里面存在一个问题就是流量回环问题，如果处理不好回导致 iptables 规则无限循环，尤其是在配置透明代理时候。iptables -t mangle -A PREROUTING -p tcp -m set --match-set gfwlist dst -j TPROXY --on-port 1081 --tproxy-mark 1
iptables -t mangle -A PREROUTING -p udp -m set --match-set gfwlist dst -j TPROXY --on-port 1081 --tproxy-mark 1
iptables -t mangle -A OUTPUT -p tcp -m set --match-set gfwlist dst -j MARK --set-mark 1
iptables -t mangle -A OUTPUT -p udp -m set --match-set gfwlist dst -j MARK --set-mark 1以上规则会将 指定 list 的流量发送到指定端口并打上 mark 标记，但是从目标地址返回数据后，数据流会再次匹配到以上规则导致再次将流量送往指定端口，导致无限循环。处理方法就是在目标地址获取到流量后，给流量打上 mark 标记，然后在 iptables 的最前面加上一条规则识别从目标地址返回的流量，直接 return 流量即可。例如目标地址处理后的流量标记为 mark 2，iptables 规则最前面增加一条规则：iptables -t mangle -I OUTPUT -j RETURN -m mark --mark 0x02-I 参数就是将规则放在在路由链的最前面。如果是通过脚本的方式配置 iptables，将开始的脚本内容修改如下即可：iptables -t mangle -A OUTPUT -j RETURN -m mark --mark 0x02

iptables -t mangle -A PREROUTING -p tcp -m set --match-set gfwlist dst -j TPROXY --on-port 1081 --tproxy-mark 1
iptables -t mangle -A PREROUTING -p udp -m set --match-set gfwlist dst -j TPROXY --on-port 1081 --tproxy-mark 1
iptables -t mangle -A OUTPUT -p tcp -m set --match-set gfwlist dst -j MARK --set-mark 1
iptables -t mangle -A OUTPUT -p udp -m set --match-set gfwlist dst -j MARK --set-mark 1这样就可以避免流量回环问题。</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2457.html">
<title>安装 phpMyAdmin 管理 MySQL</title>
<link>https://blog.niekun.net/archives/2457.html</link>
<dc:date>2022-03-28T09:31:00+08:00</dc:date>
<description>phpMyAdmin 是一个 php 的免费工具，用来在 web 端管理 MySQL 数据库。它支持大部分的 MySQL 功能，比如：创建数据库，修改数据，管理用户权限，导入导出数据等。官方网站：https://www.phpmyadmin.net/GitHub 主页：https://github.com/phpmyadmin/phpmyadmin下面介绍在 Ubuntu 20.04 的安装及使用过程。安装首先确保已经安装好了 MySQL 和 php：apt install mysql-server php php-fpm php-mysql
然后安装 phpMyAdmin：apt install phpmyadmin
安装过程中会提示创建一个 mysql 管理账户 phpmyadmin，一般直接确认即可，然后设置账户密码。如果这一步跳过了创建账户，后期需要手动修改配置文件或手动创建一个 phpmyadmin 管理账户，否则登录可能会报错。配置 nginx安装完成后需要配置代理服务器，我使用的是 nginx，下面是 nginx 的配置文件部分：    location /phpmyadmin {
        root /usr/share/;
        index index.php index.html index.htm;
        location ~ ^/phpmyadmin/(.+\.php)$ {
            fastcgi_pass unix:/run/php/php7.4-fpm.sock;
            include fastcgi-php.conf;
        }
    }使用配置完成后就可以登陆 phpmyadmin 页面了，登录对应的 mysql 管理账户，可以是安装 phpmyadmin 时创建的账户也可以是我们之前使用 mysql 自己的账户：如果登录后发现下面有报错信息：Access denied for user 'phpmyadmin'@'localhost' (using password: NO)
可能就是安装的时候跳过了创建 phpmyadmin MySQL 账户的步骤，这里我们可以在终端手动创建报错信息中提示的用户名或者直接修改配置文件中定义的 phpmyadmin 管理账户。修改 /etc/phpmyadmin/config.inc.php，找到如下字段：$cfg['Servers'][$i]['controluser'] = 'user';
$cfg['Servers'][$i]['controlpass'] = 'password';将上面的用户名密码修改为 MySQL 中存在的账户即可。刷新页面之后应该就没有报错了。手动创建 MySQL 用户可以参考教程：https://blog.niekun.net/archives/23.html#title-3然后我们就可以正常使用 phpmyadmin 管理页面了，这里可以查看 database，导入导出数据等。参考链接phpMyAdmin ERROR: mysqli_real_connect(): (HY000/1045): Access denied for user 'pma'@'localhost' (using password: NO)</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2454.html">
<title>使用 rclone 管理网盘文件</title>
<link>https://blog.niekun.net/archives/2454.html</link>
<dc:date>2022-03-14T11:35:31+08:00</dc:date>
<description>之前介绍了通过 gdrive 在服务器上管理 Google drive 文件，实现服务器数据备份自动上传功能。最近发现有一个新的开源项目 rclone 支持更多的网盘，同时更新迭代速度也更快。GitHub 主页：https://github.com/rclone/rclone他支持的网盘列表：https://rclone.org/overview/下面介绍它的安装使用方法。安装Linux 下一键安装命令：curl https://rclone.org/install.sh | sudo bash
macos 通过 brew 安装：brew install rclone
配置首次运行执行初始化配置：rclone config
根据提示创建新 remote：No remotes found - make a new one
n) New remote
r) Rename remote
c) Copy remote
s) Set configuration password
q) Quit config
n/r/c/s/q&gt; n然后设置此连接名称，后续就是通过这个名称来操作不同的网盘的：name&gt; remote
下一步选择网盘类型，如果是 Google drive 选择 16：Type of storage to configure.
Choose a number from below, or type in your own value
[snip]
16 / Google Drive
   \ &quot;drive&quot;
[snip]
Storage&gt; 16下面的 id 和 secret 都默认回车即可：Google Application Client Id - leave blank normally.
client_id&gt;
Google Application Client Secret - leave blank normally.
client_secret&gt;下面设置可访问全部网盘文件，选择 1：Scope that rclone should use when requesting access from drive.
Choose a number from below, or type in your own value
 1 / Full access all files, excluding Application Data Folder.
   \ &quot;drive&quot;
 2 / Read-only access to file metadata and file contents.
   \ &quot;drive.readonly&quot;
   / Access to files created by rclone only.
 3 | These are visible in the drive website.
   | File authorization is revoked when the user deauthorizes the app.
   \ &quot;drive.file&quot;
   / Allows read and write access to the Application Data folder.
 4 | This is not visible in the drive website.
   \ &quot;drive.appfolder&quot;
   / Allows read-only access to file metadata but
 5 | does not allow any access to read or download file content.
   \ &quot;drive.metadata.readonly&quot;
scope&gt; 1下面几步都默认回车即可。注意到了 use auto config 的时候要选择 No，因为我们是远程 ssh 访问的服务器：Use auto config?
 * Say Y if not sure
 * Say N if you are working on a remote or headless machine or Y didn't work
y) Yes
n) No
y/n&gt; n下面会返回一个链接，复制链接到浏览器后，登录 google 账户给 rclone 授权。授权完成后会返回一个字符串码，粘贴回终端。后续几步默认回车即可，最后输入 q 退出 config。使用配置完成后我们就可以使用了，下面介绍一些基本语法。下面示例中网盘配置名称为 remote。列出网盘的所有文件：rclone ls remote:
列出一个文件夹内的所有文件：rclone ls remote:abc
创建一个文件夹：rclone mkdir remote:abc
rclone mkdir remote:abc/def
删除网盘内一个文件：rclone delete remote:abc/123.txt
删除一个文件夹：rclone rmdir remote:abc
复制本地一个文件到网盘：rclone copy 123.txt remote:abc
更多可用命令可以参考官方文档：https://rclone.org/docs/#subcommands</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2451.html">
<title>Ubuntu 18.04 升级 Ubuntu 20.04 记录</title>
<link>https://blog.niekun.net/archives/2451.html</link>
<dc:date>2022-03-12T15:32:00+08:00</dc:date>
<description>昨天决定把服务器的系统从 Ubuntu 18.04 升级到 Ubuntu 20.04，其中经历了不少问题点，下面记录下处理过程。首先就是升级当前系统所有包到最新：apt update &amp;&amp; apt upgrade -y
apt autoremove &amp;&amp; apt purge
然后安装升级需要的管理包，不过一般系统都是自带的：apt install update-manager-core
然后就可以更新系统了：do-release-upgrade
标准流程就是以上几步，但是在最后一步的时候问题就开始出现了。在执行升级命令后出现报警：Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
在查询一些资料后，原来是 ssl certificates 验证问题，系统无法鉴定上面的 https 链接证书是否有效就返回错误了。这个问题也是我这个系统的一个遗留问题，每次执行 wget 或 curl 下载东西的时候就会提示证书报错，需要通过附加指令跳过证书验证，但这就会存在安全问题了。解决方法就是更新本地证书库后添加 SSL_CERT_DIR 环境变量指向系统证书目录：update-ca-certificates --verbose --fresh
export SSL_CERT_DIR=/etc/ssl/certs
为了方便以后使用，将环境变量添加到 ~/.bashrc 文件中。这样就解决了 https 链接证书验证问题。然后先删除之前执行升级命令后错误内容：rm /var/lib/ubuntu-release-upgrader/release-upgrade-available
/usr/lib/ubuntu-release-upgrader/release-upgrade-motd
之后再次执行升级命令 do-release-upgrade。这时候报错信息变化了，这时候提示的是 python3 有问题，原因是我当前系统使用的是自己编译的 python 3.8，路径在 /opt 目录下。当时将系统软链接 /usr/bin/python 和 /usr/bin/python3 都指向了自己安装的 python，需要将他们恢复到指向系统内置的 python 程序。下面需要介绍下系统内 python 主程序和软链接的分布：python2 主应用程序为 /usr/bin/python2.7
python3 主应用程序为 /usr/bin/python3.6
pip 主程序为 /usr/bin/pip
pip3 主程序为 /usr/bin/pip3下面是默认的软链接及指向的应用程序：/usr/bin/python  -&gt;  /usr/bin/python2.7
/usr/bin/python2  -&gt;  /usr/bin/python2.7
/usr/bin/python3  -&gt;  /usr/bin/python3.6
/usr/local/bin/pip  -&gt;  /usr/bin/pip
/usr/local/bin/pip3  -&gt;  /usr/bin/pip3如果你修改过这些软链接到自己的 python 版本，就需要修改回来：ln -sf /usr/bin/python2.7 /usr/bin/python
ln -sf /usr/bin/python2.7 /usr/bin/python2
ln -sf /usr/bin/python3.6 /usr/bin/python3
ln -sf /usr/bin/pip /usr/local/bin/pip
ln -sf /usr/bin/pip3 /usr/local/bin/pip3
ldconfig以上问题都处理完后，再次执行升级命令，一切都正常了。</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2448.html">
<title>解决 wget 下载时 certificates 证书报错问题</title>
<link>https://blog.niekun.net/archives/2448.html</link>
<dc:date>2022-03-11T16:48:00+08:00</dc:date>
<description>我的服务器上在使用 wget 或者 curl 等网络工具时，每次都提示类似下面的报错：ERROR: cannot verify github.com's certificate, issued by ‘CN=DigiCert High Assurance TLS Hybrid ECC SHA256 2020 CA1,O=DigiCert\\, Inc.,C=US’:
  Unable to locally verify the issuer's authority.
To connect to github.com insecurely, use `--no-check-certificate'.需要通过参数跳过证书检查，但是这样又有了安全风险。首先尝试更新本地证书文件：update-ca-certificates --verbose --fresh发现问题没有解决，原来是系统缺少了一个指向证书路径 /etc/ssl/certs 的环境变量，尝试添加：export SSL_CERT_DIR=/etc/ssl/certs再次测试 wget 命令，发现问题的确没有了。可以将上面的环境变量添加到系统 shell 配置文件中，我这里是 ~/.bashrc，添加后刷新一下即可：source ~/.bashrc在更新 Ubuntu18.04 到 20.04 时，也是这个问题导致的报错。</description>
</item>
<item rdf:about="https://blog.niekun.net/archives/2321.html">
<title>openwrt 扩展根目录空间</title>
<link>https://blog.niekun.net/archives/2321.html</link>
<dc:date>2021-06-22T21:40:00+08:00</dc:date>
<description>我在软路由上通过 esxi 安装了 openwrt 作为路由系统。虚拟机分配了 5 GB 作为存储空间，但是安装完成后通过命令查看发现系统识别到的空间只有很小：root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
/dev/root               252.0M    241.4M      5.5M  98% /rom
tmpfs                   496.5M     68.0K    496.4M   0% /tmp
/dev/sda1                15.7M      3.8M     11.6M  25% /boot
/dev/sda1                15.7M      3.8M     11.6M  25% /boot
tmpfs                   512.0K         0    512.0K   0% /dev其中 /dev/root 是系统固件目录，不用考虑。/dev/sda* 就是系统实际可用的硬盘空间。我明明分配了 5 GB 空间给 openwrt 但是由于系统分区是在下载的固件中定义好的，所以其余空间就没有被识别。由于默认存储空间过小，当安装了过多的插件后，会提示空间不足导致无法安装更多插件：verify_pkg_installable: Only have 0kb available on filesystem /overlay, pkg luci-app-openvpn needs 9
opkg_install_cmd: Cannot install package luci-app-openvpn下面介绍如何将剩余空间挂在到 openwrt 中。首先安装需要的插件，注意顺序不能错：opkg update
opkg install block-mount e2fsprogs
opkg update
opkg install fdisk blkid然后配置存储空间，注意 fdisk 指令后的几个选项：fdisk -l

fdisk /dev/sda
m
n
p
&lt;默认,回车&gt; //–&gt;分区号为3
&lt;默认,回车&gt;
&lt;默认,回车&gt;
w

reboot重启后，格式化刚才建立的分区：mkfs.ext4 /dev/sda3
reboot重启后配置 fstab：uci add fstab mount

# 将下面第一行命令输出的 UUID 替换第二行命令后的 UUID
blkid -s UUID /dev/sda3 | cut -d\&quot; -f2
uci set fstab.@mount[-1].uuid=UUID

uci set fstab.@mount[-1].options=rw,sync,noatime
uci set fstab.@mount[-1].fstype=ext4
uci set fstab.@mount[-1].enabled_fsck=1
uci set fstab.@mount[-1].enabled=1
uci set fstab.@mount[-1].target=/
uci set fstab.@mount[-1].device=/dev/sda3
uci commit fstab然后根目录复制到新的分区下：mkdir /mnt/sda3
mount /dev/sda3 /mnt/sda3
mkdir -p /tmp/cproot
mount --bind / /tmp/cproot
tar -C /tmp/cproot -cvf - . | tar -C /mnt/sda3 -xf -

umount /tmp/cproot
umount /mnt/sda3然后启用引导：/etc/init.d/fstab enable
/etc/init.d/fstab start

reboot重启后再次查看系统分区信息：root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
/dev/root               252.0M    241.4M      5.5M  98% /rom
tmpfs                   496.5M      1.0M    495.5M   0% /tmp
/dev/sda3                 4.6G    257.2M      4.1G   6% /
/dev/sda1                15.7M      3.8M     11.6M  25% /boot
/dev/sda1                15.7M      3.8M     11.6M  25% /boot
tmpfs                   512.0K         0    512.0K   0% /dev可以看到 sda3 分区已经正常挂载了，后续可以继续安装需要的各种插件了。参考链接Vmware下openwrt虚拟机扩展根目录大小</description>
</item>
</rdf:RDF>