<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
xmlns:thr="http://purl.org/syndication/thread/1.0"
xml:lang="zh-CN"
xml:base="https://blog.niekun.net/"
>
<title type="text">Marco Nie</title>
<subtitle type="text">you are the company you keep...</subtitle>
<updated>2025-01-17T17:14:00+08:00</updated>
<generator uri="https://typecho.org/" version="1.3.0">Typecho</generator>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/" />
<id>https://blog.niekun.net/feed/atom/</id>
<link rel="self" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" />
<entry>
<title type="html"><![CDATA[honkit 使用教程及部署github page]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/3021.html" />
<id>https://blog.niekun.net/archives/3021.html</id>
<updated>2025-01-17T17:14:00+08:00</updated>
<published>2025-01-17T17:14:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/web/" term="web" />
<summary type="html"><![CDATA[1. 什么是 Honkit？Honkit 是一个现代化的静态书籍生成工具，它是基于旧版 GitBook 开发的，支持 Markdown 文件的编写和多种输出格式，如 HTML 和 PDF。]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/3021.html" xml:lang="zh-CN"><![CDATA[
<h2>1. 什么是 Honkit？</h2><p><strong>Honkit</strong> 是一个现代化的静态书籍生成工具，它是基于旧版 GitBook 开发的，支持 Markdown 文件的编写和多种输出格式，如 HTML 和 PDF。</p><!--more--><h2>2. 初始化 Honkit 项目</h2><h3>2.1 创建 Honkit 项目</h3><ol><li><p><strong>创建项目目录</strong>：</p><pre><code class="lang-bash">mkdir my-honkit-project
cd my-honkit-project</code></pre></li><li><p><strong>初始化 Honkit 项目</strong>：</p><pre><code class="lang-bash">npx honkit init</code></pre><p>这会生成以下两个文件：</p><ul><li><code>README.md</code>：书籍的主页面。</li><li><code>SUMMARY.md</code>：目录结构的定义。</li></ul></li><li><p><strong>安装 Honkit</strong>：</p><pre><code class="lang-bash">npm install honkit --save-dev</code></pre></li></ol><h2>3. 本地构建书籍</h2><h3>3.1 运行开发服务器</h3><p>在项目目录中运行以下命令启动本地预览：</p><pre><code class="lang-bash">npx honkit serve</code></pre><p>默认情况下，书籍会在 <a href="http://localhost:4000">http://localhost:4000</a> 上运行。</p><h3>3.2 生成静态文件</h3><p>当书籍准备好后，运行以下命令生成静态 HTML 文件：</p><pre><code class="lang-bash">npx honkit build</code></pre><p>生成的文件会存储在 <code>_book</code> 目录中。</p><hr><h2>4. 生成 PDF 文件</h2><p>Honkit 支持将书籍生成 PDF 文件，但需要预先安装 <strong>Calibre</strong> 电子书管理软件。</p><h3>4.1 安装 Calibre</h3><ol><li><p><strong>下载 Calibre</strong>：</p><ul><li>访问 Calibre 官网：<a href="https://calibre-ebook.com/download">https://calibre-ebook.com/download</a>。</li><li>下载并安装适合您系统的版本。</li></ul></li><li><p><strong>确保 Calibre 路径正确</strong>：</p><ul><li><p><strong>检查环境变量</strong>：</p><ul><li>通常，Calibre 安装会自动将路径添加到系统的环境变量 <code>PATH</code> 中。</li><li>如果未自动添加，手动将 Calibre 的安装目录路径添加到 <code>PATH</code> 环境变量中。</li></ul></li><li><p>例如，Windows 系统下，路径可能为：</p><pre><code>C:\Program Files\Calibre2</code></pre></li><li><p>Linux 和 macOS 用户可通过以下命令验证：</p><pre><code class="lang-bash">which ebook-convert</code></pre><p>如果返回路径为空，说明需要手动添加。</p></li></ul></li><li><strong>重新打开终端</strong>：<br>添加路径后，确保关闭并重新打开终端。</li></ol><h3>4.2 生成 PDF</h3><p>运行以下命令生成 PDF 文件：</p><pre><code class="lang-bash">npx honkit pdf . output.pdf</code></pre><ul><li><code>.</code> 表示当前目录。</li><li><code>output.pdf</code> 是生成的 PDF 文件名。</li></ul><h2>5. 部署到 GitHub Pages</h2><h3>5.1 创建 GitHub 仓库</h3><ol><li>前往 <a href="https://github.com">GitHub</a> 创建一个新仓库（例如 <code>my-honkit-book</code>）。</li><li><p>将本地项目与远程仓库关联：</p><pre><code class="lang-bash">git init
git remote add origin https://github.com/&lt;username&gt;/my-honkit-book.git
git add .
git commit -m &quot;Initial commit&quot;
git branch -M main
git push -u origin main</code></pre></li></ol><h3>5.2 配置 GitHub Actions 自动部署</h3><ol><li><p><strong>创建 GitHub Actions 配置文件</strong>：<br>在项目的根目录下创建 <code>.github/workflows/deploy.yml</code> 文件，内容如下：</p><pre><code class="lang-yaml">name: Deploy Honkit to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Install Dependencies
      run: npm install

    - name: Build Honkit
      run: npx honkit build

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./_book</code></pre></li><li><p><strong>提交配置文件</strong>：<br>提交并推送配置文件到 GitHub：</p><pre><code class="lang-bash">git add .github/workflows/deploy.yml
git commit -m &quot;Add GitHub Actions for deployment&quot;
git push origin main</code></pre></li><li><p><strong>启用 GitHub Pages</strong>：</p><ul><li>进入仓库的 <strong>Settings</strong> &gt; <strong>Pages</strong>。</li><li>在 <strong>Source</strong> 下选择 <code>gh-pages</code> 分支，点击保存。</li></ul></li></ol><h2>6. 绑定自定义域名</h2><h3>6.1 配置 GitHub Pages</h3><ol><li>进入仓库的 <strong>Settings</strong> &gt; <strong>Pages</strong>。</li><li>在 <strong>Custom domain</strong> 中输入您的自定义域名（例如 <code>www.example.com</code>）。</li><li>点击 <strong>Save</strong>。GitHub 会自动生成一个 <code>CNAME</code> 文件。</li></ol><h3>6.2 配置 DNS 记录</h3><p>登录您的域名注册商控制台，添加以下 DNS 记录：</p><ul><li><p><strong>绑定子域名</strong>（例如 <code>www.example.com</code>）：<br>添加 <strong>CNAME 记录</strong>：</p><pre><code>www  CNAME  &lt;username&gt;.github.io</code></pre></li></ul><blockquote>注意：将 <code>&lt;username&gt;</code> 替换为您的 GitHub 用户名。</blockquote><h3>6.3 启用 HTTPS</h3><ol><li>返回 GitHub 仓库的 <strong>Settings</strong> &gt; <strong>Pages</strong>。</li><li>勾选 <strong>Enforce HTTPS</strong>，以启用 HTTPS 访问。</li></ol><h2>自定义域名每次推送后消失的解决方法</h2><p>当每次推送代码后，自定义域名设置消失，通常是由于 <code>CNAME</code> 文件被覆盖或删除。GitHub Pages 需要根目录的 <code>CNAME</code> 文件来保存自定义域名信息。如果该文件丢失或被覆盖，GitHub 就无法识别您的自定义域名。</p><hr><h2>解决方法</h2><p>手动将 <code>CNAME</code> 文件添加到源码目录</p><ol><li><p><strong>创建 <code>CNAME</code> 文件</strong>：<br>在项目根目录（如 <code>main</code> 分支）下创建一个 <code>CNAME</code> 文件，并在文件中输入您的自定义域名，例如：</p><pre><code>www.example.com</code></pre></li><li><p><strong>提交更改</strong>：<br>提交并推送 <code>CNAME</code> 文件到远程仓库：</p><pre><code class="lang-bash">git add CNAME
git commit -m &quot;Add CNAME file&quot;
git push origin main</code></pre></li><li><strong>验证</strong>：<br>每次部署后，<code>CNAME</code> 文件会自动被包含在 <code>gh-pages</code> 分支中，不会被覆盖。</li></ol><h2>验证步骤</h2><ol><li><p><strong>检查 <code>CNAME</code> 文件</strong>：</p><ul><li>进入 GitHub 仓库的 <code>gh-pages</code> 分支，确认根目录下有 <code>CNAME</code> 文件。</li><li><p>文件内容应为您的自定义域名，例如：</p><pre><code>www.example.com</code></pre></li></ul></li><li><p><strong>检查 GitHub Pages 设置</strong>：</p><ul><li>转到 <strong>Settings &gt; Pages</strong>。</li><li>确认自定义域名已正确显示，并启用 <strong>HTTPS</strong>。</li></ul></li><li><strong>测试访问</strong>：<br>使用您的自定义域名访问页面，确认是否能够正确加载。</li></ol><h2>7. 常见问题及解决方法</h2><h3>问题 1：<code>npx honkit pdf</code> 报错 <code>Command failed: ebook-convert not found</code></h3><p><strong>原因</strong>：  <br>Calibre 未正确安装，或 <code>ebook-convert</code> 工具未添加到系统的 <code>PATH</code> 环境变量中。</p><p><strong>解决方法</strong>：</p><ol><li><p>确保 Calibre 已安装，并重新确认安装路径：</p><ul><li>Windows 默认路径：<code>C:\Program Files\Calibre2</code>。</li><li>macOS/Linux 使用 <code>which ebook-convert</code> 检查路径。</li></ul></li><li><p>手动将 Calibre 的安装路径添加到系统环境变量中：</p><ul><li><p><strong>Windows</strong>：</p><ul><li>打开“环境变量”设置，找到 <code>PATH</code>。</li><li>添加 <code>C:\Program Files\Calibre2</code>。</li></ul></li><li><p><strong>Linux/macOS</strong>：</p><ul><li><p>编辑 <code>~/.bashrc</code> 或 <code>~/.zshrc</code> 文件，添加以下内容：</p><pre><code class="lang-bash">export PATH=&quot;/path/to/calibre:$PATH&quot;</code></pre><p>替换 <code>/path/to/calibre</code> 为 Calibre 的实际路径。</p></li><li>保存后运行 <code>source ~/.bashrc</code> 或 <code>source ~/.zshrc</code> 使更改生效。</li></ul></li></ul></li><li>重新运行 <code>npx honkit pdf</code>。</li></ol><h3>问题 2：GitHub Actions 部署失败，提示 <code>Permission denied</code></h3><p><strong>原因</strong>：  <br>GitHub Actions 无法向 <code>gh-pages</code> 分支推送更改，通常是因为缺少权限。</p><p><strong>解决方法</strong>：</p><ol><li><p>确保 GitHub 仓库的 <strong>Settings</strong> &gt; <strong>Actions</strong> &gt; <strong>General</strong> 中已启用 <strong>Read and write permissions</strong>：</p><ul><li>打开 <strong>Workflow permissions</strong>，选择 <strong>Read and write permissions</strong>。</li><li>勾选 <strong>Allow GitHub Actions to create and approve pull requests</strong>。</li></ul></li><li><p>确认 GitHub Actions 配置文件中使用的是 <code>github_token</code>：</p><pre><code class="lang-yaml">with:
  github_token: ${{ secrets.GITHUB_TOKEN }}</code></pre></li></ol><h3>问题 3：GitHub Pages 部署成功，但自定义域名未生效</h3><p><strong>原因</strong>：  <br>DNS 记录配置错误或未生效。</p><p><strong>解决方法</strong>：</p><ol><li><p>登录域名管理平台，检查 DNS 配置：</p><ul><li>确认 A 记录或 CNAME 记录配置正确。</li><li>等待 DNS 记录生效（可能需要 5-48 小时）。</li></ul></li><li>检查仓库根目录下是否有 <code>CNAME</code> 文件，内容是否正确（应与自定义域名一致）。</li><li><p>验证 DNS 配置是否正确：</p><ul><li>使用 <a href="https://dnschecker.org">DNS Checker</a> 验证域名解析。</li></ul></li><li><p>启用 HTTPS：</p><ul><li>进入 <strong>Settings</strong> &gt; <strong>Pages</strong>，勾选 <strong>Enforce HTTPS</strong>。</li></ul></li></ol><h3>问题 4：生成的书籍内容显示错乱或样式缺失</h3><p><strong>原因</strong>：</p><ul><li>Markdown 文件中格式不正确。</li><li><code>SUMMARY.md</code> 的目录结构未正确链接。</li></ul><p><strong>解决方法</strong>：</p><ol><li>确认 Markdown 文件的格式是否符合规范。</li><li><p>检查 <code>SUMMARY.md</code> 中的链接是否与文件路径一致：</p><pre><code class="lang-markdown">* [章节标题](path/to/file.md)</code></pre></li><li><p>清理并重新构建书籍：</p><pre><code class="lang-bash">npx honkit build</code></pre></li></ol><h3>问题 5：自定义 PDF 样式未生效</h3><p><strong>原因</strong>：  <br>未指定自定义样式文件或样式文件路径错误。</p><p><strong>解决方法</strong>：</p><ol><li>创建一个 CSS 样式文件（如 <code>custom.css</code>），自定义 PDF 的排版样式。</li><li><p>使用以下命令生成 PDF 并指定样式文件：</p><pre><code class="lang-bash">npx honkit pdf --css custom.css . output.pdf</code></pre><h2>8. 支持与反馈</h2></li></ol><p>如果您遇到未列出的问题或有其他疑问，请参考以下支持途径：</p><ul><li><strong>Honkit 官方文档</strong>：<a href="https://honkit.netlify.app">https://honkit.netlify.app</a></li><li><strong>GitHub 仓库</strong>：<a href="https://github.com/honkit/honkit">https://github.com/honkit/honkit</a></li><li><strong>社区支持</strong>：搜索相关问题或发帖提问。</li></ul><p>完成这些步骤后，您可以成功使用 Honkit 创建、部署和管理文档，解决常见问题，并生成符合您需求的 HTML 和 PDF 文档！</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/3021.html#comments" thr:count="2" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/3021.html" thr:count="2"/>
</entry>
<entry>
<title type="html"><![CDATA[docker compose 配置自动更新]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/docker-compose.html" />
<id>https://blog.niekun.net/archives/docker-compose.html</id>
<updated>2024-08-18T21:42:00+08:00</updated>
<published>2024-08-18T21:42:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Linux/" term="Linux" />
<category scheme="https://blog.niekun.net/category/other/" term="other" />
<summary type="html"><![CDATA[docker compose 配置文件可以很方便的配置和运行 docker 容器，手动更新容器的方法是在 yml 目录下运行以下命令：docker compose pull &amp;amp;&amp;amp;...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/docker-compose.html" xml:lang="zh-CN"><![CDATA[
<p>docker compose 配置文件可以很方便的配置和运行 docker 容器，手动更新容器的方法是在 yml 目录下运行以下命令：</p><pre><code>docker compose pull &amp;&amp; docker compose up -d
</code></pre><p>可以通过在 compose 文件中设置 watchtower 来定期自动拉取最新镜像并启动容器，同时可以配置删除旧镜像和容器。</p><!--more--><p>在 docker-compose.yml 文件中增加以下内容：</p><pre><code>version: '3'
services:

  ...

  watchtower:
    image: containrrr/watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: --interval 3600 --cleanup --remove-volumes
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_REMOVE_VOLUMES=true</code></pre><p><strong>以下是主要的配置说明：</strong></p><ul><li>将 <code>--interval</code> 参数设置为 3600。这意味着 Watchtower 将每 3600 秒（即每小时）检查一次更新。</li><li><code>--cleanup</code> 和 <code>WATCHTOWER_CLEANUP=true</code> 确保在更新后清理旧的镜像。</li><li><code>--remove-volumes</code> 和 <code>WATCHTOWER_REMOVE_VOLUMES=true</code> 确保删除与旧容器关联的匿名卷。</li></ul><p>使用这个配置，Watchtower 将：</p><ul><li>每小时检查一次你的容器是否有更新</li><li>如果发现更新，它会停止旧容器，启动新容器</li><li>删除旧的容器和相关的匿名卷</li><li>删除旧的镜像</li></ul><p>这个配置应该能满足大多数用例的需求，既能保持你的容器相对最新，又不会过于频繁地进行检查和更新操作。</p><p>需要注意的是:</p><ul><li>Watchtower 只会删除它更新的容器的旧版本。它不会删除系统中的其他未使用的容器或镜像。</li><li>它只删除匿名卷,不会删除命名卷。</li><li>如果你想删除所有未使用的镜像(不仅仅是 Watchtower 更新的),你可能需要定期运行 <code>docker image prune</code> 命令。</li></ul>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/docker-compose.html#comments" thr:count="1" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/docker-compose.html" thr:count="1"/>
</entry>
<entry>
<title type="html"><![CDATA[通过浏览器访问服务器指定文件内容]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/3014.html" />
<id>https://blog.niekun.net/archives/3014.html</id>
<updated>2024-08-14T15:58:01+08:00</updated>
<published>2024-08-14T15:58:01+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Linux/" term="Linux" />
<category scheme="https://blog.niekun.net/category/other/" term="other" />
<summary type="html"><![CDATA[通过 nginx 可以反代服务器指定文件，然后就可以在网页中查看文件内容。核心就是通过 alias 关联文件路径。配置文件如下：location /test.log {    alias /ho...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/3014.html" xml:lang="zh-CN"><![CDATA[
<p>通过 <strong>nginx</strong> 可以反代服务器指定文件，然后就可以在网页中查看文件内容。</p><p>核心就是通过 <strong>alias</strong> 关联文件路径。</p><p>配置文件如下：</p><pre><code>location /test.log {
    alias /home/script/igd/app.log;

    default_type text/plain;
    add_header Content-Type &quot;text/plain; charset=utf-8&quot;;
    charset utf-8;

    # 确保不会缓存内容
    add_header Cache-Control &quot;no-cache, no-store, must-revalidate&quot;;
    add_header Pragma &quot;no-cache&quot;;
    add_header Expires &quot;0&quot;;
}</code></pre><p><strong>location</strong> 路径替换为需要的路径。<strong>alias</strong> 设置文件实际路径。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/3014.html#comments" thr:count="1" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/3014.html" thr:count="1"/>
</entry>
<entry>
<title type="html"><![CDATA[将路径加入系统 path]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/path.html" />
<id>https://blog.niekun.net/archives/path.html</id>
<updated>2024-08-10T11:06:00+08:00</updated>
<published>2024-08-10T11:06:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Windows/" term="Windows" />
<category scheme="https://blog.niekun.net/category/macos/" term="macOS" />
<summary type="html"><![CDATA[将路径加入系统 path 可以方便的在终端调用目录中的可执行文件或脚本。windows 和 macOS 设置方法不同，下面分别介绍。windows参考之前的文章：https://blog.nie...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/path.html" xml:lang="zh-CN"><![CDATA[
<p>将路径加入系统 path 可以方便的在终端调用目录中的可执行文件或脚本。windows 和 macOS 设置方法不同，下面分别介绍。</p><h3>windows</h3><p>参考之前的文章：<a href="https://blog.niekun.net/archives/413.html">https://blog.niekun.net/archives/413.html</a></p><h3>macos</h3><p>确定您的 shell 类型。打开终端，运行以下命令：</p><pre><code>echo $SHELL
</code></pre><p>这通常会返回 <strong>/bin/zsh</strong> 或 <strong>/bin/bash</strong>。</p><!--more--><p>根据您的 shell 类型，编辑相应的配置文件：</p><p>对于 Zsh（最新的 macOS 默认使用）：编辑 <strong>~/.zshrc</strong><br>对于 Bash：编辑 <strong>~/.bash_profile</strong> 或 <strong>~/.bashrc</strong></p><p>使用文本编辑器打开相应的文件。例如，对于 zsh：</p><pre><code>vim ~/.zshrc
</code></pre><p>在文件末尾添加以下行（替换为您的实际脚本目录路径）：</p><pre><code>export PATH=&quot;/path/script:$PATH&quot;
</code></pre><p>保存并关闭文件。使更改生效，可以重新加载配置文件或重启终端。要重新加载，运行：</p><pre><code>source ~/.zshrc  # 如果使用 Zsh
source ~/.bash_profile  # 如果使用 Bash
</code></pre><p>验证 PATH 更新：</p><pre><code>echo $PATH
</code></pre><p>您应该能看到您的脚本目录已被添加。现在，您应该能够直接运行脚本，而不需要指定完整路径：</p><pre><code>test.sh
</code></pre><p>注意事项：</p><ul><li>确保您的脚本有正确的执行权限（<code>chmod +x script_name.sh</code>）。</li><li>如果脚本名称与系统命令冲突，考虑重命名脚本或使用唯一前缀</li></ul>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/path.html#comments" thr:count="2" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/path.html" thr:count="2"/>
</entry>
<entry>
<title type="html"><![CDATA[macOS 下使用 automator 给视频文件添加快捷压缩动作]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/macOS-automator.html" />
<id>https://blog.niekun.net/archives/macOS-automator.html</id>
<updated>2024-08-01T14:42:36+08:00</updated>
<published>2024-08-01T14:42:36+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/macos/" term="macOS" />
<summary type="html"><![CDATA[最近学习到了一条可以大幅度压缩视频体积且观感上视频质量没有很大损失的 ffmpeg 命令：ffmpeg -i input.mov -c:v libx264 -crf 30 -r 24 -movf...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/macOS-automator.html" xml:lang="zh-CN"><![CDATA[
<p>最近学习到了一条可以大幅度压缩视频体积且观感上视频质量没有很大损失的 ffmpeg 命令：</p><pre><code>ffmpeg -i input.mov -c:v libx264 -crf 30 -r 24 -movflags faststart -c:a aac -b:a 128k -preset superfast out.mp4
</code></pre><p>但是每次在命令行执行这么复杂的命令还是很不方便的，可以使用 macOS 自带的 automator 自动化工具制作一个简单的右键菜单动作，方便的对视频文件快速压缩。</p><!--more--><p>打开 automator 新建一个 quick action，添加一个 run sheel script:<br><img src="https://blog.niekun.net/usr/uploads/2024/08/2569726420.png" alt="image.png" title="image.png"></p><p>脚本内容如下：</p><pre><code>for f in &quot;$@&quot;
do
    /opt/homebrew/bin/ffmpeg -i &quot;$f&quot; -c:v libx264 -crf 30 -r 24 -movflags faststart -c:a aac -b:a 128k -preset superfast &quot;${f%.*}_compressed.mp4&quot;
done

# 播放声音
afplay /System/Library/Sounds/Blow.aiff

# 显示对话框
osascript -e 'tell app &quot;System Events&quot; to display dialog &quot;视频压缩已完成&quot; with title &quot;通知&quot; buttons {&quot;OK&quot;} default button &quot;OK&quot;'</code></pre><p>保存后，在视频文件右键菜单的 action 栏就可以看到我们添加的动作了：<br><img src="https://blog.niekun.net/usr/uploads/2024/08/3308675429.png" alt="image.png" title="image.png"></p><p>点击执行动作，完成后会有提示信息。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/macOS-automator.html#comments" thr:count="1" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/macOS-automator.html" thr:count="1"/>
</entry>
<entry>
<title type="html"><![CDATA[使用虚拟环境 env 开发 python]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/env-python.html" />
<id>https://blog.niekun.net/archives/env-python.html</id>
<updated>2024-07-01T10:17:13+08:00</updated>
<published>2024-07-01T10:17:13+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[使用虚拟环境进行Python开发有助于隔离项目的依赖，避免不同项目之间的库版本冲突。以下是如何创建和使用虚拟环境的详细步骤。Python 3.3 及以上版本自带 venv 模块，可以直接使用。使...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/env-python.html" xml:lang="zh-CN"><![CDATA[
<p>使用虚拟环境进行Python开发有助于隔离项目的依赖，避免不同项目之间的库版本冲突。以下是如何创建和使用虚拟环境的详细步骤。</p><p><strong>Python 3.3 及以上版本自带 venv 模块，可以直接使用。</strong></p><h3>使用 venv 创建虚拟环境</h3><h4>创建虚拟环境</h4><p>在你的项目目录下，运行以下命令来创建一个虚拟环境，这将在项目目录下创建一个名为 <strong>myenv</strong> 的文件夹，其中包含虚拟环境的所有文件：</p><pre><code>python -m venv myenv
</code></pre><h4>激活虚拟环境</h4><p>Windows：</p><pre><code>myenv\Scripts\activate
</code></pre><p>macOS 和 Linux：</p><pre><code>source myenv/bin/activate
</code></pre><h4>安装依赖</h4><p>在虚拟环境中，你可以使用 pip 来安装项目所需的库：</p><pre><code>pip install requests
</code></pre><p>安装的库将只会影响当前虚拟环境，而不会影响系统的 Python 环境或其他项目。</p><h4>冻结依赖</h4><p>为了确保你的项目依赖可以在其他环境中重现，你可以使用以下命令将当前环境的依赖写入 <strong>requirements.txt</strong> 文件：</p><pre><code>pip freeze &gt; requirements.txt
</code></pre><p>requirements.txt 文件将包含所有当前环境中的安装包及其版本信息。</p><h4>使用 requirements.txt 安装依赖</h4><p>在新的环境中，你可以使用 <strong>requirements.txt</strong> 文件来安装所需的所有依赖：</p><pre><code>pip install -r requirements.txt
</code></pre><h4>退出虚拟环境</h4><p>当你完成工作时，可以通过以下命令退出虚拟环境：</p><pre><code>deactivate
</code></pre><p>使用虚拟环境进行Python开发可以有效地隔离项目依赖，避免版本冲突。通过创建和激活虚拟环境、安装依赖、冻结依赖并在新环境中重新安装依赖，可以确保你的项目在不同环境中具有一致的运行表现。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/env-python.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/env-python.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[服务器装 warp 解锁 chatgpt]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/Linux-warp.html" />
<id>https://blog.niekun.net/archives/Linux-warp.html</id>
<updated>2024-06-27T15:12:00+08:00</updated>
<published>2024-06-27T15:12:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/ubuntu/" term="ubuntu" />
<category scheme="https://blog.niekun.net/category/other/" term="other" />
<summary type="html"><![CDATA[最近在使用 chatgpt 中发现 ios 端无法登录 app，网页端正常使用。提示信息为：Something went wrong. You may be connected to a dis...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/Linux-warp.html" xml:lang="zh-CN"><![CDATA[
<p>最近在使用 chatgpt 中发现 ios 端无法登录 app，网页端正常使用。提示信息为：</p><blockquote>Something went wrong. You may be connected to a disallowed ISP If youare using VPN, try disabling it. Otherwise try a different Wi-Fi network or data connection。</blockquote><p>经过查询发现是我的 vps 服务商只提供网页端 chatgpt 解锁，不支持 app 端。由于 chatgpt 服务也是通过 cloudflare 的 cdn 服务，所以通过将流量转发到 warp 来访问就可以解决问题。</p><p>首先需要在服务端安装官方的 warp 命令行工具：warp-cli。</p><p>官方教程：<a href="https://developers.cloudflare.com/warp-client/get-started/linux/">https://developers.cloudflare.com/warp-client/get-started/linux/</a></p><p>官方手动添加包仓库教程：<a href="https://pkg.cloudflareclient.com/#ubuntu">https://pkg.cloudflareclient.com/#ubuntu</a></p><!--more--><h3>安装</h3><p>在命令行输入以下指令来安装第三方仓库并安装包：</p><pre><code># Add cloudflare gpg key
curl -fsSL https://pkg.cloudflareclient.com/pubkey.gpg | sudo gpg --yes --dearmor --output /usr/share/keyrings/cloudflare-warp-archive-keyring.gpg

# Add this repo to your apt repositories
echo &quot;deb [signed-by=/usr/share/keyrings/cloudflare-warp-archive-keyring.gpg] https://pkg.cloudflareclient.com/ $(lsb_release -cs) main&quot; | sudo tee /etc/apt/sources.list.d/cloudflare-client.list

# Install
sudo apt-get update &amp;&amp; sudo apt-get install cloudflare-warp</code></pre><h3>配置</h3><p>安装好后需要注册一个新账户：</p><pre><code>warp-cli registration new
</code></pre><p>查看当前账户信息：</p><pre><code>warp-cli registration show
</code></pre><p>更换新的 license：</p><pre><code>warp-cli registration license xxxxx-xxxxxx-xxxxxx
</code></pre><p>然后需要设置代理模式，可选有：warp, doh, warp+doh, dot, warp+dot, proxy, tunnel_only。</p><p>我只想要它提供一个 socks5 代理端口即可，所以设置为 proxy 模式，它会在本地 40000 端口监听：</p><pre><code>warp-cli mode proxy
</code></pre><p>启动 warp：</p><pre><code>warp-cli connect
</code></pre><p>此时 warp 会在本地 40000 端口建立一个 sock5 代理，只需要将需要转发的流量转发到此端口即可走 warp。并且 warp 会自动配置为 Always On 模式，开机自动运行代理。</p><p>查看 warp 当前配置：</p><pre><code># warp-cli settings
Merged configuration:
(derived)       Always On: true
(default)       Switch Locked: false
(user set)      Mode: WarpProxy on port 40000
(Not set)       WARP tunnel protocol: Wireguard
(default)       Disabled for Wifi: false
(default)       Disabled for Ethernet: false
(Not set)       Resolve via: cloudflare-dns.com @ [162.159.36.1, 2606:4700:4700::1111]
(Not set)       qlog logging: Disabled
(default)       Onboarding: true
(API defaults)  Exclude mode, with hosts/ips:
  10.0.0.0/8
  100.64.0.0/10
  169.254.0.0/16
  172.16.0.0/12
  192.0.0.0/24
  192.168.0.0/16
  224.0.0.0/24
  240.0.0.0/4
  239.255.255.250/32
  255.255.255.255/32
  fe80::/10
  fd00::/8
  ff01::/16
  ff02::/16
  ff03::/16
  ff04::/16
  ff05::/16
  fc00::/7

(default)       Fallback domains:
  intranet
  internal
  private
  localdomain
  domain
  lan
  home
  host
  corp
  local
  localhost
  home.arpa
  invalid
  test
(Not set)       Daemon Teams Auth: false
(default)       Disable Auto Fallback: false
(Not set)       Allow Updates: true</code></pre><p>查看代理是否生效：</p><pre><code>export ALL_PROXY=socks5://127.0.0.1:40000
curl ifconfig.me</code></pre><h3>代理工具转发流量</h3><p>服务端的配置文件需要添加和修改的地方如下：</p><pre><code>{
    &quot;outbounds&quot;: [
        ...
        {
            &quot;protocol&quot;: &quot;socks&quot;,
            &quot;settings&quot;: {
                &quot;address&quot;: &quot;127.0.0.1&quot;,
                &quot;port&quot;: 40000
            },
            &quot;tag&quot;:&quot;socks_out&quot;
        }
    ],
    &quot;router&quot;: {
        &quot;domainStrategy&quot;: &quot;AsIs&quot;,
        &quot;rule&quot;: [
            ...
            {
                &quot;tag&quot;: &quot;socks_out&quot;,
                &quot;geoDomain&quot;: [
                    {
                        &quot;code&quot;: &quot;openai&quot;,
                        &quot;filePath&quot;: &quot;geosite.dat&quot;
                    }
                ],
                &quot;domainMatcher&quot;: &quot;mph&quot;
            }
        ]
    },
    &quot;inbounds&quot;: [
        {
            &quot;protocol&quot;: &quot;vmess&quot;,
            ...
            &quot;sniffing&quot;: {
                &quot;enabled&quot;: true,
                &quot;destOverride&quot;: [
                    &quot;http&quot;,
                    &quot;tls&quot;
                ]
            },
            ...</code></pre><p>注意需要安装扩展版的 geosite.dat 才有 openai 的条目：<a href="https://github.com/Loyalsoldier/v2ray-rules-dat">https://github.com/Loyalsoldier/v2ray-rules-dat</a></p><p>通过访问以下网址测试是否已经解锁 ios app 端：<a href="https://ios.chat.openai.com/public-api/mobile/server_status/v1">https://ios.chat.openai.com/public-api/mobile/server_status/v1</a></p><p>以上就是解决 chatgpt 无法访问的方法。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/Linux-warp.html#comments" thr:count="1" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/Linux-warp.html" thr:count="1"/>
</entry>
<entry>
<title type="html"><![CDATA[蜗杆基础知识]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2999.html" />
<id>https://blog.niekun.net/archives/2999.html</id>
<updated>2024-06-24T09:51:49+08:00</updated>
<published>2024-06-24T09:51:49+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/other/" term="other" />
<summary type="html"><![CDATA[http://www.qsjsj.com/zhinan/ptyzwgcdfljjgff.htmlhttps://domm.muzing.top/chapter_11#pu-tong-yuan-z...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2999.html" xml:lang="zh-CN"><![CDATA[
<p><a href="http://www.qsjsj.com/zhinan/ptyzwgcdfljjgff.html">http://www.qsjsj.com/zhinan/ptyzwgcdfljjgff.html</a><br><a href="https://domm.muzing.top/chapter_11#pu-tong-yuan-zhu-wo-gan-chuan-dong-de-ji-ben-can-shu-ji-qi-xuan-ze">https://domm.muzing.top/chapter_11#pu-tong-yuan-zhu-wo-gan-chuan-dong-de-ji-ben-can-shu-ji-qi-xuan-ze</a><br><a href="https://m.cadhome.net/news/proejc/716.html">https://m.cadhome.net/news/proejc/716.html</a><br><a href="http://www.qsjsj.com/zhinan/AJMDWGJYHYZWGCSJSGS.html">http://www.qsjsj.com/zhinan/AJMDWGJYHYZWGCSJSGS.html</a><br><a href="http://www.lyfy.net/wheel/ptcwstyle.htm">http://www.lyfy.net/wheel/ptcwstyle.htm</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2999.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/2999.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[屏蔽 quic 流量]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/openwrt-quic.html" />
<id>https://blog.niekun.net/archives/openwrt-quic.html</id>
<updated>2024-06-01T15:53:42+08:00</updated>
<published>2024-06-01T15:53:42+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Linux/" term="Linux" />
<summary type="html"><![CDATA[最近在使用一些服务的时候发现流量没有正确的按照设定的规则走，发现部分网站已经优先支持 quic 也就是 http3 协议了，而这种协议目前一些客户端无法正确解析。解决方法就是将 quic 流量屏...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/openwrt-quic.html" xml:lang="zh-CN"><![CDATA[
<p>最近在使用一些服务的时候发现流量没有正确的按照设定的规则走，发现部分网站已经优先支持 quic 也就是 http3 协议了，而这种协议目前一些客户端无法正确解析。解决方法就是将 quic 流量屏蔽掉，让那些网站强制走 http 或 http2 即可。</p><p>quic 协议走的是 udp 层，一般是 443 或 80 端口。</p><p><strong>openwrt 或其他 linux 系统上使用 nftables 设置规则即可：</strong></p><pre><code>新建路由表
nft add table ip tabletest

# 局域网流量屏蔽
# 局域网流量目标地址是外部地址时传输路径为 prerouting -&gt; forward -&gt; postrouting hooks
nft add chain ip tabletest prerouting { type nat hook prerouting priority 0 \; policy accept \; }
nft add rule ip tabletest prerouting udp dport { 80, 443 } drop

# 本机网关流量屏蔽
# 本机网关流量目标地址时外部地址时传输路径为 本机 -&gt; output -&gt; postrouting hooks
nft add chain ip tabletest output { type nat hook output priority 0 \; policy accept \; }
nft add rule ip tabletest output udp dport { 80, 443 } drop</code></pre><p><strong>在 Chrome 中禁用 HTTP/3：</strong></p><ul><li>打开 Chrome 浏览器</li><li>在地址栏输入 chrome://flags 并按回车。</li><li>在搜索框中输入 quic。</li><li>将 Experimental QUIC protocol 设置为 Disabled。</li><li>重启浏览器。</li></ul><p><strong>在 Firefox 中禁用 HTTP/3：</strong></p><ul><li>打开 Firefox 浏览器。</li><li>在地址栏输入 about:config 并按回车。</li><li>接受风险提示。</li><li>搜索 network.http.http3.enabled。<br>-将其值设置为 false。</li></ul>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/openwrt-quic.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/openwrt-quic.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[修改 pip 为国内源]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/pip.html" />
<id>https://blog.niekun.net/archives/pip.html</id>
<updated>2024-05-30T20:02:55+08:00</updated>
<published>2024-05-30T20:02:55+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Linux/" term="Linux" />
<category scheme="https://blog.niekun.net/category/other/" term="other" />
<summary type="html"><![CDATA[一键替换命令：# 清华源pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple# 阿里源pip conf...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/pip.html" xml:lang="zh-CN"><![CDATA[
<p>一键替换命令：</p><pre><code># 清华源
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

# 阿里源
pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/

# 腾讯源
pip config set global.index-url http://mirrors.cloud.tencent.com/pypi/simple

# 豆瓣源
pip config set global.index-url http://pypi.douban.com/simple/

# 换回默认源
pip config unset global.index-url</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/pip.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/pip.html" thr:count="0"/>
</entry>
</feed>