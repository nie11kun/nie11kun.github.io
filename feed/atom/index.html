<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
xmlns:thr="http://purl.org/syndication/thread/1.0"
xml:lang="zh-CN"
xml:base="https://blog.niekun.net/"
>
<title type="text">Marco Nie</title>
<subtitle type="text">you are the company you keep...</subtitle>
<updated>2024-02-20T15:47:00+08:00</updated>
<generator uri="https://typecho.org/" version="1.3.0">Typecho</generator>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/" />
<id>https://blog.niekun.net/feed/atom/</id>
<link rel="self" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" />
<entry>
<title type="html"><![CDATA[WSA (Windows Subsystem for Android) 的安装及使用]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/WSA-Windows-Subsystem-for-Android.html" />
<id>https://blog.niekun.net/archives/WSA-Windows-Subsystem-for-Android.html</id>
<updated>2024-02-20T15:47:00+08:00</updated>
<published>2024-02-20T15:47:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Windows/" term="Windows" />
<category scheme="https://blog.niekun.net/category/other/" term="other" />
<summary type="html"><![CDATA[之前介绍过 Windows10 安装 wsl 的教程，可以方便的在 Windows 下使用 Ubuntu 系统。今天介绍安装 wsa 用来在 Windows 下使用 Android 系统及安装第...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/WSA-Windows-Subsystem-for-Android.html" xml:lang="zh-CN"><![CDATA[
<p>之前介绍过 Windows10 安装 wsl 的教程，可以方便的在 Windows 下使用 Ubuntu 系统。今天介绍安装 wsa 用来在 Windows 下使用 Android 系统及安装第三方 apk。</p><h3>安装</h3><p>wsa 没有在官方的 store 中提供，这里使用开源的 WSA-Script 很方便的一键安装。</p><p>GitHub 主页：<a href="https://github.com/YT-Advanced/WSA-Script">https://github.com/YT-Advanced/WSA-Script</a></p><p>在 release 页面下载最新打包的版本：<a href="https://github.com/YT-Advanced/WSA-Script/releases/latest">https://github.com/YT-Advanced/WSA-Script/releases/latest</a></p><!--more--><p>我需要使用 google play 框架及 root 权限，所以下载的是框出来的版本：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/557081804.png" alt="image.png" title="image.png"></p><p>下载好解压到一个特定的目录，运行 <code>Run.bat</code>，期间会提示需要管理员权限以及提示收集信息的对话框，点击<strong>确认</strong>即可。</p><p>安装完成后会自动运行 Windows Subsystem For Android™ 应用。</p><h3>设置代理</h3><p>如果需要使用 play 商店，就需要配置代理服务。如果本机有代理工具的话，可以让 wsa 直接调用本机代理。这里需要使用 adb 工具，下载链接：<a href="https://dl.google.com/android/repository/platform-tools-latest-windows.zip">https://dl.google.com/android/repository/platform-tools-latest-windows.zip</a></p><p>解压压缩包，可以看到其中有一个 <code>adb.exe</code>，可以将目录添加到系统 path 以方便在 terminal 调用。</p><p>首先需要设置 wsa 打开开发者模式，进入设置打开选项：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/1039626403.png" alt="image.png" title="image.png"></p><p>默认 wsa 是运行在本地的 <strong>58526</strong> 端口的。</p><p>建立一个 powershell 脚本，如：wsaproxy.ps1，内容如下：</p><pre><code>$WinNetIP=$(Get-NetIPAddress -InterfaceAlias 'vEthernet (WSLCore)' -AddressFamily IPV4) # get android network gateway addr
adb connect 127.0.0.1:58526 # android port
adb shell settings put global http_proxy &quot;$($WinNetIP.IPAddress):1082&quot; # local proxy port</code></pre><p>第一次执行会弹出对话框是否信任外部访问，点击允许即可。</p><p>以上脚本会获取到 wsa 所在网卡的网关地址，然后用 adb 连接到 wsa，最后配置代理，注意脚本里的本地代理端口修改为实际值即可。</p><p>运行脚本即可让 wsa 配置好代理服务。以后只需要执行这个脚本就可以自动设置代理。</p><p>如果需要取消代理运行下面命令即可：</p><pre><code>adb shell settings put global http_proxy :0</code></pre><h3>安装 apk</h3><p>推荐直接在 play 商店安装应用程序，如果需要安装自己下载的第三方 apk，直接使用 adb 工具即可。</p><p>安装命令：</p><pre><code>adb connect 127.0.0.1:58526
adb install xxx.apk</code></pre><h3>文件共享</h3><p>可以配置一个 Windows 主机的路径作为同 wsa 共享目录，这样两边就可以互传文件了。</p><p>打开 Windows Subsystem For Android™ 进入 <strong>advanced settings - experimental feature</strong>，启用 <strong>share user folders</strong> 功能并选择一个本地目录作为共享目录：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/2995143306.png" alt="image.png" title="image.png"></p><p>通过 <strong>system - turnoff</strong> 关闭 wsa，然后点击 <strong>files</strong> 会重新运行 wsa：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/1695157306.png" alt="image.png" title="image.png"></p><p>可以看到有一个 windows 文件夹：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/3450453039.png" alt="image.png" title="image.png"></p><p>这个文件夹就是对应的 windows 共享目录。</p><h3>系统设置</h3><p>默认情况下只有在第一次安装成功后会自动启动 Android 设置界面，并且找不到设置的启动图标在哪里，我们可以在浏览器里直接访问 android settings 地址的方式启动。</p><p>浏览器中输入以下地址并访问：<a href="#">wsa://com.android.settings</a>，会提示是否需要跳转到设置，点击确认即可进入设置：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/969734695.png" alt="image.png" title="image.png"></p><h3>参考链接</h3><p><a href="https://www.tjsky.net/tutorial/391">Windows Android 子系统 WSA 代理设置方法教程</a><br><a href="https://zhuanlan.zhihu.com/p/459444929">WSA (Windows Subsystem for Android) 使用 Windows 上的代理</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/WSA-Windows-Subsystem-for-Android.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/WSA-Windows-Subsystem-for-Android.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[订阅土耳其区 Google One]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/Google-One.html" />
<id>https://blog.niekun.net/archives/Google-One.html</id>
<updated>2024-02-20T15:10:00+08:00</updated>
<published>2024-02-20T15:10:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/other/" term="other" />
<summary type="html"><![CDATA[最近发现我的 google drive 免费空间也用满了，但平时有很多服务比如 Google photos，服务器备份等都需要用到它，所以想付费购买一些空间。目前 google 把订阅都整合到了...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/Google-One.html" xml:lang="zh-CN"><![CDATA[
<p>最近发现我的 google drive 免费空间也用满了，但平时有很多服务比如 Google photos，服务器备份等都需要用到它，所以想付费购买一些空间。目前 google 把订阅都整合到了 google one 中了，而且不在中国提供订阅服务。和 iCloud 类似，目前土区的订阅最便宜，所以就研究了下如何订阅到土区。</p><p>我使用的是 app store 上的订阅，所以依然用到了土区的 apple 账户以及 ios 设备，关于如何建立土区账号以及充值参考：<a href="https://blog.niekun.net/archives/iCloud.html">国区使用土耳其区 iCloud 家庭共享</a>。</p><!--more--><p>Google 账户需要修改到土耳其区，首先进入 <a href="https://payments.google.com/">https://payments.google.com/</a></p><p>点击 settings 可以看到区域信息：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/4207870220.png" alt="image.png" title="image.png"></p><p>这里我已经修改到了土耳其区域了，如果不是的话需要点击区域旁边的按钮修改，会提示让你创建一个新的 profile：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/2178151477.png" alt="image.png" title="image.png"></p><p>根据提示一步步设置即可，重点是选择土耳其：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/1161263503.png" alt="image.png" title="image.png"></p><p>然后根据提示设置一个土耳其地址信息即可，参考地址：</p><pre><code>Osman Kavuncu Cad
Kenarcık Sk. No2
38090
Kayseri</code></pre><p>付款信息可以不写。</p><p>建立完成后我们需要将原来的那个 profile 删掉，避免引起混乱。如果有多个 profile 会在右上角显示切换按钮，我这里已经删除过了所以是空白的：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/1035383301.png" alt="image.png" title="image.png"></p><p>切换到原来的 profile 后下拉到最下面点击删除，需要注意的是删除这个 profile 不会影响账户上的照片文件等信息，但会删除之前的一些购买付款信息：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/2240538614.png" alt="image.png" title="image.png"></p><p>此时账户就完成了转换到土区的操作。</p><p>然后在 ios 设备上用土区账号登陆 app store，注意不是登录 icloud。</p><p>登录后我们打开 google drive 或者 google one app 点击管理存储：<br><img src="https://blog.niekun.net/usr/uploads/2024/02/3794692997.png" alt="image.png" title="image.png"></p><p>就可以看到各种套餐的信息了，都是以土耳其货币里拉为单位的，选择合适的套餐点击购买即可使用账户中的余额订阅。我选择的是 100GB 年付套餐，一年 120里拉，折合 28 人民币，还是不错的。</p><p>注意及时充值土区账户，如果余额不足可能导致订阅失效。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/Google-One.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/Google-One.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[国区使用土耳其区 iCloud 家庭共享]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/iCloud.html" />
<id>https://blog.niekun.net/archives/iCloud.html</id>
<updated>2024-01-23T14:05:09+08:00</updated>
<published>2024-01-23T14:05:09+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/other/" term="other" />
<summary type="html"><![CDATA[最近我订阅的 200G iCloud 空间存满了，升级到 2T 空间需要每月 68 元有点太贵了。之前就知道土耳其区的价格很便宜，可以通过家庭共享的方式给目前的国区账号使用，今天研究了下顺利完成...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/iCloud.html" xml:lang="zh-CN"><![CDATA[
<p>最近我订阅的 200G iCloud 空间存满了，升级到 2T 空间需要每月 68 元有点太贵了。之前就知道土耳其区的价格很便宜，可以通过家庭共享的方式给目前的国区账号使用，今天研究了下顺利完成了 2T iCloud 空间的升级，价格折合人民币 36 左右。</p><h3>要求</h3><ul><li>土耳其区 apple 账号</li><li>银联信用卡</li><li>礼品卡充值土区账号</li></ul><!--more--><h3>注册土区账号</h3><p>登录 <a href="https://www.icloud.com/">https://www.icloud.com/</a> 选择注册账号，国家选择土耳其，注册使用国内手机号即可以及一个没有注册过 apple id 的邮箱：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/499178168.png" alt="image.png" title="image.png"></p><p>登录注册好的土区id：<a href="https://appleid.apple.com/">https://appleid.apple.com/</a></p><p>然后修改付款信息，这里需要着重注意：付款方式设置为空，下面的地址必须填写标准的土耳其地址：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/3448724441.png" alt="image.png" title="image.png"><br><img src="https://blog.niekun.net/usr/uploads/2024/01/2786982541.png" alt="image.png" title="image.png"></p><p>示例地址填写内容：</p><pre><code>Osman Kavuncu Cad（第一行）
Kenarcık Sk. No2（第二行）
38090（第三行）
Kayseri（第四行）
352-3153000（电话）</code></pre><p>如果以上地址填写的不标准，在后续开通 iCloud 订阅的时候会弹窗必须让你填写支付方式：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/4175245467.png" alt="image.png" title="image.png"></p><p>以上就完成了土区 apple 账号的申请。</p><h3>国区账号邀请土区账号进入家庭</h3><p>这一步比较简单，在家庭共享里发送邀请链接，可以直接发送给土区账号的邮箱地址即可，待会儿登录土区 icloud 账号后点击这个邀请链接即可加入国区家庭。</p><h3>购买礼品卡及充值</h3><p>由于土区 apple 付款方式不支持 paypal 或国内 visa 卡等方式，只有购买礼品卡一种途径来充值，我是用的是 oyunfor 网站购买礼品卡。</p><p>登录网站：<a href="https://www.oyunfor.com/">https://www.oyunfor.com/</a>，点击右侧的注册按钮注册新账户，这里可以使用网页翻译到英文方便操作。</p><p>注册账户比较简单，完成后在主页点击 apple 礼品卡购买：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/1333107270.png" alt="image.png" title="image.png"></p><p>选择需要充值的然后添加到购物车：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/2229729151.png" alt="image.png" title="image.png"></p><p>点击右侧的 pay 按钮即可进入支付界面，第一次需要设置收货地址栏：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/3345477566.png" alt="image.png" title="image.png"></p><p>点击支付后进入选择付款方式界面，选择 credit card 右侧选择中间一项：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/4027697809.png" alt="image.png" title="image.png"></p><p>然后输入银联信用卡的信息即可：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/1007026529.png" alt="image.png" title="image.png"></p><p>付款中有可能会弹出一下画面，输入国内的手机号验证一下即可：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/261702235.png" alt="image.png" title="image.png"></p><p>确认付款后会弹出下面画面，<strong>注意不要关闭这个网页</strong>，等待付款完成后它会自动跳转到订单界面：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/3380077649.png" alt="image.png" title="image.png"></p><p>等一会儿购买完成后，网页就会跳转到订单界面，里面有购买的礼品卡兑换码：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/4164286416.png" alt="image.png" title="image.png"></p><p>使用订单里的兑换码就可以再 app store 中进行兑换了。</p><h3>充值卡充值土区账户</h3><p>这一步比较简单，再 app store 中登录土区账户，然后选择使用兑换码充值到账户中即可。</p><h3>登录土区 iCloud 账户</h3><p>找一台 apple 设备然后登录土区 iCloud 账户，如果需要登出当前国区 iCloud 账户，可以选择保留本地的数据。</p><p>登录土区 iCloud 账户后，登录邮箱，点击之前发出来的家庭邀请链接加入家庭即可。</p><p>土区账户现在可以购买 iCloud 订阅，并将其共享给家庭账户了。</p><p>共享完成后就可以重新登陆国区 iCloud 账户，然后选择使用家庭共享的 iCloud 空间，然后退订当前的 iCloud 订阅即可。原来 iCloud 中存储的东西都不会丢失。</p><p>注意退订当前 iCloud 订阅后，可以申请退还上一次自动扣除的钱，申请地址：<a href="https://reportaproblem.apple.com/">https://reportaproblem.apple.com/</a></p><p><strong>以后每个月都会自动扣除土区余额里的钱，注意需要一直保持余额不为0，否则会触发让你绑定支付方式的机制。</strong></p><p>参考教程：<br><a href="https://btsogiwudc.feishu.cn/docx/CgoJdHyWKopl3UxV12GcG3psnjf">国区使用土耳其iCloud服务，手把手保姆级上车教程</a><br><a href="https://btsogiwudc.feishu.cn/docx/CgoJdHyWKopl3UxV12GcG3psnjf">原来的国区号降级iCloud后，会马上退钱么？</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/iCloud.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/iCloud.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[使用 TinyPNG API 批量压缩图片尺寸]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2866.html" />
<id>https://blog.niekun.net/archives/2866.html</id>
<updated>2024-01-17T09:36:22+08:00</updated>
<published>2024-01-17T09:36:22+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/software/" term="software" />
<summary type="html"><![CDATA[TinyPNG 是一个提供图片压缩服务的网站，可以直接在其官方网站上上传并压缩 png 或 jpg 图片，同时它也提供第三方使用的 api。下面介绍使用其 api 开发的 tinifier，可以...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2866.html" xml:lang="zh-CN"><![CDATA[
<p>TinyPNG 是一个提供图片压缩服务的网站，可以直接在其官方网站上上传并压缩 png 或 jpg 图片，同时它也提供第三方使用的 api。下面介绍使用其 api 开发的 tinifier，可以在命令行中将指定文件夹内的所有图片批量压缩。</p><p>TinyPNG 官网：<a href="https://tinypng.com/">https://tinypng.com/</a><br>tinifier 主页：<a href="https://github.com/tarampampam/tinifier">https://github.com/tarampampam/tinifier</a><br>api 申请：<a href="https://tinypng.com/developers">https://tinypng.com/developers</a></p><!--more--><p>首先申请一个自己的 api，每个账户每月有 500 次请求的免费额度。在上面的 api 申请网页中输入邮箱申请即可，打开邮件回复的链接进入个人主页，在 api 栏可以看到或新建 api：<br><img src="https://blog.niekun.net/usr/uploads/2024/01/3174153081.png" alt="2024-01-17T01:00:44.png" title="2024-01-17T01:00:44.png"></p><p>github release 页面下载 tinifier 最新版，注意需要在 cli 命令行中使用。为了方便在 windows 下调用，可以将程序路径加入系统 path 中。linux 可以添加一个软链接到 <strong>/usr/local/bin</strong> 中。</p><p>可用命令：</p><ul><li>compress 压缩指令</li><li>-h 帮助</li><li>-k 指定 api key  也可以使用 <strong>TINYPNG_API_KEY</strong> 环境变量预设，用逗号 <code>,</code> 隔开多个 key</li><li>-e 指定目录中需要压缩的图片类型</li><li>-r 递归搜索指定的目录文件夹的子文件夹</li><li>-t 指定压缩时的线程数</li></ul><p>示例：</p><pre><code># 压缩一个图片
tinifier compress -k 'YOUR-API-KEY-GOES-HERE' ./img.png

#压缩一个目录中的所有 png 图片
tinifier compress -k 'YOUR-API-KEY-GOES-HERE' -e png ./images-directory

# 使用20线程压缩所有 png jpg 格式的图片并循环搜索所有子文件夹
tinifier compress -k 'YOUR-API-KEY-GOES-HERE' -e png -e jpg -e PNG -e JPG -t 20 -r ./some-dir</code></pre><p>以上就是通过 tinyPNG api 批量压缩本地图片的基本用法。实际使用中及大幅度的减小了本地图片磁盘占用量。建议使用时提前设置好 API 的系统环境变量，可以更加方便的使用压缩命令。</p><p>参考：<br><a href="https://blog.niekun.net/archives/2621.html">systemd 服务加载 env 环境变量</a><br><a href="https://blog.niekun.net/archives/1187.html">Windows 环境变量</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2866.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/2866.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[ffmpeg 常用视频格式转换命令]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2861.html" />
<id>https://blog.niekun.net/archives/2861.html</id>
<updated>2023-11-04T13:50:10+08:00</updated>
<published>2023-11-04T13:50:10+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/software/" term="software" />
<summary type="html"><![CDATA[关于 ffmpeg 的详细解释可以看我的文章：FFmpeg 简单用法，下面主要介绍一些常用的视频格式间转换的命令，可以直接使用。ppt 导出的 webm 转 mp4：ffmpeg -fflags...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2861.html" xml:lang="zh-CN"><![CDATA[
<p>关于 ffmpeg 的详细解释可以看我的文章：<a href="https://blog.niekun.net/archives/1752.html#title-5">FFmpeg 简单用法</a>，下面主要介绍一些常用的视频格式间转换的命令，可以直接使用。</p><p>ppt 导出的 webm 转 mp4：</p><pre><code>ffmpeg -fflags +genpts -i in.webm -r 24 out.mp4
</code></pre><p>mpg 转 mp4：</p><pre><code>ffmpeg -i in.mpg -c:v libx264 -c:a aac -crf 20 -preset:v veryslow out.mp4
</code></pre><p>参考链接：<br><a href="https://stackoverflow.com/questions/18123376/webm-to-mp4-conversion-using-ffmpeg">webm to mp4 conversion using ffmpeg</a><br><a href="https://stackoverflow.com/questions/33672960/ffmpeg-convert-mpg-video-to-mp4-without-lose-quality">FFMPEG convert .mpg video to .mp4 without lose quality</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2861.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/2861.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Windows 下虚拟机安装 MacOS]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2860.html" />
<id>https://blog.niekun.net/archives/2860.html</id>
<updated>2023-11-03T09:08:00+08:00</updated>
<published>2023-11-03T09:08:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Windows/" term="Windows" />
<category scheme="https://blog.niekun.net/category/macos/" term="macOS" />
<summary type="html"><![CDATA[经过测试，我的电脑安装好后可以启动，但是每次输入管理员口令就会四国。可能和我的电脑 cpu 不能完美支持 macos 内核有关，下面介绍安装方法。工具：vmware workstationunl...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2860.html" xml:lang="zh-CN"><![CDATA[
<p>经过测试，我的电脑安装好后可以启动，但是每次输入管理员口令就会四国。可能和我的电脑 cpu 不能完美支持 macos 内核有关，下面介绍安装方法。</p><p>工具：</p><ul><li>vmware workstation</li><li><a href="https://github.com/DrDonk/unlocker">unlocker</a></li><li><a href="https://techrechard.com/download-macos-monterey-iso-dmg-and-vmdk/#Download_macOS_Monterey_ISO_file">macos Monterey iso image</a></li></ul><!--more--><h3>环境准备</h3><p>首先需要主板支持虚拟化 VT，需要在 bios 中打开对应选项。注意此项必须配置，否则安装会不成功。</p><p>VMware workstation 默认不支持安装 macos，需要使用第三方工具 unlocker 来开启支持，直接在上方提供的 github 主页下载最新版本即可，运行 windows 文件夹下的 unlock.exe 即可。</p><p>然后下载 macos iso 镜像文件，在我上面提供的网站中下载即可。</p><h3>配置虚拟机</h3><p>按照正常的新建虚拟机的方式新建，添加下载好的系统镜像用来安装，配置好确认后先不要启动虚拟机，先修改对应虚拟机文件夹下的 vmx 文件。</p><p>文本编辑器打开 vmx 文件后，在最后一行添加一句：</p><pre><code>smc.version = 0
</code></pre><p>保存后即可启动虚拟机，进入 recovery 工具后，先格式化硬盘，然后安装系统，提示一步步安装即可。</p><h3>参考链接</h3><p><a href="https://techrechard.com/how-to-install-macos-monterey-on-vmware-on-windows-pc/">How To Install macOS Monterey On Vmware On Windows Pc</a><br><a href="https://zhuanlan.zhihu.com/p/658521465">Windows用VM虚拟机安装MacOS Ventura 13.6系统全流程教程</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2860.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/2860.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Siemens 系统计算精度设置影响程序运行问题]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2858.html" />
<id>https://blog.niekun.net/archives/2858.html</id>
<updated>2023-10-18T17:13:10+08:00</updated>
<published>2023-10-18T17:13:10+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/siemens/" term="siemens" />
<summary type="html"><![CDATA[最近的工作中遇到使用带刀具的轨迹运动中，由于轨迹是通过1000多个离散点构成的，每个点之间距离很短，由于 sinumerik one 系统默认的线性计算精度是每毫米 1000 各单位，导致刀具轨...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2858.html" xml:lang="zh-CN"><![CDATA[
<p>最近的工作中遇到使用带刀具的轨迹运动中，由于轨迹是通过1000多个离散点构成的，每个点之间距离很短，由于 sinumerik one 系统默认的线性计算精度是每毫米 1000 各单位，导致刀具轨迹报错提示可能有碰撞危险。通过提高系统计算精度可以解决此问题。</p><p>相关系统变量：</p><ul><li>通用机床数据 10200 线性位置的计算精度</li><li>通用机床数据 10210 角位置的计算精度</li></ul><p>sinumerik one 及 840D sl 系统以上参数默认值为 1000，828D 系统默认值为 1000000。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2858.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/2858.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[codesys 使用占位符定义界面变量显示格式]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2857.html" />
<id>https://blog.niekun.net/archives/2857.html</id>
<updated>2023-09-22T10:33:32+08:00</updated>
<published>2023-09-22T10:33:32+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/codesys/" term="CODESYS" />
<summary type="html"><![CDATA[在编程中我们会使用各种类型的变量进行逻辑运算，不同类型其默认数据精度取值不一样，比如浮点型变量文本占位符为 %f 默认小数位数 6 位，但实际只想显示 3 位小数，此时就需要将界面变量的占位符进...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2857.html" xml:lang="zh-CN"><![CDATA[
<p>在编程中我们会使用各种类型的变量进行逻辑运算，不同类型其默认数据精度取值不一样，比如浮点型变量文本占位符为 <code>%f</code> 默认小数位数 6 位，但实际只想显示 3 位小数，此时就需要将界面变量的占位符进行设置以满足需求。</p><!--more--><h3>int 整型</h3><p>语法：</p><pre><code>% &lt;标记&gt; &lt;最小显示数字个数&gt; &lt;类型&gt;
</code></pre><ul><li>标记：定义数据显示模式，可选项：<code>-</code> 当定义最小显示数字个数时 居左显示，<code>+</code> 显示数据正负号，<code>0</code> 当定义最小显示数字个数时空缺位显示 0</li><li>最小显示数字个数：定义最少占据几个数字空间，默认数据位数不够时留空</li><li>类型：显示数据类型，如：<code>d</code>十进制, <code>b</code>二进制, <code>o</code>八进制, <code>x</code>十六进制</li></ul><p>示例：</p><pre><code>%-5d：最小显示位数5位，且居左对齐显示，例如数据值为123时：`123  `
%+d：显示数据正负号,例如数据值为123时：`+123`
%05d：最小显示位数5位，且空缺位显示0，例如数据值为234时：`00234`

%08b：显示8位数的二进制模式，例如数据值为255时：`11111111`
%04x：显示4位数的十六进制模式，例如数据值为15时：`000f`</code></pre><h3>float 浮点型</h3><p>语法：</p><pre><code>% &lt;标记&gt; &lt;最小显示数字个数&gt; . &lt;精度&gt; f
</code></pre><ul><li>标记：定义数据显示模式，可选项：<code>-</code> 当定义最小显示数字个数时 居左显示，<code>+</code> 显示数据正负号，<code>0</code> 当定义最小显示数字个数时空缺位显示 0</li><li>最小显示数字个数：定义最少占据几个数字空间，包括小数位，默认数据位数不够时留空，不定义时默认为 <code>%1.6f</code></li><li>精度：小数位的显示精度</li></ul><p>示例：</p><pre><code>%-12.9f：显示12位数字 9位小数，且居左显示
%+6.3f：显示6位数字3位小数，且显示正负号标记
%06.3f：显示6位数字3位小数，且空缺位补0显示</code></pre><h3>参考链接</h3><p><a href="https://content.helpme-codesys.com/en/CODESYS%20Visualization/_visu_placeholder_with_formatting_sequence_in_a_string.html">Placeholders with Format Definition</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2857.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/2857.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[codesys 定义重启可保持型变量]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2840.html" />
<id>https://blog.niekun.net/archives/2840.html</id>
<updated>2023-08-18T14:09:00+08:00</updated>
<published>2023-08-18T14:09:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/codesys/" term="CODESYS" />
<summary type="html"><![CDATA[无论是在 gvl 或者 pou 中都可以定义变量，默认情况下这些变量在系统重启后数据都会丢失。某些情况下我们希望变量值可以保持，系统重启后原数据也不丢失。可以在变量定义块中通过关键词 RETAI...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2840.html" xml:lang="zh-CN"><![CDATA[
<p>无论是在 gvl 或者 pou 中都可以定义变量，默认情况下这些变量在系统重启后数据都会丢失。某些情况下我们希望变量值可以保持，系统重启后原数据也不丢失。可以在变量定义块中通过关键词 <strong>RETAIN</strong> 和 <strong>PERSISTENT</strong> 来实现。</p><p>注意 <strong>PERSISTENT</strong> 类型变量必须定义在单独的 <strong>Persistent Variables</strong> 类型 object 才能生效。而不是通常的 <strong>GVL</strong> object。</p><!--more--><h3>RETAIN</h3><p><strong>RETAIN</strong> 可以在热重启后保持数据：</p><pre><code>In a POU:

VAR RETAIN
 iRem1 : INT;
END_VAR

*******************

In a GVL:

VAR_GLOBAL RETAIN
 gvarRem1 : INT;
END_VAR</code></pre><p>以下情况下 <strong>RETAIN</strong> 数据会被重置：</p><ul><li>the command Reset origin</li><li>the command Reset cold (as opposed to persistent variables)</li><li>a repeated program download</li></ul><h3>PERSISTENT</h3><p>首先需要新建 <strong>Persistent Variables</strong> 类型 object 会放在 task 子目录下：<br><img src="https://blog.niekun.net/usr/uploads/2023/08/1805678026.png" alt="2023-08-24T00:59:33.png" title="2023-08-24T00:59:33.png"></p><p>然后会自动创建 <strong>VAR_GLOBAL PERSISTENT RETAIN</strong> 类型全局变量文件。</p><p><strong>PERSISTENT</strong> 可以在热重启和冷重启后保持数据：</p><pre><code>VAR_GLOBAL PERSISTENT
 iVarPers1 : DINT;
 bVarPers : BOOL;
 PLC_PRG.PERS: INT;
END_VAR</code></pre><p>以下情况下 <strong>PERSISTENT</strong> 数据会被重置：</p><ul><li>the command Reset origin</li></ul><p>从 CODESYS V3.3.0.1 开始声明一个 <code>VAR_GLOBAL PERSISTENT</code> 等效于 <code>VAR_GLOBAL PERSISTENT RETAIN</code> or <code>VAR_GLOBAL RETAIN PERSISTENT</code>。</p><p>以下是各种变量定义模式下数据保持情况：</p><table><thead><tr><th align="center"> </th><th align="center"> </th><th align="center"> </th></tr></thead><tbody><tr><td align="center">after online command</td><td align="center">VAR</td><td align="center">VAR RETAIN</td><td>VAR PERSISTENT</td></tr><tr><td align="center">Reset warm</td><td align="center"> </td><td align="center">x</td><td>x</td></tr><tr><td align="center">Cold reset</td><td align="center"> </td><td align="center"> </td><td>x</td></tr><tr><td align="center">Reset origin</td><td align="center"> </td><td align="center"> </td></tr><tr><td align="center">Download</td><td align="center"> </td><td align="center"> </td><td>x</td></tr><tr><td align="center">Online Change</td><td align="center">x</td><td align="center">x</td><td>x</td></tr></tbody></table><h3>参考链接</h3><p><a href="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_cds_vartypes_retain_persistent/#retain-variables">Remanent Variables - RETAIN, PERSISTENT</a><br><a href="https://community.parker.com/technologies/electromechanical-group/electromechanical---industrial/w/electromechanical-knowledge-base/1561/remanent-variables-retain-vs-persistent-retain">REMANENT VARIABLES: RETAIN VS PERSISTENT RETAIN</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2840.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/2840.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[codesys 中使用 DIN 66025 标准编写 CNC 程序]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2835.html" />
<id>https://blog.niekun.net/archives/2835.html</id>
<updated>2023-08-16T15:33:00+08:00</updated>
<published>2023-08-16T15:33:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/codesys/" term="CODESYS" />
<summary type="html"><![CDATA[下面介绍 DIN 66025 标准下编写 codesys CNC 程序的一些基本规则。结构基本格式如下：% MyProgramN10 G01 X100 Y100 F100  (comment)N...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2835.html" xml:lang="zh-CN"><![CDATA[
<p>下面介绍 DIN 66025 标准下编写 codesys CNC 程序的一些基本规则。</p><h3>结构</h3><p>基本格式如下：</p><pre><code>% MyProgram
N10 G01 X100 Y100 F100  (comment)
N20 M8 G01 Z40 F20
N30 G03 X-100 R200 F100
N40 SubPrg{5}</code></pre><!--more--><p>规则：</p><ul><li>以 % 标记程序头名称，也可以不写</li><li>每行代码都是一个 block，每个 block 都需要以 block number 开头，如：<code>N10</code></li><li>一行只能定义一个 G 代码，G90  G01 需要单独两行写</li><li>M 代码可以和 G 代码一行</li><li>小括号 <code>()</code> 中可以定义注释</li><li>子程序传递参数用大括号 <code>{}</code> 定义</li></ul><p>可用 G代码可以查询：<a href="https://content.helpme-codesys.com/en/CODESYS%20SoftMotion/_sm_cnc_din66025_basics.html">DIN 66025 Fundamentals</a></p><h3>暂停</h3><p>语法：</p><pre><code>N10 G4 T5  (停留5秒)</code></pre><h3>M 功能</h3><p>当 cnc 程序中编写一个 M 功能时，如 M8，在 <code>SMC_Interpolator</code> 功能块中的 <code>wM</code> 会输出调用的 M 功能编号 8，同时会在此功能块等待输入确认信号 <code>bAcknM</code> 为 <strong>true</strong> 并且清空 <code>wM</code> 信号，在此期间插补器会停留在原地等待。</p><p>如果需要在执行 M 功能的时候不中断当前正在进行的插补器动作，需要设置并执行 <code>SMC_PreAcknowledgeM</code> 功能块。但是如果M功能有传递参数 K L 等则不可激活此预完成功能，否则传递参数POU接收不到。</p><p>注意 M 功能编号中 <strong>65533–65535</strong> 是内部保留的，其他都是可以自定义的,包括 <code>M30</code>。</p><p>如要执行下面 cnc 程序：</p><pre><code>N15 G1 X10 F100
N20 M8
N21 G1 X50 F100
N30 M30</code></pre><p>POU 代码加入如下:</p><pre><code>VAR
    fbIpo       : SMC_Interpolator;   //插补器功能块
    fbPreAckM     : SM3_CNC.SMC_PreAcknowledgeMFunction;  //M 功能预完成功能  可不中断插补器动作  如果M功能有传递参数 则不可激活此功能
END_VAR

***************************************

IF fbIpo.wM = 30 THEN
    fbIpo(bAcknM:=TRUE);   //执行玩动作后触发完成信号
END_IF

fbPreAckM(bEnable:=TRUE,iM:=8,poqDataIn:=fbCheckVel.poqDataOut);  //激活指定M功能预完成  如果M功能有传递参数 则不可激活此功能
IF fbIpo.wM = 8 THEN
    gVars.lrR3 := 5;       //M功能需要执行的动作
    fbIpo(bAcknM:=TRUE);   //执行玩动作后触发完成信号
END_IF</code></pre><p>可以在 CNC 程序调用 M 功能时定义传递参数，供POU使用，使用关键词 <code>K</code> <code>L</code> 即可。同时需要定义 <code>SMC_GetMParameters</code> 功能块获取到参数值，这里需要注意此功能块必须和 <code>SMC_Interpolator</code> 处于同一周期中，否则可能读取失败，建议同  <code>SMC_Interpolator</code> 定义在一个 POU 中。</p><p>带传递参数的 M 功能 CNC 程序示例如下：</p><pre><code>N20 M8 K7</code></pre><p>以上示例 POU 修改如下：</p><pre><code>VAR
    fbIpo          : SMC_Interpolator;   //插补器功能块
    //fbPreAckM    : SMC_PreAcknowledgeMFunction; //屏蔽

    fbGetMPara    : SMC_GetMParameters;
END_VAR

***************************************

//fbPreAckM(bEnable:=TRUE,iM:=8,poqDataIn:=fbCheckVel.poqDataOut);  //屏蔽
IF fbIpo.wM = 8 THEN
    gVars.lrR3 := fbGetMPara.dK;;    //读取到 K 传递参数的数据
    fbIpo(bAcknM:=TRUE);             //执行玩动作后触发完成信号
END_IF

fbGetMPara(Interpolator:=fbIpo,bEnable:=TRUE);</code></pre><h3>跳转</h3><p>有两种跳转方法，第一种是引用行号来跳转，可以定义从某一个程序段跳转到另一个程序段以及跳转的循环次数。第二种是通过自定义标记位来跳转，可以不用管行号，缺点是只能向后跳转以及不可循环跳转。</p><p><strong>行号跳转语法：</strong></p><pre><code>G20 L K</code></pre><p><code>L</code> 定义需要跳转到的指定行号，<code>K</code> 定义跳转循环次数，当为 0 时停止跳转。当不写 <code>K</code> 时系统会模式使用内部变量计数。此功能需要配合赋值命令 <code>G36</code> <code>G37</code> 使用。</p><p>使用内部变量计数示例：</p><pre><code>N00 G36 D5              (设置内部变量初始为5 变量值为0时跳转关闭)
N10 G91                 (增量模式)
N20 G01 X10 Y10 F100    (每个循环移动的距离)
N30 G37 D-1             (给内部变量值减1)
N40 G20 L20             (内部变量值没到0时返回继续循环 N20)</code></pre><p>使用自定义变量计数的示例：</p><pre><code>N00 G36 O$R1$ D5        (设置变量R1初始为5 变量值为0时跳转关闭)
N10 G91                 (增量模式)
N20 G01 X10 Y10 F100    (每个循环移动的距离)
N30 G37 O$R1$ D-1       (给变量R1值减1)
N40 G20 L20 K$R1$       (变量R1值没到0时返回继续循环 N20)</code></pre><p><code>G36</code> 命令给变量赋值，<code>G37</code> 命令修改变量值。</p><p>此跳转命令有局限性，不可嵌套跳转，不可设置 K 值为常数，如：<code>K2</code> 写法是错误的。</p><p><strong>自定义标记跳转：</strong></p><pre><code>N00 G20 L?4              (定义需要跳转到标记 4 只能索引到此程序后的标记  如果没有找到标记则程序停在此处)
N05 L!5                  (定义标记位置5)
N10 G1 X100 F100
N20 G1 Y100 L!4 F100     (定义标记位置4)</code></pre><p><code>L?</code> 定义需要跳转到的目标标记，<code>L!</code> 定义目标标记位。索引数字可以是任意整数，目标标记 <code>L!</code> 可以和 G 代码一行也可以单独一行定义。</p><p>使用自定义标记跳转时需要注意只能跳转到后面的程序行。</p><h3>移动速度</h3><p>可以通过 <code>F</code> 控制轴移动速度，<code>E</code> 控制加速度及减速度。</p><p>示例：</p><pre><code>N10 G01 X100 Y50 F100 E10 E-20</code></pre><p>注意 <code>E</code> 后面设置负数就是设置减速度。</p><h3>全局自定义变量</h3><p>支持定义自定义全局变量并在 cnc 程序中使用，通过 G36 G37 给变量赋值。</p><p>首先需要在 GVL 中对变量进行定义：</p><pre><code>{attribute 'qualified_only'}
VAR_GLOBAL CONSTANT
    wVarsCount            : WORD:= 5;
END_VAR

VAR_GLOBAL
    lrR1                            : LREAL := 0;
    lrR2                            : LREAL := 0;
    lrR3                            : LREAL := 0;
    
    strVar1                         : STRING;
    
    lrSpeed                         : SM3_CNC.SMC_M_PARAMETERS; // M functions custom transfer parameter
    
    astVar                : ARRAY[0..wVarsCount-1] OF SMC_SingleVar := [
                                                    (strVarName := 'R1', pAdr := ADR(lrR1), eVarType := SMC_VARTYPE.SMC_TYPE_LREAL),
                                                    (strVarName := 'R2', pAdr := ADR(lrR2), eVarType := SMC_VARTYPE.SMC_TYPE_LREAL),
                                                    (strVarName := 'R3', pAdr := ADR(lrR3), eVarType := SMC_VARTYPE.SMC_TYPE_LREAL),
                                                    (strVarName := 'STR1', pAdr := ADR(strVar1), eVarType := SMC_VARTYPE.SMC_TYPE_STRING),
                                                    (strVarName := 'SPeed', pAdr := ADR(lrSpeed), eVarType := SMC_VARTYPE.SMC_TYPE_USERDEF)
                                                    ];
    
    stVarList            : SMC_VARLIST := (wNumberVars := wVarsCount, psvVarList := ADR(astVar));
END_VAR</code></pre><p>然后再 POU 中的 <code>SMC_ReadNCFile2</code> 功能块指定 <code>SMC_VARLIST</code> 地址:</p><pre><code>VAR
    fbReadFile    : SMC_ReadNCFile2;
END_VAR

************************************

fbReadFile(pvl := ADR(gVars.stVarList));</code></pre><p>变量类型支持 int lreal string 等各种类型，cnc 程序中使用 GVL 里 <code>strVarName</code> 定义的名称。<strong>不支持定义 array 数组类型变量</strong>。</p><p>cnc 程序调用语法：</p><pre><code>$&lt;Variablenname&gt;$</code></pre><p>通过 <code>$</code> 包围变量名称即可，示例如下：</p><pre><code>N50 G01 Y50 + $R2$ F300</code></pre><p><code>G36</code> 可以给变量赋值，<code>G37</code> 可以修改变量值：</p><pre><code>N00 G36 O$R1$ D5        (设置变量R1初始为5)
N10 G37 O$R1$ D-1       (给变量R1值减1)

N20 G36 O$STR1$ D'NAME'              (设置字符串变量初始)
N30 G37 O$STR1$ D'=MARCO'            (给字符串变量值添加字符)</code></pre><p>如果需要重启可保持型变量，需要将变量单独定义在 <strong>Persistent Variables</strong> 类型 object 中，具体参考：<a href="https://blog.niekun.net/archives/2840.html">codesys 定义重启可保持型变量</a></p><h3>子程序</h3><p>子程序调用支持无参数和带参数传递的模式，传递参数类型支持：<strong>BOOL</strong>, <strong>LREAL</strong>, 和 <strong>STRING</strong>，且必须使用 <code>SMC_ReadNCFile2</code> 和 <code>SMC_NCInterpreter</code> 来解码程序。子程序文件扩展名必须是 <code>.cnc</code>。</p><p>子程序存储路径需要在 <code>SMC_ReadNCFile2</code> 中指定,支持定义4个目录作为子程序索引：</p><pre><code>VAR
    aSubProgramDirs    : ARRAY[0..4] OF STRING[174]  := ['_cnc', ''];
    fbReadFile         : SMC_ReadNCFile2;
END_VAR

****************************

fbReadFile(aSubProgramDirs := aSubProgramDirs);</code></pre><p>子程序框架语法如下：</p><pre><code>SUBPROGRAM SUB_PROG_1{#VAR1:LREAL,#VAR2:STRING}
N20 G01 X#VAR1 Y#VAR1 F100
END_SUBPROGRAM</code></pre><p>如果有传递参数则需要写在大括号 <code>{}</code> 中定义。井号 <code>#</code> 表示定义的局部变量名称，可在子程序中使用。</p><p>子程序调用方式如下：</p><pre><code>SUB_PROG_1{}                    (无传递参数的子程序调用)
N55 SUB_PROG_1{$R3$,'ABC'}      (有传递参数的子程序调用)</code></pre><p><code>SMC_NCInterpreter</code> 功能块中的 <code>aActivePrograms : ARRAY[0..9] OF STRING</code> 存储程序级嵌套，<code>aActivePrograms[0]</code> 存储当前运行程序名称，<code>aActivePrograms[1]</code> 存储即将调用的子程序名称。</p><h3>数学表达式</h3><p>想要支持更多的计数表达式，必须使用 <code>SMC_ReadNCFile2</code> 和 <code>SMC_NCInterpreter</code> 来解码程序。</p><p>常用的加减乘除三角函数都是支持的，注意需要使用大括号 <code>{}</code> 来控制计算层级。给变量赋值还是需要使用 G36 G37 实现。</p><p>示例如下:</p><pre><code>N00 G36 O$STR1$ D CONCAT{'NAME','=MARCO'}           (链接两个字符串)
N35 G36 O$R1$ D SIN{30/180*PI}                      (三角函数单位为弧度, PI 表示 3.1415926)
N36 G36 O$R2$ D SQRT{$R1$} * 3
N40 G01 X 100 / 3 * 2</code></pre><p>支持的运算符号如下：<br><img src="https://blog.niekun.net/usr/uploads/2023/08/2578673165.png" alt="2023-08-17T03:09:32.png" title="2023-08-17T03:09:32.png"></p><p>支持的运算功能如下：<br><img src="https://blog.niekun.net/usr/uploads/2023/08/59595384.png" alt="2023-08-17T03:10:20.png" title="2023-08-17T03:10:20.png"></p><h3>本地局部变量</h3><p>上面介绍了如何定义全局变量，需要在 POU 中定义然后才能在 cnc 程序中使用。也可以定义在程序内部使用的局部变量，每个子程序内最多可以定义 21 个局部变量。</p><p>使用关键词 <code>LET</code> 定义变量，主程序中必须定义在程序最开头，子程序中必须定义在子程序名称下一行，不需要写 N 行号。</p><p>定义语法如下：</p><pre><code>LET &lt;FormalParam&gt; [:= &lt;InitialValue&gt;]

&lt;FormalParam&gt; ::= &lt;ParamName&gt; : &lt;ParamType&gt;
&lt;ParamName&gt;   ::= #[a-zA-Z0-9_]+

&lt;ParamType&gt; ::= LREAL | BOOL | STRING ; 字符串最大255字节</code></pre><p>示例如下：</p><pre><code>%VAR_TEST
LET #VAR1 : LREAL
LET #VAR2 : LREAL := 3
LET #VAR3 : LREAL := #VAR2 - 1
LET #VAR4 : BOOL := #VAR1 &gt; #VAR2
LET #VAR5 : STRING

N00 G36 O#VAR5 D'TEST'
N05 G36 O$STR1$ D#VAR5
N10 X#VAR2 +100 Y#VAR3 +50 F100

N55 SUB_PROG_1{$R3$,'ABC'}</code></pre><pre><code>SUBPROGRAM SUB_PROG_1{#VAR1:LREAL,#VAR2:STRING}
LET #AAA : LREAL := 10
N10 G91
N20 G01 X#VAR1 + #AAA Y#VAR1 F100
END_SUBPROGRAM</code></pre><p>以上就是 codesys 中使用 DIN 66025 标准编写 CNC 程序的基本语法及功能讲解，更多功能参考：<a href="https://content.helpme-codesys.com/en/CODESYS%20SoftMotion/_sm_struct_reference_programming_din66025.html">CNC Language in DIN 66025</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2835.html#comments" thr:count="1" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/2835.html" thr:count="1"/>
</entry>
</feed>