<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
xmlns:thr="http://purl.org/syndication/thread/1.0"
xml:lang="zh-CN"
xml:base="https://blog.niekun.net/"
>
<title type="text">Marco Nie</title>
<subtitle type="text">you are the company you keep...</subtitle>
<updated>2023-08-18T14:09:00+08:00</updated>
<generator uri="http://typecho.org/" version="1.2.0">Typecho</generator>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/" />
<id>https://blog.niekun.net/feed/atom/</id>
<link rel="self" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" />
<entry>
<title type="html"><![CDATA[codesys 定义断电保持型变量]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2840.html" />
<id>https://blog.niekun.net/archives/2840.html</id>
<updated>2023-08-18T14:09:00+08:00</updated>
<published>2023-08-18T14:09:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[无论是在 gvl 或者 pou 中都可以定义变量，默认情况下这些变量在系统重启后数据都会丢失。某些情况下我们希望变量值可以保持，系统重启后可以直接使用原数据，可以在变量定义块中通过关键词 RET...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2840.html" xml:lang="zh-CN"><![CDATA[
<p>无论是在 gvl 或者 pou 中都可以定义变量，默认情况下这些变量在系统重启后数据都会丢失。某些情况下我们希望变量值可以保持，系统重启后可以直接使用原数据，可以在变量定义块中通过关键词 <strong>RETAIN</strong> 和 <strong>PERSISTENT</strong> 来实现。</p><p><strong>RETAIN</strong> 可以在热重启后保持数据：</p><pre><code>In a POU:

VAR RETAIN
 iRem1 : INT;
END_VAR

*******************

In a GVL:

VAR_GLOBAL RETAIN
 gvarRem1 : INT;
END_VAR</code></pre><p>以下情况下 <strong>RETAIN</strong> 数据会被重置：</p><ul><li>the command Reset origin</li><li>the command Reset cold (as opposed to persistent variables)</li><li>a repeated program download</li></ul><p><strong>PERSISTENT</strong> 可以在热重启和冷重启后保持数据：</p><pre><code>VAR_GLOBAL PERSISTENT
 iVarPers1 : DINT;
 bVarPers : BOOL;
 PLC_PRG.PERS: INT;
END_VAR</code></pre><p>以下情况下 <strong>PERSISTENT</strong> 数据会被重置：</p><ul><li>the command Reset origin</li></ul><p>从 CODESYS V3.3.0.1 开始声明一个 <code>VAR_GLOBAL PERSISTENT</code> 等效于 <code>VAR_GLOBAL PERSISTENT RETAIN</code> or <code>VAR_GLOBAL RETAIN PERSISTENT</code>。</p><p>以下是各种变量定义模式下数据保持情况：</p><table><thead><tr><th align="center"> </th><th align="center"> </th><th align="center"> </th></tr></thead><tbody><tr><td align="center">after online command</td><td align="center">VAR</td><td align="center">VAR RETAIN</td><td>VAR PERSISTENT</td></tr><tr><td align="center">Reset warm</td><td align="center"> </td><td align="center">x</td><td>x</td></tr><tr><td align="center">Cold reset</td><td align="center"> </td><td align="center"> </td><td>x</td></tr><tr><td align="center">Reset origin</td><td align="center"> </td><td align="center"> </td></tr><tr><td align="center">Download</td><td align="center"> </td><td align="center"> </td><td>x</td></tr><tr><td align="center">Online Change</td><td align="center">x</td><td align="center">x</td><td>x</td></tr></tbody></table><p>参考链接: <a href="https://help.codesys.com/api-content/2/codesys/3.5.12.0/en/_cds_vartypes_retain_persistent/#retain-variables">Remanent Variables - RETAIN, PERSISTENT</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2840.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[codesys 中使用 DIN 66025 标准编写 CNC 程序]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2835.html" />
<id>https://blog.niekun.net/archives/2835.html</id>
<updated>2023-08-16T15:33:00+08:00</updated>
<published>2023-08-16T15:33:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[下面介绍 DIN 66025 标准下编写 codesys CNC 程序的一些基本规则。结构基本格式如下：% MyProgramN10 G01 X100 Y100 F100  (comment)N...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2835.html" xml:lang="zh-CN"><![CDATA[
<p>下面介绍 DIN 66025 标准下编写 codesys CNC 程序的一些基本规则。</p><h3>结构</h3><p>基本格式如下：</p><pre><code>% MyProgram
N10 G01 X100 Y100 F100  (comment)
N20 M8 G01 Z40 F20
N30 G03 X-100 R200 F100
N40 SubPrg{5}</code></pre><p>规则：</p><ul><li>以 % 标记程序头名称，也可以不写</li><li>每行代码都是一个 block，每个 block 都需要以 block number 开头，如：<code>N10</code></li><li>一行只能定义一个 G 代码，G90  G01 需要单独两行写</li><li>M 代码可以和 G 代码一行</li><li>小括号 <code>()</code> 中可以定义注释</li><li>子程序传递参数用大括号 <code>{}</code> 定义</li></ul><p>可用 G代码可以查询：<a href="https://content.helpme-codesys.com/en/CODESYS%20SoftMotion/_sm_cnc_din66025_basics.html">DIN 66025 Fundamentals</a></p><h3>暂停</h3><p>语法：</p><pre><code>N10 G4 T5  (停留5秒)</code></pre><h3>M 功能</h3><p>当 cnc 程序中编写一个 M 功能时，如 M8，在 <code>SMC_Interpolator</code> 功能块中的 <code>wM</code> 会输出调用的 M 功能编号 8，同时会在此功能块等待输入确认信号 <code>bAcknM</code> 为 <strong>true</strong> 并且清空 <code>wM</code> 信号，在此期间插补器会停留在原地等待。</p><p>如果需要在执行 M 功能的时候不中断当前正在进行的插补器动作，需要设置并执行 <code>SMC_PreAcknowledgeM</code> 功能块。但是如果M功能有传递参数 K L 等则不可激活此预完成功能，否则传递参数POU接收不到。</p><p>注意 M 功能编号中 <strong>65533–65535</strong> 是内部保留的，其他都是可以自定义的,包括 <code>M30</code>。</p><p>如要执行下面 cnc 程序：</p><pre><code>N15 G1 X10 F100
N20 M8
N21 G1 X50 F100
N30 M30</code></pre><p>POU 代码加入如下:</p><pre><code>VAR
    fbIpo       : SMC_Interpolator;   //插补器功能块
    fbPreAckM     : SM3_CNC.SMC_PreAcknowledgeMFunction;  //M 功能预完成功能  可不中断插补器动作  如果M功能有传递参数 则不可激活此功能
END_VAR

***************************************

IF fbIpo.wM = 30 THEN
    fbIpo(bAcknM:=TRUE);   //执行玩动作后触发完成信号
END_IF

fbPreAckM(bEnable:=TRUE,iM:=8,poqDataIn:=fbCheckVel.poqDataOut);  //激活指定M功能预完成  如果M功能有传递参数 则不可激活此功能
IF fbIpo.wM = 8 THEN
    gVars.lrR3 := 5;       //M功能需要执行的动作
    fbIpo(bAcknM:=TRUE);   //执行玩动作后触发完成信号
END_IF</code></pre><p>可以在 CNC 程序调用 M 功能时定义传递参数，供POU使用，使用关键词 <code>K</code> <code>L</code> 即可。同时需要定义 <code>SMC_GetMParameters</code> 功能块获取到参数值，这里需要注意此功能块必须和 <code>SMC_Interpolator</code> 处于同一周期中，否则可能读取失败，建议同  <code>SMC_Interpolator</code> 定义在一个 POU 中。</p><p>带传递参数的 M 功能 CNC 程序示例如下：</p><pre><code>N20 M8 K7</code></pre><p>以上示例 POU 修改如下：</p><pre><code>VAR
    fbIpo          : SMC_Interpolator;   //插补器功能块
    //fbPreAckM    : SMC_PreAcknowledgeMFunction; //屏蔽

    fbGetMPara    : SMC_GetMParameters;
END_VAR

***************************************

//fbPreAckM(bEnable:=TRUE,iM:=8,poqDataIn:=fbCheckVel.poqDataOut);  //屏蔽
IF fbIpo.wM = 8 THEN
    gVars.lrR3 := fbGetMPara.dK;;    //读取到 K 传递参数的数据
    fbIpo(bAcknM:=TRUE);             //执行玩动作后触发完成信号
END_IF

fbGetMPara(Interpolator:=fbIpo,bEnable:=TRUE);</code></pre><h3>跳转</h3><p>有两种跳转方法，第一种是引用行号来跳转，可以定义从某一个程序段跳转到另一个程序段以及跳转的循环次数。第二种是通过自定义标记位来跳转，可以不用管行号，缺点是只能向后跳转以及不可循环跳转。</p><p><strong>行号跳转语法：</strong></p><pre><code>G20 L K</code></pre><p><code>L</code> 定义需要跳转到的指定行号，<code>K</code> 定义跳转循环次数，当为 0 时停止跳转。当不写 <code>K</code> 时系统会模式使用内部变量计数。此功能需要配合赋值命令 <code>G36</code> <code>G37</code> 使用。</p><p>使用内部变量计数示例：</p><pre><code>N00 G36 D5              (设置内部变量初始为5 变量值为0时跳转关闭)
N10 G91                 (增量模式)
N20 G01 X10 Y10 F100    (每个循环移动的距离)
N30 G37 D-1             (给内部变量值减1)
N40 G20 L20             (内部变量值没到0时返回继续循环 N20)</code></pre><p>使用自定义变量计数的示例：</p><pre><code>N00 G36 O$R1$ D5        (设置变量R1初始为5 变量值为0时跳转关闭)
N10 G91                 (增量模式)
N20 G01 X10 Y10 F100    (每个循环移动的距离)
N30 G37 O$R1$ D-1       (给变量R1值减1)
N40 G20 L20 K$R1$       (变量R1值没到0时返回继续循环 N20)</code></pre><p><code>G36</code> 命令给变量赋值，<code>G37</code> 命令修改变量值。</p><p>此跳转命令有局限性，不可嵌套跳转，不可设置 K 值为常数，如：<code>K2</code> 写法是错误的。</p><p><strong>自定义标记跳转：</strong></p><pre><code>N00 G20 L?4              (定义需要跳转到标记 4 只能索引到此程序后的标记  如果没有找到标记则程序停在此处)
N05 L!5                  (定义标记位置5)
N10 G1 X100 F100
N20 G1 Y100 L!4 F100     (定义标记位置4)</code></pre><p><code>L?</code> 定义需要跳转到的目标标记，<code>L!</code> 定义目标标记位。索引数字可以是任意整数，目标标记 <code>L!</code> 可以和 G 代码一行也可以单独一行定义。</p><p>使用自定义标记跳转时需要注意只能跳转到后面的程序行。</p><h3>移动速度</h3><p>可以通过 <code>F</code> 控制轴移动速度，<code>E</code> 控制加速度及减速度。</p><p>示例：</p><pre><code>N10 G01 X100 Y50 F100 E10 E-20</code></pre><p>注意 <code>E</code> 后面设置负数就是设置减速度。</p><h3>使用自定义变量</h3><p>支持定义自定义全局变量并在 cnc 程序中使用，通过 G36 G37 给变量赋值。</p><p>首先需要在 GVL 中对变量进行定义：</p><pre><code>{attribute 'qualified_only'}
VAR_GLOBAL CONSTANT
    wVarsCount            : WORD:= 5;
END_VAR

VAR_GLOBAL
    lrR1                : LREAL := 0;
    lrR2                : LREAL := 0;
    lrR3                : LREAL := 0;
    
    strVar1                : STRING;
    
    lrSpeed             : SM3_CNC.SMC_M_PARAMETERS;
    
    astVar                : ARRAY[0..wVarsCount] OF SMC_SingleVar := [
                                                    (strVarName := 'R1', pAdr := ADR(lrR1), eVarType := SMC_VARTYPE.SMC_TYPE_LREAL),
                                                    (strVarName := 'R2', pAdr := ADR(lrR2), eVarType := SMC_VARTYPE.SMC_TYPE_LREAL),
                                                    (strVarName := 'R3', pAdr := ADR(lrR3), eVarType := SMC_VARTYPE.SMC_TYPE_LREAL),
                                                    (strVarName := 'STR1', pAdr := ADR(strVar1), eVarType := SMC_VARTYPE.SMC_TYPE_STRING),
                                                    (strVarName := 'SPeed', pAdr := ADR(lrSpeed), eVarType := SMC_VARTYPE.SMC_TYPE_USERDEF)
                                                    ];
    
    stVarList            : SMC_VARLIST := (wNumberVars := wVarsCount, psvVarList := ADR(astVar));
END_VAR</code></pre><p>然后再 POU 中的 <code>SMC_ReadNCFile2</code> 功能块指定 <code>SMC_VARLIST</code> 地址:</p><pre><code>VAR
    fbReadFile    : SMC_ReadNCFile2;
END_VAR

************************************

fbReadFile(pvl := ADR(gVars.stVarList));</code></pre><p>变量类型支持 int lreal string 等各种类型，cnc 程序中使用 GVL 里 <code>strVarName</code> 定义的名称。</p><p>cnc 程序调用语法：</p><pre><code>$&lt;Variablenname&gt;$</code></pre><p>通过 <code>$</code> 包围变量名称即可，示例如下：</p><pre><code>N50 G01 Y50 + $R2$ F300</code></pre><p><code>G36</code> 可以给变量赋值，<code>G37</code> 可以修改变量值：</p><pre><code>N00 G36 O$R1$ D5        (设置变量R1初始为5)
N10 G37 O$R1$ D-1       (给变量R1值减1)

N20 G36 O$STR1$ D'NAME'              (设置字符串变量初始)
N30 G37 O$STR1$ D'=MARCO'            (给字符串变量值添加字符)</code></pre><h3>子程序</h3><p>子程序调用支持无参数和带参数传递的模式，传递参数类型支持：<strong>BOOL</strong>, <strong>LREAL</strong>, 和 <strong>STRING</strong>，且必须使用 <code>SMC_ReadNCFile2</code> 和 <code>SMC_NCInterpreter</code> 来解码程序。子程序文件扩展名必须是 <code>.cnc</code>。</p><p>子程序存储路径需要在 <code>SMC_ReadNCFile2</code> 中指定,支持定义4个目录作为子程序索引：</p><pre><code>VAR
    aSubProgramDirs    : ARRAY[0..4] OF STRING[174]  := ['_cnc', ''];
    fbReadFile         : SMC_ReadNCFile2;
END_VAR

****************************

fbReadFile(aSubProgramDirs := aSubProgramDirs);</code></pre><p>子程序框架语法如下：</p><pre><code>SUBPROGRAM SUB_PROG_1{#VAR1:LREAL,#VAR2:STRING}
N20 G01 X#VAR1 Y#VAR1 F100
END_SUBPROGRAM</code></pre><p>如果有传递参数则需要写在大括号 <code>{}</code> 中定义。井号 <code>#</code> 表示定义的局部变量名称，可在子程序中使用。</p><p>子程序调用方式如下：</p><pre><code>SUB_PROG_1{}                    (无传递参数的子程序调用)
N55 SUB_PROG_1{$R3$,'ABC'}      (有传递参数的子程序调用)</code></pre><p><code>SMC_NCInterpreter</code> 功能块中的 <code>aActivePrograms : ARRAY[0..9] OF STRING</code> 存储程序级嵌套，<code>aActivePrograms[0]</code> 存储当前运行程序名称，<code>aActivePrograms[1]</code> 存储即将调用的子程序名称。</p><h3>数学表达式</h3><p>想要支持更多的计数表达式，必须使用 <code>SMC_ReadNCFile2</code> 和 <code>SMC_NCInterpreter</code> 来解码程序。</p><p>常用的加减乘除三角函数都是支持的，注意需要使用大括号 <code>{}</code> 来控制计算层级。给变量赋值还是需要使用 G36 G37 实现。</p><p>示例如下:</p><pre><code>N00 G36 O$STR1$ D CONCAT{'NAME','=MARCO'}           (链接两个字符串)
N35 G36 O$R1$ D SIN{30/180*PI}                      (三角函数单位为弧度, PI 表示 3.1415926)
N36 G36 O$R2$ D SQRT{$R1$} * 3
N40 G01 X 100 / 3 * 2</code></pre><p>支持的运算符号如下：<br><img src="https://blog.niekun.net/usr/uploads/2023/08/2578673165.png" alt="2023-08-17T03:09:32.png" title="2023-08-17T03:09:32.png"></p><p>支持的运算功能如下：<br><img src="https://blog.niekun.net/usr/uploads/2023/08/59595384.png" alt="2023-08-17T03:10:20.png" title="2023-08-17T03:10:20.png"></p><h3>本地局部变量</h3><p>上面介绍了如何定义全局变量，需要在 POU 中定义然后才能在 cnc 程序中使用。也可以定义在程序内部使用的局部变量，每个子程序内最多可以定义 21 个局部变量。</p><p>使用关键词 <code>LET</code> 定义变量，主程序中必须定义在程序最开头，子程序中必须定义在子程序名称下一行，不需要写 N 行号。</p><p>定义语法如下：</p><pre><code>LET &lt;FormalParam&gt; [:= &lt;InitialValue&gt;]

&lt;FormalParam&gt; ::= &lt;ParamName&gt; : &lt;ParamType&gt;
&lt;ParamName&gt;   ::= #[a-zA-Z0-9_]+

&lt;ParamType&gt; ::= LREAL | BOOL | STRING ; 字符串最大255字节</code></pre><p>示例如下：</p><pre><code>%VAR_TEST
LET #VAR1 : LREAL
LET #VAR2 : LREAL := 3
LET #VAR3 : LREAL := #VAR2 - 1
LET #VAR4 : BOOL := #VAR1 &gt; #VAR2
LET #VAR5 : STRING

N00 G36 O#VAR5 D'TEST'
N05 G36 O$STR1$ D#VAR5
N10 X#VAR2 +100 Y#VAR3 +50 F100

N55 SUB_PROG_1{$R3$,'ABC'}</code></pre><pre><code>SUBPROGRAM SUB_PROG_1{#VAR1:LREAL,#VAR2:STRING}
LET #AAA : LREAL := 10
N10 G91
N20 G01 X#VAR1 + #AAA Y#VAR1 F100
END_SUBPROGRAM</code></pre><p>以上就是 codesys 中使用 DIN 66025 标准编写 CNC 程序的基本语法及功能讲解，更多功能参考：<a href="https://content.helpme-codesys.com/en/CODESYS%20SoftMotion/_sm_struct_reference_programming_din66025.html">CNC Language in DIN 66025</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2835.html#comments" thr:count="1" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="1"/>
</entry>
<entry>
<title type="html"><![CDATA[codesys 模拟运行时外部G代码文件调用]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2833.html" />
<id>https://blog.niekun.net/archives/2833.html</id>
<updated>2023-08-15T10:12:00+08:00</updated>
<published>2023-08-15T10:12:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在电脑上进行运动控制模拟时，如果需要调用外部G代码程序，在定义路径地址的时候不能使用绝对地址，模拟环境下的程序运行目录为 C:\ProgramData\CODESYS\Simulation\Pl...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2833.html" xml:lang="zh-CN"><![CDATA[
<p>在电脑上进行运动控制模拟时，如果需要调用外部G代码程序，在定义路径地址的时候不能使用绝对地址，模拟环境下的程序运行目录为 <code>C:\ProgramData\CODESYS\Simulation\PlcLogic\</code>。</p><p>将G代码程序文件放入上述目录下使用即可调用，如：</p><pre><code>strFileName    : STRING(120) := 'NCReadFromFile.txt';</code></pre><p>一般可以新建一个子路径 <code>_cnc</code> 将程序都放入其中：</p><pre><code>strFileName    : STRING(120) := '_cnc/NCReadFromFile.txt';</code></pre><p>注意每次重启 codesys IDE 会重置 <code>C:\ProgramData\CODESYS\Simulation\PlcLogic\</code> 目录，需要重新复制程序进来。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2833.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[codesys 项目修改依赖库的版本]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2829.html" />
<id>https://blog.niekun.net/archives/2829.html</id>
<updated>2023-08-15T08:08:54+08:00</updated>
<published>2023-08-15T08:08:54+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[打开一个别人的项目后编译，发现出现 The library &amp;quot;caa behaviour model, 3.5.19.0 (caa technical workgroup)&amp;quot;...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2829.html" xml:lang="zh-CN"><![CDATA[
<p>打开一个别人的项目后编译，发现出现 <code>The library &quot;caa behaviour model, 3.5.19.0 (caa technical workgroup)&quot; was created with the unknown compiler version &quot;3.5.16.30&quot;</code> 的报错：<br><img src="https://blog.niekun.net/usr/uploads/2023/08/1876985659.png" alt="2023-08-15T00:04:07.png" title="2023-08-15T00:04:07.png"></p><p>但是我已经选择下载了缺失的库了，查询后发现是我的 codesys 版本过高，下载的对应库版本也高，而项目之前创建的时候可能是基于低版本库的，需要手动切换回对应版本的库即可。</p><p>library manager 下选择 placeholders 定位到报错的那个库：<br><img src="https://blog.niekun.net/usr/uploads/2023/08/3362564654.png" alt="2023-08-15T00:06:21.png" title="2023-08-15T00:06:21.png"></p><p>双击后显示版本菜单，选择对应低版本的选项：<br><img src="https://blog.niekun.net/usr/uploads/2023/08/3551738651.png" alt="2023-08-15T00:08:09.png" title="2023-08-15T00:08:09.png"></p><p>再次编译报错就会消失。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2829.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[bash 脚本中使用 ssh 登录并执行命令]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2826.html" />
<id>https://blog.niekun.net/archives/2826.html</id>
<updated>2023-06-08T13:16:00+08:00</updated>
<published>2023-06-08T13:16:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[通过 ssh 可以远程登录服务器并执行相关操作，常用指令如下：ssh user@address -p 22执行命令后会提示输入用户密码才能最终进入。如果在脚本中我们需要通过 ssh 登录用户并执...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2826.html" xml:lang="zh-CN"><![CDATA[
<p>通过 ssh 可以远程登录服务器并执行相关操作，常用指令如下：</p><pre><code>ssh user@address -p 22
</code></pre><p>执行命令后会提示输入用户密码才能最终进入。</p><p>如果在脚本中我们需要通过 ssh 登录用户并执行相关命令的话就有些麻烦了。</p><p>可以通过安装 <strong>sshpass</strong> 的方式在脚本中定义 ssh 密码，从而解决需求。</p><p>安装 <strong>sshpass</strong>：</p><pre><code>apt install sshpass
</code></pre><p>使用：</p><pre><code>sshpass -p password ssh user@address -p 22
</code></pre><p>通过以上命令就可以直接在一行中定义 ssh 密码从而自动登录了。</p><p>在脚本中如果需要执行相关命令可以将命令写在 <code>''</code> 中：</p><pre><code>sshpass -p password ssh user@address 'cd /tmp; ls; touch test.txt'
</code></pre><p>如果要执行的命令较长可以分开写，用 <code>EOF</code> 追加输入，就不用写引号了：</p><pre><code>sshpass -p password ssh user@address &lt;&lt; EOF
cd /tmp
ls
touch test.txt
EOF</code></pre><p>注意结尾也要换行写 <code>EOF</code> 作为追加结束的标识。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2826.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Linux 创建新用户并授予 root 权限]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2822.html" />
<id>https://blog.niekun.net/archives/2822.html</id>
<updated>2023-06-05T16:54:00+08:00</updated>
<published>2023-06-05T16:54:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[Linux 默认会有一个 root 用户，但日常直接使用 root 有一定安全隐患，所以通常情况下我们习惯于创建一个新用户来登录使用，下面介绍常规的建立流程。建立新用户 vpsadmin：add...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2822.html" xml:lang="zh-CN"><![CDATA[
<p>Linux 默认会有一个 root 用户，但日常直接使用 root 有一定安全隐患，所以通常情况下我们习惯于创建一个新用户来登录使用，下面介绍常规的建立流程。</p><p><strong>建立新用户 vpsadmin：</strong></p><pre><code>adduser vpsadmin
</code></pre><p>输入以上命令后会提示输入用户密码，完成后用户 <strong>vpsadmin</strong> 就建立完成了。</p><p><strong>安装 sudo 功能(sudo 就是在关键时刻，让普通账户临时获得 root 的能力):</strong></p><pre><code>apt update &amp;&amp; apt install sudo
</code></pre><p>把 <strong>vpsadmin</strong> 用户加入 <strong>sudo</strong> 名单里:</p><pre><code>visudo
</code></pre><p>执行后会打开相关配置文件，在 <code># User privilege specification</code> 栏后加入一行配置即可：</p><pre><code># User privilege specification
root    ALL=(ALL:ALL) ALL

vpsadmin ALL=(ALL) NOPASSWD: ALL</code></pre><p>最上面的 <strong>root</strong> 表示能使用 sudo 命令的用户：</p><ul><li>第一个ALL表示允许使用sudo的主机；</li><li>第二个ALL及第三个ALL表示用户组及用户；</li><li>第四个ALL表示sudo可执行的命令，即所有命令；</li><li>在有的系统中也简写做：root ALL=(ALL) ALL</li></ul><p>最下面我们自己添加的 <strong>vpsadmin</strong> 是需要授权可以使用 <strong>root</strong> 权限的用户，配置中 <code>NOPASSWD</code> 的意思是在使用 <strong>root</strong> 权限的时候在命令前输入 <strong>sudo</strong> 即可，确认后无需输入 <strong>root</strong> 密码，这样在使用中可以不用频繁的输入密码。如果你想要遵循常规的使用 <code>sudo</code> 时都输入密码，将配置改为：<code>vpsadmin ALL=(ALL:ALL) ALL</code> 即可。</p><p>重新登录用户即可完成配置查看效果。</p><p>参考链接：<br><a href="https://xtls.github.io/document/level-0/ch04-security.html">安全防护篇</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2822.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Photoshop 离线安装 neural filters 文件]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2819.html" />
<id>https://blog.niekun.net/archives/2819.html</id>
<updated>2023-05-26T08:27:00+08:00</updated>
<published>2023-05-26T08:27:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[neural filters 是 Photoshop 最新的 AI 技术，但是需要登录账号以及订阅正版软件。最近发现网上分享的版本可以实现这一功能，但是我自己试验了一下其中的 filters 都...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2819.html" xml:lang="zh-CN"><![CDATA[
<p>neural filters 是 Photoshop 最新的 AI 技术，但是需要登录账号以及订阅正版软件。最近发现网上分享的版本可以实现这一功能，但是我自己试验了一下其中的 filters 都需要在线下载，但是不知道由于盗版的原因还是网络的原因，一直下载失败，搜索后发现可以将别人打包好的这些 filters 文件直接放入 ps 固定目录即可。</p><p>V24 版 Photoshop neural filters 下载：<br><a href="https://krakenfiles.com/view/Gp1hmKDnC7/file.html">https://krakenfiles.com/view/Gp1hmKDnC7/file.html</a><br><a href="https://krakenfiles.com/view/9DM2lJKAOs/file.html">https://krakenfiles.com/view/9DM2lJKAOs/file.html</a></p><p>下载后解压，将其中的所有文件和文件夹放入，注意不同版本 PS 需要路径中的数字不同：</p><ul><li><strong>Windows 系统</strong>：<code>%APPDATA%\Adobe\UXP\PluginsStorage\PHSP\24\Internal\com.adobe.nfp.gallery\PluginData</code></li><li><strong>macOS 系统</strong>：<code>~/Library/Application Support/Adobe/UXP/PluginsStorage/PHSP/24/Internal/com.adobe.nfp.gallery/PluginData</code></li></ul><p>重新打开 Photoshop，通过 <strong>help - sign in</strong> 登录 adobe 账号，然后就可以打开 <strong>filters - neural filters</strong> 了。</p><p>参考链接：<br><a href="https://www.reddit.com/r/GenP/comments/yd26z4/neural_filters_not_downloading/">https://www.reddit.com/r/GenP/comments/yd26z4/neural_filters_not_downloading/</a><br><a href="https://blog.niekun.net/archives/1187.html">https://blog.niekun.net/archives/1187.html</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2819.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[通过 AI + Photoshop 修复偏色图片]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2804.html" />
<id>https://blog.niekun.net/archives/2804.html</id>
<updated>2023-04-25T10:30:12+08:00</updated>
<published>2023-04-25T10:30:12+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在一些特殊光照条件下很容易拍出偏色的图片，通常情况下很难恢复原有细节。现在有了很多 AI 工具可以方便的恢复原有色彩细节。下面介绍通过 Photoshop 结合一个 AI 上色网站的方法来恢复图...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2804.html" xml:lang="zh-CN"><![CDATA[
<p><img src="https://blog.niekun.net/usr/uploads/2023/04/562843203.png" alt="2023-04-25T02:01:19.png" title="2023-04-25T02:01:19.png"><br>在一些特殊光照条件下很容易拍出偏色的图片，通常情况下很难恢复原有细节。现在有了很多 AI 工具可以方便的恢复原有色彩细节。</p><p>下面介绍通过 Photoshop 结合一个 AI 上色网站的方法来恢复图片色彩。</p><p>Palette：<a href="https://palette.fm/">https://palette.fm/</a></p><p>首先需要通过 Photoshop 将图片去色，通过快捷键 ctrl shift U 快速去饱和度：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/392063121.png" alt="2023-04-25T02:03:40.png" title="2023-04-25T02:03:40.png"></p><p>然后保持图片到本地，打开 palette 官网，上传灰度图片即可：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/3549300290.png" alt="2023-04-25T02:04:40.png" title="2023-04-25T02:04:40.png"></p><p>从生成的多个模板中选择一个最合适的色彩图片：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/530587422.png" alt="2023-04-25T02:05:53.png" title="2023-04-25T02:05:53.png"></p><p>点击 download 下载下来，这里下载 HD 图片需要付费，免费模式下只能下载一个低清晰度的图片，但我们可以后期在 Photoshop 中恢复高清细节。</p><p>将下载的彩色低分辨率图片导入到 Photoshop 中，放在原始偏色的图片上面：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/4135975110.png" alt="2023-04-25T02:08:57.png" title="2023-04-25T02:08:57.png"></p><p>我们只需要它的色彩信息，所以将混合模式改为 color，此时图片细节已经恢复了，但噪点较多：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/1691169387.png" alt="2023-04-25T02:10:17.png" title="2023-04-25T02:10:17.png"></p><p>新建图层，混合模式改为 color：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/417063240.png" alt="2023-04-25T02:12:18.png" title="2023-04-25T02:12:18.png"></p><p>拾色器改为 3*3，all layer 模式：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/1310583693.png" alt="2023-04-25T02:12:51.png" title="2023-04-25T02:12:51.png"></p><p>选择画笔工具，选择 soft 笔刷，在衣服出选择一个正常颜色的区域，按住 alt 键拾取色彩，然后使用笔刷涂抹整个衣服区域：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/2051658881.png" alt="2023-04-25T02:16:22.png" title="2023-04-25T02:16:22.png"></p><p>此时衣服颜色就恢复正常了，同样的方式处理皮肤部分：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/623156937.png" alt="2023-04-25T02:20:54.png" title="2023-04-25T02:20:54.png"></p><p>然后就可以根据实际情况调节细节了，这里我们给嘴唇上点颜色，新建 solid color 红色图层，并反转蒙版，蒙版涂抹出嘴唇部分，混合模式改为 multiply：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/385215107.png" alt="2023-04-25T02:25:39.png" title="2023-04-25T02:25:39.png"></p><p>调节 layer style 柔滑高光过渡：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/677701391.png" alt="2023-04-25T02:27:38.png" title="2023-04-25T02:27:38.png"></p><p>画笔工具化的区域如果过于生硬，可以调节蒙版属性羽化值来柔化选区：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/2944943175.png" alt="2023-04-25T02:29:06.png" title="2023-04-25T02:29:06.png"></p><p>以下就是最终效果：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/3449082101.png" alt="2023-04-25T02:29:32.png" title="2023-04-25T02:29:32.png"></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2804.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[通过 adobe express 设计好看的插画]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2795.html" />
<id>https://blog.niekun.net/archives/2795.html</id>
<updated>2023-04-25T09:42:00+08:00</updated>
<published>2023-04-25T09:42:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[通过 adobe express 可以方便的制作专业的用于社交媒体的宣传海报，只需要选择一个合适的模板并对其进行修改即可。下面介绍操作流程。官方网站：https://express.adobe....]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2795.html" xml:lang="zh-CN"><![CDATA[
<p><img src="https://blog.niekun.net/usr/uploads/2023/04/4244425467.png" alt="2023-04-25T01:32:10.png" title="2023-04-25T01:32:10.png"><br>通过 adobe express 可以方便的制作专业的用于社交媒体的宣传海报，只需要选择一个合适的模板并对其进行修改即可。下面介绍操作流程。</p><p>官方网站：<a href="https://express.adobe.com/">https://express.adobe.com/</a></p><!--more--><p>登录网站后进入主页，可以选择你想制作一个什么类型的图片：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/3163992771.png" alt="2023-04-25T01:34:22.png" title="2023-04-25T01:34:22.png"></p><p>然后进入编辑界面，左侧可以选择此类型的很多模板，选择一个喜欢的样式：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/2593029178.png" alt="2023-04-25T01:35:33.png" title="2023-04-25T01:35:33.png"></p><p>然后可以对这个模板的内容进行个性化修改，包括字体，图标什么的都可以修改：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/1814374137.png" alt="2023-04-25T01:37:53.png" title="2023-04-25T01:37:53.png"></p><p>也可以添加新图案或图片：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/3398470744.png" alt="2023-04-25T01:38:33.png" title="2023-04-25T01:38:33.png"></p><p>可以上传自己的图片替换原始图片，上传后右侧有工具可以直接消除图片背景：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/383992829.png" alt="2023-04-25T01:40:38.png" title="2023-04-25T01:40:38.png"></p><p>完成设计后就可以下载图片了：<br><img src="https://blog.niekun.net/usr/uploads/2023/04/2719715559.png" alt="2023-04-25T01:41:33.png" title="2023-04-25T01:41:33.png"></p><p>整个过程非常简单，提供的免费模板也非常多，适合需要快速设计插图的需求。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2795.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[自动蒙版快速拆分图像各个元素 in Photoshop]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/2787.html" />
<id>https://blog.niekun.net/archives/2787.html</id>
<updated>2023-02-07T15:02:43+08:00</updated>
<published>2023-02-07T15:02:43+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[图片中有时候想要单独调整某个部分，可以通过选区工具钢笔工具等选取出来。但是当场景比较复杂或者需要单独调整多个元素时，就很耗费时间了，新版的 Photoshop 提供了快捷的方法来一键生成主要个体...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/2787.html" xml:lang="zh-CN"><![CDATA[
<p><img src="https://blog.niekun.net/usr/uploads/2023/02/3360067067.png" alt="2023-02-07T06:58:01.png" title="2023-02-07T06:58:01.png"><br>图片中有时候想要单独调整某个部分，可以通过选区工具钢笔工具等选取出来。但是当场景比较复杂或者需要单独调整多个元素时，就很耗费时间了，新版的 Photoshop 提供了快捷的方法来一键生成主要个体的 mask 蒙版。</p><!--more--><p>导入图片后点击 layer - mask all objects：<br><img src="https://blog.niekun.net/usr/uploads/2023/02/2266065659.png" alt="2023-02-07T06:59:43.png" title="2023-02-07T06:59:43.png"></p><p>等待处理完成就会自动生成识别到的个体的单独蒙版：<br><img src="https://blog.niekun.net/usr/uploads/2023/02/3016892681.png" alt="2023-02-07T07:00:27.png" title="2023-02-07T07:00:27.png"></p><p>此时就可以利用这些蒙版来单独修改特定区域的色彩了：<br><img src="https://blog.niekun.net/usr/uploads/2023/02/1999022133.png" alt="2023-02-07T07:02:16.png" title="2023-02-07T07:02:16.png"></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/2787.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/" thr:count="0"/>
</entry>
</feed>