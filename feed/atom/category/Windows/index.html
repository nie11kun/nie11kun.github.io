<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
xmlns:thr="http://purl.org/syndication/thread/1.0"
xml:lang="zh-CN"
xml:base="https://blog.niekun.net/category/Windows/"
>
<title type="text">Marco Nie - Windows</title>
<subtitle type="text"></subtitle>
<updated>2020-11-16T13:08:00+08:00</updated>
<generator uri="http://typecho.org/" version="1.2/18.10.23">Typecho</generator>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/category/Windows/" />
<id>https://blog.niekun.net/feed/atom/category/Windows/</id>
<link rel="self" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/Windows/" />
<entry>
<title type="html"><![CDATA[Speedtest CLI 命令行测速工具]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1911.html" />
<id>https://blog.niekun.net/archives/1911.html</id>
<updated>2020-11-16T13:08:00+08:00</updated>
<published>2020-11-16T13:08:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[speedtest 是国外很流行的测速平台，可以直接在其网站上测试本地上行下行带宽，最近看到其提供了本地命令行工具，使用起来更加方便了。官网：https://www.speedtest.net/]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1911.html" xml:lang="zh-CN"><![CDATA[
<p>speedtest 是国外很流行的测速平台，可以直接在其网站上测试本地上行下行带宽，最近看到其提供了本地命令行工具，使用起来更加方便了。</p><p>官网：<a href="https://www.speedtest.net/">https://www.speedtest.net/</a></p><!--more--><h3>安装</h3><p>首先需要到官网安装对应平台的 CLI 工具：<a href="https://www.speedtest.net/apps/cli">https://www.speedtest.net/apps/cli</a></p><p>Linux 类系统可以直接在使用 apt/brew 等包管理工具方便的安装，Windows 下需要手动下载 exe 可执行文件使用。</p><p><strong>macOS:</strong></p><pre><code>brew tap teamookla/speedtest
brew update
brew install speedtest --force</code></pre><p><strong>ubuntu:</strong></p><pre><code>sudo apt-get install gnupg1 apt-transport-https dirmngr
export INSTALL_KEY=379CE192D401AB61
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys $INSTALL_KEY
echo &quot;deb https://ookla.bintray.com/debian generic main&quot; | sudo tee  /etc/apt/sources.list.d/speedtest.list
sudo apt-get update
sudo apt-get install speedtest</code></pre><p><strong>windows:</strong><br>首先在网站上下载可执行文件，<a href="https://bintray.com/ookla/download/download_file?file_path=ookla-speedtest-1.0.0-win64.zip">点击下载 1.0.0 版</a>。</p><p>可执行文件为 <code>speedtest.exe</code>，需要将其目录加入系统 PATH 路径才可以直接在 terminal 调用，加入 PATH 方法参考我的教程：<a href="https://blog.niekun.net/archives/413.html">https://blog.niekun.net/archives/413.html</a></p><h3>使用</h3><p>在终端下使用 <code>speedtest -h</code> 命令查看帮助：</p><pre><code>Speedtest by Ookla is the official command line client for testing the speed and performance of your internet connection.

Version: speedtest 1.0.0.2

Usage: speedtest [&lt;options&gt;]
  -h, --help                        Print usage information
  -V, --version                     Print version number
  -L, --servers                     List nearest servers
  -s, --server-id=#                 Specify a server from the server list using its id
  -I, --interface=ARG               Attempt to bind to the specified interface when connecting to servers
  -i, --ip=ARG                      Attempt to bind to the specified IP address when connecting to servers
  -o, --host=ARG                    Specify a server, from the server list, using its host's fully qualified domain name
  -p, --progress=yes|no             Enable or disable progress bar (Note: only available for 'human-readable'
                                    or 'json' and defaults to yes when interactive)
  -P, --precision=#                 Number of decimals to use (0-8, default=2)
  -f, --format=ARG                  Output format (see below for valid formats)
  -u, --unit[=ARG]                  Output unit for displaying speeds (Note: this is only applicable
                                    for ‘human-readable’ output format and the default unit is Mbps)
  -a                                Shortcut for [-u auto-decimal-bits]
  -A                                Shortcut for [-u auto-decimal-bytes]
  -b                                Shortcut for [-u auto-binary-bits]
  -B                                Shortcut for [-u auto-binary-bytes]
      --selection-details           Show server selection details
      --ca-certificate=ARG          CA Certificate bundle path
  -v                                Logging verbosity. Specify multiple times for higher verbosity
      --output-header               Show output header for CSV and TSV formats

 Valid output formats: human-readable (default), csv, tsv, json, jsonl, json-pretty

 Machine readable formats (csv, tsv, json, jsonl, json-pretty) use bytes as the unit of measure with max precision

 Valid units for [-u] flag:
   Decimal prefix, bits per second:  bps, kbps, Mbps, Gbps
   Decimal prefix, bytes per second: B/s, kB/s, MB/s, GB/s
   Binary prefix, bits per second:   kibps, Mibps, Gibps
   Binary prefix, bytes per second:  kiB/s, MiB/s, GiB/s
   Auto-scaled prefix: auto-binary-bits, auto-binary-bytes, auto-decimal-bits, auto-decimal-bytes</code></pre><p>首先使用测试最近的测速节点 <code>testspeed -L</code>:</p><pre><code>root@Marco-vostro-14-wsl:~# speedtest -L
Closest servers:

    ID  Name                           Location             Country
==============================================================================
 29105  陕西移动5G                 Xi'an                China
  2461  China Unicom                   Chengdu              China
  4575  China Mobile Group Sichuan     Chengdu              China
 24337  China Mobile Group Sichuan Co.,Ltd. Chengdu              China
 35527  sccn                           Chengdu              China
 31985  China Unicom                   Chongqing            China
 17584  Chongqing Mobile Company       Chongqing            CN
  5530  CCN                            Chongqing            China
 16145  Lanzhou,China Mobile,Gansu     Lanzhou              China</code></pre><p>执行 <code>speedtest</code> 命令进行测速，默认使用上面测试的最近的节点：</p><pre><code>root@Marco-vostro-14-wsl:~# speedtest

   Speedtest by Ookla

     Server: Chongqing Mobile Company - Chongqing (id = 17584)
        ISP: China Telecom
    Latency:    31.45 ms   (25.47 ms jitter)
   Download:    14.31 Mbps (data used: 17.5 MB)
     Upload:     8.23 Mbps (data used: 11.3 MB)
Packet Loss:     0.0%
 Result URL: https://www.speedtest.net/result/c/bee17d45-7b9c-44e6-8a6e-ef99d84ba441</code></pre><p>以上就是简单的用法，可以查看帮助了解更多的使用方法。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1911.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1911.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[VMware 虚拟机磁盘文件合并]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1893.html" />
<id>https://blog.niekun.net/archives/1893.html</id>
<updated>2020-11-05T16:39:01+08:00</updated>
<published>2020-11-05T16:39:01+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在创建 VMware workstation 虚拟机时，在磁盘选项上会提示选择创建单个虚拟磁盘文件或分割为多个文件。我喜欢使用单个文件，因为选择多个文件会在虚拟机目录下建立许多类似的 vmdk ...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1893.html" xml:lang="zh-CN"><![CDATA[
<p>在创建 VMware workstation 虚拟机时，在磁盘选项上会提示选择创建单个虚拟磁盘文件或分割为多个文件。我喜欢使用单个文件，因为选择多个文件会在虚拟机目录下建立许多类似的 vmdk 文件，不太方便复制到其他地方。而且在导入 macOS 下的 VMware fusion 时会报错，所以推荐使用单个磁盘文件。</p><p>当现有的虚拟机已经是使用多个文件形式的话，可以使用 VMware workstation 附带的 vmware-vdiskmanager.exe 工具来进行合并。</p><!--more--><p>vmware-vdiskmanager.exe 是一个命令行工具，工具的位置在 VMware 安装路径下，如：<code>C:\Program Files (x86)\VMware\VMware Workstation\vmware-vdiskmanager.exe</code></p><p>在 PS 命令行下调用此工具查看帮助：</p><pre><code>PS C:\Users\Marco Nie&gt; &amp;&quot;vmware-vdiskmanager.exe&quot;
VMware Virtual Disk Manager - build 16894299.
Usage: vmware-vdiskmanager.exe OPTIONS &lt;disk-name&gt; | &lt;mount-point&gt;
Offline disk manipulation utility
  Operations, only one may be specified at a time:
     -c                   : create disk.  Additional creation options must
                            be specified.  Only local virtual disks can be
                            created.
     -d                   : defragment the specified virtual disk. Only
                            local virtual disks may be defragmented.
     -k                   : shrink the specified virtual disk. Only local
                            virtual disks may be shrunk.
     -n &lt;source-disk&gt;     : rename the specified virtual disk; need to
                            specify destination disk-name. Only local virtual
                            disks may be renamed.
     -p                   : prepare the mounted virtual disk specified by
                            the mount point for shrinking.
     -r &lt;source-disk&gt;     : convert the specified disk; need to specify
                            destination disk-type.  For local destination disks
                            the disk type must be specified.
     -x &lt;new-capacity&gt;    : expand the disk to the specified capacity. Only
                            local virtual disks may be expanded.
     -R                   : check a sparse virtual disk for consistency and attempt
                            to repair any errors.
     -e                   : check for disk chain consistency.
     -D                   : make disk deletable.  This should only be used on disks
                            that have been copied from another product.
     -U                   : delete/unlink a single disk link.

  Other Options:
     -q                   : do not log messages

  Additional options for create and convert:
     -a &lt;adapter&gt;         : (for use with -c only) adapter type
                            (ide, buslogic, lsilogic). Pass lsilogic for other adapter types.
     -s &lt;size&gt;            : capacity of the virtual disk
     -t &lt;disk-type&gt;       : disk type id

  Disk types:
      0                   : single growable virtual disk
      1                   : growable virtual disk split into multiple files
      2                   : preallocated virtual disk
      3                   : preallocated virtual disk split into multiple files
      4                   : preallocated ESX-type virtual disk
      5                   : compressed disk optimized for streaming
      6                   : thin provisioned virtual disk - ESX 3.x and above

     The capacity can be specified in sectors, KB, MB or GB.
     The acceptable ranges:
                           ide/scsi adapter : [1MB, 8192.0GB]
                           buslogic adapter : [1MB, 2040.0GB]
        ex 1: vmware-vdiskmanager.exe -c -s 850MB -a ide -t 0 myIdeDisk.vmdk
        ex 2: vmware-vdiskmanager.exe -d myDisk.vmdk
        ex 3: vmware-vdiskmanager.exe -r sourceDisk.vmdk -t 0 destinationDisk.vmdk
        ex 4: vmware-vdiskmanager.exe -x 36GB myDisk.vmdk
        ex 5: vmware-vdiskmanager.exe -n sourceName.vmdk destinationName.vmdk
        ex 6: vmware-vdiskmanager.exe -k myDisk.vmdk
        ex 7: vmware-vdiskmanager.exe -p &lt;mount-point&gt;
              (A virtual disk first needs to be mounted at &lt;mount-point&gt;)</code></pre><p><strong>VMware 生成的磁盘多个文件名称命名规则是如下：</strong></p><ul><li>根磁盘文件 - 如：Windows7.vmdk</li><li>分割磁盘文件 - 如：Windows7-s001.vmdk Windows7-s002.vmdk Windows7-s003.vmdk ...</li></ul><p><strong>使用命令合并多文件时只需要指定跟磁盘文件名称即可。</strong></p><p>根据帮助文档，使用 <code>-r</code> 指令指定多文件，<code>-t 0</code> 指令指定输出为单文件。示例如下：</p><pre><code>&amp;&quot;vmware-vdiskmanager.exe&quot; -r Windows7.vmdk -t 0 merge.vmdk

Creating disk 'merge.vmdk'
  Convert: 100% done.
Virtual disk conversion successful.</code></pre><p>命令执行后，在对应目录下会生成 merge.vmdk 虚拟磁盘文件，可以使用此文件建立新的虚拟机。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1893.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1893.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[vmware 虚拟机安装 openWrt 及路由配置]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1818.html" />
<id>https://blog.niekun.net/archives/1818.html</id>
<updated>2020-10-15T16:51:00+08:00</updated>
<published>2020-10-15T16:51:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[openWrt 是专门为嵌入式设备设计的 Linux 系统，常用来作为软路由系统使用。LEDE 和 openWrt 已经合并到一起。官网：https://openwrt.org/由于最近研究软路...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1818.html" xml:lang="zh-CN"><![CDATA[
<p>openWrt 是专门为嵌入式设备设计的 Linux 系统，常用来作为软路由系统使用。LEDE 和 openWrt 已经合并到一起。</p><p>官网：<a href="https://openwrt.org/">https://openwrt.org/</a></p><p>由于最近研究软路由，所以先再 Windows 上使用 VMware 虚拟机安装测试 openWrt。</p><!--more--><h3>固件下载及转换</h3><p>openWrt 固件也是区分不同硬件平台的，需要根据硬件情况下载对应的系统镜像。</p><p>官方固件下载地址：<a href="https://downloads.openwrt.org/">https://downloads.openwrt.org/</a></p><p>目前最新的版本是 19.07.4，我电脑是 x86 平台 64位系统需下载 x86_64 固件，进入列表下载 <code>combined-ext4.img.gz</code> 到本地:<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2820863057.jpg" alt="1.jpg" title="1.jpg"></p><p>将下载的压缩包解压出 img 镜像文件。由于我是虚拟机安装，所以需要将下载的 img 镜像转换为 VMware 的虚拟硬盘格式：<code>.vmdk</code>，最方便的是使用 Linux 工具 <code>qemu-img</code> 来完成，这里我是用 wsl 子系统来处理：</p><pre><code>apt install qemu qemu-utils
qemu-img convert -f raw -O vmdk openwrt-19.07.4-x86-64-combined-ext4.img openwrt-19.07.4-x86-64-combined-ext4.vmdk</code></pre><p>完成后得到 vmdk 文件。</p><h3>建立虚拟机</h3><p>新建虚拟机，选择自定义模式：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1077455176.jpg" alt="2.jpg" title="2.jpg"></p><p>硬件兼容选择最新的即可：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1008180166.jpg" alt="3.jpg" title="3.jpg"></p><p>然后选择稍后安装操作系统：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/689721582.jpg" alt="4.jpg" title="4.jpg"></p><p>系统选择 Linux 系统，19.07 版本是 4.14 内核，我下载的是 64 位固件，所以选择<strong>其他 Linux 4.x内核，64位</strong>：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1075618772.jpg" alt="5.jpg" title="5.jpg"></p><p>虚拟机名称自己定义：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2232764296.jpg" alt="6.jpg" title="6.jpg"></p><p>处理器默认即可：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1085680336.jpg" alt="7.jpg" title="7.jpg"></p><p>内存分配1G：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/89327964.jpg" alt="8.jpg" title="8.jpg"></p><p>剩下的全部默认确定即可，虚拟机初步建立完成。</p><p>下一步开始配置虚拟网卡用来分配给 openwrt 的 lan 内网网卡，点击<strong>编辑 - 虚拟网络编辑器</strong>：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1374273348.jpg" alt="9.jpg" title="9.jpg"></p><p>点击右下角<strong>更改设置</strong>：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/691892215.jpg" alt="10.jpg" title="10.jpg"></p><p>点击<strong>添加网络</strong>：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1419508697.jpg" alt="11.jpg" title="11.jpg"></p><p>选择一个可用的网络点击确定，我选择 vnet2：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/44933613.jpg" alt="12.jpg" title="12.jpg"></p><p>选择<strong>仅主机模式</strong>，由于 openwrt 自带 DHCP 控制所以这里取消勾选 DHCP 服务：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2381585332.jpg" alt="13.jpg" title="13.jpg"></p><p>点击确认，完成虚拟网卡的建立，子网 IP 段是 192.168.111.0，子网掩码 255.255.255.0。</p><p>下面编辑刚才建立的虚拟机，点击<strong>编辑虚拟机设置</strong>：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1011907668.jpg" alt="14.jpg" title="14.jpg"></p><p>移除不需要的硬件，包括硬盘，保留网络适配器。快捷键 alt + R：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/731943422.jpg" alt="15.jpg" title="15.jpg"></p><p>将上面转换的 vmdk 文件拷贝到此虚拟机文件夹：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1633164225.jpg" alt="16.jpg" title="16.jpg"></p><p>点击添加硬件：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1582850006.jpg" alt="17.jpg" title="17.jpg"></p><p>选择<strong>硬盘</strong>，点击下一步：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1091507877.jpg" alt="18.jpg" title="18.jpg"></p><p>选择<strong>使用现有虚拟磁盘</strong>：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/3795351894.jpg" alt="19.jpg" title="19.jpg"></p><p>选择刚才复制到目录的 vmdk 文件，点击完成：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/3286075109.jpg" alt="20.jpg" title="20.jpg"></p><p>选择<strong>转换</strong>：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/3939975986.jpg" alt="21.jpg" title="21.jpg"></p><p>再次添加一个网络适配器：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/903097129.jpg" alt="22.jpg" title="22.jpg"></p><p>这里我们有了两个网络适配器，第一个分配给 lan 第二个分配给 wan，注意顺序，openWrt 默认识别第一个网卡为 lan。</p><p>第一个网卡 lan 设置为我们刚才建立的虚拟网卡 vnet2，用来给 openWrt 路由的内网使用：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2504631771.jpg" alt="23.jpg" title="23.jpg"></p><p>第二个网卡 wan 设置为桥接模式，用来连接物理外网：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2177677516.jpg" alt="24.jpg" title="24.jpg"></p><p>确认后启动虚拟机，等待进入进入系统。<strong>进入系统后可以设置一个快照方便以后恢复。</strong></p><h3>网络配置</h3><p>进入系统后，我们需要设置 lan 的 IP 地址为我们创建的虚拟网卡所在的 IP 段，就能从主机访问 openwrt 了。</p><p>需要编辑 <code>/etc/config/network</code> 配置文件，默认配置文件如下：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/3506271504.jpg" alt="25.jpg" title="25.jpg"></p><p>这里我们需要关闭网桥模式(用 #井号 屏蔽)，然后修改 lan 段里的 ipaddr 地址为虚拟网卡网段。我们这里修改为 <code>192.168.111.2</code>:<br><img src="https://blog.niekun.net/usr/uploads/2020/10/265255040.jpg" alt="40.jpg" title="40.jpg"></p><p>修改完成后 reboot 系统。</p><p>重启完成后使用 <code>ip addr</code> 查看系统网络配置，可以看到 wan 口 eth1 分配到主机网络所在局域网 IP 地址，lan 口 eth0 是虚拟网卡 IP 地址：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2989248495.jpg" alt="39.jpg" title="39.jpg"></p><p>使用 ping 查看是否可以连接外网：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/3233271645.jpg" alt="31.jpg" title="31.jpg"></p><p>如果无法 ping 通，则需要检查配置问题。</p><p>主机网络适配器里找到 vnet 2 虚拟网卡：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/133092593.jpg" alt="29.jpg" title="29.jpg"></p><p>查看信息，ip 地址是否正确，<strong>注意</strong>如果 openwrt 里的 IP 设置为了 <code>192.168.111.1</code>，则这里的IPv4 地址就需要修改为其他地址了，不然就冲突了：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/43426789.jpg" alt="30.jpg" title="30.jpg"></p><p>这时候使用主机访问 <code>192.168.111.2</code> 应该就可以进入 LuCl 界面了：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/811268622.jpg" alt="28.jpg" title="28.jpg"></p><p>默认没有密码，可以使用 <code>passwd</code> 设置登录密码。</p><p>我们先给 openWrt 设置一个静态 wan 口 Ip，这样局域网设备就可以方便访问了。点击 network - interface：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/1641305336.jpg" alt="32.jpg" title="32.jpg"></p><p>wan 口配置点击 edit：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2975940019.jpg" alt="33.jpg" title="33.jpg"></p><p>protocol 选择 static address，点击 switch protocol：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2765529412.jpg" alt="34.jpg" title="34.jpg"></p><p>设置本地局域网内的 IP 地址，网关地址和 DNS 地址，点击保存：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2870937409.jpg" alt="38.jpg" title="38.jpg"></p><p>点击 save：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/366895487.jpg" alt="36.jpg" title="36.jpg"></p><h3>更换国内源</h3><p>由于虚拟机内不方便复制粘贴文本，我们使用 ssh 连接虚拟机：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2079947691.jpg" alt="37.jpg" title="37.jpg"></p><p>类似于 Debian，openWrt 也有包管理系统 <code>opkg</code>。默认都是国外源地址访问比较慢，可以替换为国内镜像地址，这里使用清华园镜像：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/openwrt/">https://mirrors.tuna.tsinghua.edu.cn/help/openwrt/</a></p><p>列表路径是：<code>/etc/opkg/</code>，有两个 conf 文件：<code>distfeeds.conf</code>, <code>customfeeds.conf</code></p><p>一键替换命令：</p><pre><code>sed -i 's_downloads.openwrt.org_mirrors.tuna.tsinghua.edu.cn/openwrt_' /etc/opkg/distfeeds.conf
</code></pre><p>更新列表：</p><pre><code>opkg update
</code></pre><p>安装常用工具：</p><pre><code>opkg install vim-full curl luci-i18n-base-zh-cn ca-certificates luci-ssl-openssl
</code></pre><h3>使用第三方源</h3><p><strong>使用第三方源步骤：</strong></p><ul><li>添加 第三方源 key 文件</li><li>源仓库地址加入 <code>/etc/opkg/customfeeds.conf</code> 文件</li><li>opkg update</li></ul><p>源仓库地址格式：</p><pre><code>src/gz example_feed_name http://www.example.com/path/to/files
</code></pre><p><strong>示例，加入第三方开发者 kuoruan 的源：</strong></p><p>添加 key：</p><pre><code>wget -O kuoruan-public.key http://openwrt.kuoruan.net/packages/public.key
opkg-key add kuoruan-public.key</code></pre><p>添加仓库地址到配置文件：</p><pre><code>echo &quot;src/gz kuoruan_universal http://openwrt.kuoruan.net/packages/releases/all&quot; \
  &gt;&gt; /etc/opkg/customfeeds.conf

opkg update</code></pre><h3>参考链接：</h3><p><a href="https://openwrt.org/docs/guide-user/virtualization/vmware">https://openwrt.org/docs/guide-user/virtualization/vmware</a><br><a href="https://github.com/kuoruan/luci-app-v2ray">https://github.com/kuoruan/luci-app-v2ray</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1818.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1818.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[wsl 2 激活 systemd]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1805.html" />
<id>https://blog.niekun.net/archives/1805.html</id>
<updated>2020-10-13T12:03:00+08:00</updated>
<published>2020-10-13T12:03:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[wsl 默认不支持 systemd，执行 systemd 命令会返回错误提示：# hostnamectlSystem has not been booted with systemd as in...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1805.html" xml:lang="zh-CN"><![CDATA[
<p>wsl 默认不支持 systemd，执行 systemd 命令会返回错误提示：</p><pre><code># hostnamectl
System has not been booted with systemd as init system (PID 1). Can't operate.
Failed to create bus connection: Host is down</code></pre><p>可以安装第三方的工具 genie 来激活 systemd。</p><p>GitHub：<a href="https://github.com/arkane-systems/genie">https://github.com/arkane-systems/genie</a></p><!--more--><h3>安装</h3><p>添加第三方 apt 库，在 <code>/etc/apt/sources.list.d</code> 目录下新建文件 <code>wsl-translinux.list</code>，文件内容如下：</p><pre><code>deb [trusted=yes] https://wsl-translinux.arkane-systems.net/apt/ /</code></pre><p>更新库列表：</p><pre><code>apt update &amp;&amp; apt upgrade
</code></pre><p>安装依赖包：</p><p>安装 Microsoft 依赖，下载对应系统版本的 prod 包：<a href="https://packages.microsoft.com/config/">https://packages.microsoft.com/config/</a>：</p><pre><code>curl -O https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb
dpkg -i packages-microsoft-prod.deb</code></pre><p>安装其他依赖：</p><pre><code>apt update &amp;&amp; apt install apt-transport-https daemonize dotnet-runtime-3.1</code></pre><p>安装 genie：</p><pre><code>apt install systemd-genie
</code></pre><h3>使用</h3><p>退出 wsl 系统后关闭 所有已打开的 wsl：</p><pre><code>wsl --shutdown
</code></pre><p>启动 wsl：</p><pre><code>wsl genie -s
</code></pre><p>启动的 Linux 系统就可以正常使用 systemd 了。</p><p>参考链接：<br><a href="https://gist.github.com/djfdyuruiry/6720faa3f9fc59bfdf6284ee1f41f950">https://gist.github.com/djfdyuruiry/6720faa3f9fc59bfdf6284ee1f41f950</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1805.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1805.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[wls 2 设置静态 DNS 服务地址及 Linux 和 Windows 主机网络互相访问设置]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1801.html" />
<id>https://blog.niekun.net/archives/1801.html</id>
<updated>2020-10-13T10:01:00+08:00</updated>
<published>2020-10-13T10:01:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在升级到 wsl 2 后发现一些网络问题和之前的 wsl 不一样了，主要是 DNS 解析和 wsl 和 Windows 网络互访问题，这里介绍如何处理。DNS 解析wsl 2 使用的 DNS 解...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1801.html" xml:lang="zh-CN"><![CDATA[
<p>在升级到 wsl 2 后发现一些网络问题和之前的 wsl 不一样了，主要是 DNS 解析和 wsl 和 Windows 网络互访问题，这里介绍如何处理。</p><h3>DNS 解析</h3><p>wsl 2 使用的 DNS 解析服务器设置在文件：<code>/etc/resolv.conf</code> 内设置，这是一个 link 文件，真正的文件路径是：<code>/run/resolvconf/resolv.conf</code>，这个文件是每次 wsl 启动时自动生成的，内容如下：</p><pre><code># This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 172.24.144.1</code></pre><!--more--><p>nameserver 后面的就是指定的 DNS 服务器地址。我发现有时候分配的服务器地址是无效的，如：<code>127.0.0.53</code>，使用 ping 来测试发现提示无法解析地址。需要设置一个固定的 DNS 地址，方法如下：</p><ul><li>新建文件：<code>/etc/wsl.conf</code>，内容如下：</li></ul><pre><code>[network]
generateResolvConf = false</code></pre><p>以上配置好就不会自动创建 <code>/run/resolvconf/resolv.conf</code> 文件了。</p><p>退出 wsl，关机然后重新启动：</p><pre><code>exit
wsl --shutdown
wsl
</code></pre><p>删除 link 文件：<code>/etc/resolv.conf</code>:</p><pre><code>rm /etc/resolv.conf
</code></pre><p>然后新建 <code>/etc/resolv.conf</code> 文件，内容如下，可自定义 nameserver 地址：</p><pre><code>nameserver 114.114.114.114
</code></pre><p>再次退出 wsl，关机然后重新启动：</p><pre><code>exit
wsl --shutdown
wsl
</code></pre><p>查看 <code>/etc/resolv.conf</code> 文件是否是之前自定义的地址：</p><pre><code>cat /etc/resolv.conf
</code></pre><p>测试网络服务：</p><pre><code>ping niekun.net
</code></pre><p>参考链接：<a href="https://github.com/microsoft/WSL/issues/5256#issuecomment-666545999">https://github.com/microsoft/WSL/issues/5256#issuecomment-666545999</a></p><h3>网络访问配置</h3><p>以前使用 wsl 时 Linux 子系统和 Windows 主机的网络好像是直接互通的，比如我在 Windows 下建立了一个 http 网页 <code>http://127.0.0.1:6000</code>，可以在 Linux 子系统下直接访问地址 <code>http://127.0.0.1:6000</code>，同理对于 Windows 主机访问 Linux 子系统的服务也是可以使用 localhost 直接访问的。</p><p>在升级到 wsl 2 后发现这一特性没有了，无法直接通过 localhost 地址来互通，查询官方说明关于<a href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions#accessing-network-applications">wsl 2 访问网络服务</a> 的方法可以实现访问，但是每次关机后 wsl 和 Windows 本地地址会发生变化不方便使用。</p><p><strong>可以设置静态 IP 来固定地址。Windows 终端下执行下面命令：</strong></p><p>在 wsl 下增加 IP 地址：<code>192.168.50.16</code>，名称为：<code>eth0:1</code>:(以 Ubuntu 系统为例)</p><pre><code>wsl -d Ubuntu -u root ip addr add 192.168.50.16/24 broadcast 192.168.50.255 dev eth0 label eth0:1
</code></pre><p>在 Windows 10 下增加一个 IP 地址：(此命令需要管理员权限执行)</p><pre><code>netsh interface ip add address &quot;vEthernet (WSL)&quot; 192.168.50.88 255.255.255.0
</code></pre><p>执行后，在 wsl 下通过 IP：<code>192.168.50.88</code> 访问 Windows 服务。在 Windows 下通过 IP：<code>192.168.50.16</code> 访问 wsl 服务。</p><p>完成后再终端使用 ipconfig 查看设置：</p><pre><code>Ethernet adapter vEthernet (WSL):

   Connection-specific DNS Suffix  . :
   Link-local IPv6 Address . . . . . : fe60::b525:6b90:8fb0:f513%58
   IPv4 Address. . . . . . . . . . . : 172.23.64.1
   Subnet Mask . . . . . . . . . . . : 255.255.240.0
   IPv4 Address. . . . . . . . . . . : 192.168.50.88
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . :</code></pre><p>以上两个命令可以写在一个 powershell 脚本文件内，脚本内设置管理员权限执行，由于需要管理员权限所以<strong>无法通过建立 shortcut 放到开机自启动文件夹来自动启动址</strong>。</p><p><code>wsl_ip.ps1</code> 脚本内容如下，会自动请求管理员权限：</p><pre><code>if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] &quot;Administrator&quot;))  
{  
  $arguments = &quot;&amp; '&quot; +$myinvocation.mycommand.definition + &quot;'&quot;
  Start-Process powershell -Verb runAs -ArgumentList $arguments
  Break
}

wsl -d Ubuntu -u root ip addr add 192.168.50.16/24 broadcast 192.168.50.255 dev eth0 label eth0:1
netsh interface ip add address &quot;vEthernet (WSL)&quot; 192.168.50.88 255.255.255.0
</code></pre><p>为了方便使用，可以将脚本路径加入系统 PATH 中，这样可以方便的在终端直接运行脚本，PATH 设置参考：<a href="https://blog.niekun.net/archives/413.html">https://blog.niekun.net/archives/413.html</a></p><p>完成后打开终端直接执行命令：<code>wsl_ip</code> 即可快速设置 IP。</p><p>参考链接：<a href="https://github.com/MicrosoftDocs/WSL/issues/418#issuecomment-648570865">https://github.com/MicrosoftDocs/WSL/issues/418#issuecomment-648570865</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1801.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1801.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[解决 proxifier 和 wsl 2 无法同时使用的问题]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1797.html" />
<id>https://blog.niekun.net/archives/1797.html</id>
<updated>2020-10-12T15:18:00+08:00</updated>
<published>2020-10-12T15:18:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[今天将 Windows 10 升级到了 build 2004 版，顺便将 wsl 升级到了 wsl 2，升级教程参考：https://blog.niekun.net/archives/1785....]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1797.html" xml:lang="zh-CN"><![CDATA[
<p>今天将 Windows 10 升级到了 build 2004 版，顺便将 wsl 升级到了 wsl 2，升级教程参考：<a href="https://blog.niekun.net/archives/1785.html">https://blog.niekun.net/archives/1785.html</a>。</p><p>运行 wsl 2 时，发现如下报错：</p><pre><code>PS C:\Users\Marco Nie&gt; wsl
The attempted operation is not supported for the type of object referenced.</code></pre><p>无法正常使用 wsl，查询后得知是由于我正在使用的 proxifier 和 wsl 有了冲突，proxifier 是我一直使用的用来代理程序的应用。在 wsl 的 github 项目讨论中看到有人问了 proxifier 开发者，得到了解决方法，需要使用提供的程序来让 wsl 在运行时不要加载 LSP DLLs。</p><ul><li>下载 <a href="https://blog.niekun.net/usr/uploads/2020/10/3243699170.zip">NoLsp.zip</a>，解压得到 NoLsp.exe</li><li>以管理员权限运行 terminal，执行 <code>&amp;&quot;path\to\NoLsp.exe&quot; &quot;c:\windows\system32\wsl.exe&quot;</code></li></ul><p>看到终端显示 <code>Succsess!</code>，表示操作完成，然后 wsl 系统就可以正常打开使用同时不影响 proxifier。</p><p>参考链接：<a href="https://github.com/microsoft/WSL/issues/4177">https://github.com/microsoft/WSL/issues/4177</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1797.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1797.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Windows 重建图标缓存]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1793.html" />
<id>https://blog.niekun.net/archives/1793.html</id>
<updated>2020-10-12T11:10:00+08:00</updated>
<published>2020-10-12T11:10:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在使用 Windows 中有时候会发现某个程序或文件的图标显示不正常，一般是图标缓存的问题，重建一下即可。以 Windows 10 为例，图标缓存文件路径为：%LOCALAPPDATA%\Mic...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1793.html" xml:lang="zh-CN"><![CDATA[
<p>在使用 Windows 中有时候会发现某个程序或文件的图标显示不正常，一般是图标缓存的问题，重建一下即可。</p><p>以 Windows 10 为例，图标缓存文件路径为：<code>%LOCALAPPDATA%\Microsoft\Windows\Explorer</code></p><p>文件夹内的 <code>iconcache_*.db</code> 就是图标缓存文件，删除这些文件然后重启 explorer 即可。</p><p>下面介绍命令的方式处理，使用 power shell 终端：</p><pre><code># 停止 explorer 进程
taskkill /f /im explorer.exe

# 删除缓存图标文件，ps 中使用 $Env:&lt;variable-name&gt; 表达环境变量
del &quot;$env:LOCALAPPDATA\Microsoft\Windows\Explorer\iconcache*.db&quot;

# 重启 explorer
start explorer</code></pre><p>完成后查看图标是否已经正常显示。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1793.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1793.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Windows 常用终端命令]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1788.html" />
<id>https://blog.niekun.net/archives/1788.html</id>
<updated>2020-10-12T09:30:00+08:00</updated>
<published>2020-10-12T09:30:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[系统版本：winver系统详细信息：systeminfo当前用户名：whoami]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1788.html" xml:lang="zh-CN"><![CDATA[
<p>系统版本：</p><pre><code>winver
</code></pre><p>系统详细信息：</p><pre><code>systeminfo
</code></pre><p>当前用户名：</p><pre><code>whoami

</code></pre><!--more--><p>本地网络：</p><pre><code>ipconfig
</code></pre><p>刷新 DNS 缓存：</p><pre><code>ipconfig /flushdns
</code></pre><p>路由信息：</p><pre><code>pathping
tracert
</code></pre><p>cmd 命令换行符：</p><pre><code>echo abc
等同于：
echo ^
abc</code></pre><p>powershell 命令换行符：</p><pre><code>echo abc
等同于：
echo `
abc</code></pre><p>信息过滤：类似 Linux 的 grep</p><pre><code>findstr
systeminfo | findstr &quot;System Type&quot;
</code></pre><p>查看命令的帮助：</p><pre><code>pathping /?
findstr /?
systeminfo /?
</code></pre><p>显示所有端口情况：</p><pre><code>netstat -ano
</code></pre><p>显示某个端口的占用情况 返回的数据中最后的数字为 PID 号：</p><pre><code>netstat -aon|findstr &quot;7200&quot;
</code></pre><p>根据 PID 号结束对应进程：</p><pre><code>taskkill /f /pid  7200
</code></pre><p>结束某个进程：</p><pre><code>taskkill /f /im explorer.exe
</code></pre><p>删除某个文件：</p><pre><code>del &quot;IconCache.db&quot;
</code></pre><p>启动某个程序：</p><pre><code>start explorer
</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1788.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1788.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Windows 10 Linux 子系统 WSL 升级到 WSL 2]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1785.html" />
<id>https://blog.niekun.net/archives/1785.html</id>
<updated>2020-10-12T09:24:00+08:00</updated>
<published>2020-10-12T09:24:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[Windows 10 上的 wsl 可以方便的运行 Linux 环境，最近从 wsl 升级到了 wsl 2，看了下介绍主要区别是：increase file system performance...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1785.html" xml:lang="zh-CN"><![CDATA[
<p>Windows 10 上的 wsl 可以方便的运行 Linux 环境，最近从 wsl 升级到了 wsl 2，看了下介绍主要区别是：</p><ul><li>increase file system performance</li><li>support full system call compatibility</li></ul><p>增加了系统性能，更加完善的 Linux 系统环境。</p><p>之前再 wsl 上无法使用的一些功能如 systemd 和网络 socket 提取的功能不知道是否可用了，下面就升级到 wsl 2 进行测试。</p><p>关于 wsl 的介绍和安装可以参考我的教程：<a href="https://blog.niekun.net/archives/1148.html">https://blog.niekun.net/archives/1148.html</a></p><!--more--><h3>环境要求</h3><p>Requirements：</p><ul><li>For x64 systems: Version 1903 or higher, with Build 18362 or higher.</li><li>For ARM64 systems: Version 2004 or higher, with Build 19041 or higher.</li><li>Builds lower than 18362 do not support WSL 2. Use the Windows Update Assistant to update your version of Windows.</li></ul><p>可以使用命令查看当前系统版本，快捷键 <code>win + R</code>，输入 <code>winver</code> 弹出系统信息：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2650368745.jpg" alt="1.jpg" title="1.jpg"></p><h3>命令行打开系统功能</h3><p>再我之前写的 wsl 安装教程里，介绍了从系统控制面板和命令行打开 <code>Windows Subsystem for Linux</code> 功能的方法，这里只介绍命令行方式。</p><p>首先以<strong>管理员权限</strong>打开 powershell。</p><p>如果之前没有安装 wsl 的话首先开启 <code>Windows Subsystem for Linux</code>：</p><pre><code>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
</code></pre><p>然后开启 <code>Virtual Machine feature</code>：</p><pre><code>dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
</code></pre><p>完成以上两部后，重启系统。</p><p>重启完成后安装 Linux 内核更新包：<a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">点击下载</a></p><p>再次重启系统。</p><p>设置 wsl 默认版本为 2：(管理员权限打开 powershell)</p><pre><code>wsl --set-default-version 2
</code></pre><p>设置默认版本后，以后安装的 Linux 子系统默认为 wsl 2 版本。</p><p>也可以将之前安装的 Linux 子系统升级到 wsl 2：</p><pre><code># 查看当前已安装的子系统
wsl -l -v

# 升级某个子系统到 wsl 2
wsl --set-version Ubuntu 2</code></pre><p>wsl 2 安装完成后就可以去 Windows 商店下载安装 Linux 发行版了：<a href="https://aka.ms/wslstore">https://aka.ms/wslstore</a></p><p>安装 Linux 发行版后的具体设置和之前 wsl 安装教程一样：<a href="https://blog.niekun.net/archives/1148.html">https://blog.niekun.net/archives/1148.html</a></p><h3>参考链接</h3><p><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a><br><a href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions">https://docs.microsoft.com/en-us/windows/wsl/compare-versions</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1785.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1785.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[powershell 脚本实现系统消息提醒]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1782.html" />
<id>https://blog.niekun.net/archives/1782.html</id>
<updated>2020-09-30T11:52:07+08:00</updated>
<published>2020-09-30T11:52:07+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[https://mcpmag.com/articles/2017/09/07/creating-a-balloon-tip-notification-using-powershell.aspx]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1782.html" xml:lang="zh-CN"><![CDATA[
<p><a href="https://mcpmag.com/articles/2017/09/07/creating-a-balloon-tip-notification-using-powershell.aspx">https://mcpmag.com/articles/2017/09/07/creating-a-balloon-tip-notification-using-powershell.aspx</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1782.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1782.html" thr:count="0"/>
</entry>
</feed>