<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
xmlns:thr="http://purl.org/syndication/thread/1.0"
xml:lang="zh-CN"
xml:base="https://blog.niekun.net/category/Linux/"
>
<title type="text">Marco Nie - Linux</title>
<subtitle type="text"></subtitle>
<updated>2020-03-06T15:00:08+08:00</updated>
<generator uri="http://typecho.org/" version="1.2/18.10.23">Typecho</generator>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/category/Linux/" />
<id>https://blog.niekun.net/feed/atom/category/Linux/</id>
<link rel="self" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/Linux/" />
<entry>
<title type="html"><![CDATA[获取用户真实 IP in Nginx]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1296.html" />
<id>https://blog.niekun.net/archives/1296.html</id>
<updated>2020-03-06T15:00:08+08:00</updated>
<published>2020-03-06T15:00:08+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[对于没有连代理访问网站的用户或者没有加 CND 的网站，可以直接在 Nginx 中用 deny 命令来拒绝某个 IP 的访问，$remote_addr 存储了当前链接用户的 IP:https:/...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1296.html" xml:lang="zh-CN"><![CDATA[
<p>对于没有连代理访问网站的用户或者没有加 CND 的网站，可以直接在 Nginx 中用 deny 命令来拒绝某个 IP 的访问，<strong>$remote_addr</strong> 存储了当前链接用户的 IP:<a href="https://nginx.org/en/docs/http/ngx_http_access_module.html#deny">https://nginx.org/en/docs/http/ngx_http_access_module.html#deny</a></p><pre><code>location / {
    deny  192.168.1.1;
    allow 192.168.1.0/24;
    allow 10.1.1.0/16;
    allow 2001:0db8::/32;
    deny  all;
}</code></pre><p>如果加了代理或者 CND 就没法直接获取到用户真实 IP 了，可以在 nginx 使用以下指令提取用户真实 IP：</p><pre><code>#获取用户真实IP，并赋值给变量$clientRealIP
map $http_x_forwarded_for  $clientRealIp {
        &quot;&quot;      $remote_addr;
        ~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$  $firstAddr;
}</code></pre><p>或者：</p><pre><code>set $realip $remote_addr;
  if ($http_x_forwarded_for ~ &quot;^(\d+\.\d+\.\d+\.\d+)&quot;) {
    set $realip $1;
  }</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1296.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1296.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Nginx upstream timed out 问题的处理]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1280.html" />
<id>https://blog.niekun.net/archives/1280.html</id>
<updated>2020-03-05T08:53:00+08:00</updated>
<published>2020-03-05T08:53:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在安装 wordpress 后遇到一个问题，打开后台的 theme 页面后，一直无法加载出来内容，查看后台 nginx 的日志，发现如下错误：[error] 10929#10929: *337 ...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1280.html" xml:lang="zh-CN"><![CDATA[
<p>在安装 wordpress 后遇到一个问题，打开后台的 theme 页面后，一直无法加载出来内容，查看后台 nginx 的日志，发现如下错误：</p><pre><code>[error] 10929#10929: *337 upstream timed out (110: Connection timed out) while reading upstream, client: 127.0.0.1, server: 127.0.0.1, request: &quot;GET /wp-admin/theme-install.php HTTP/1.1&quot;, upstream: &quot;fastcgi://unix:/run/php/php7.3-fpm.sock:&quot;, host: &quot;127.0.0.1&quot;, referrer: &quot;http://127.0.0.1/wp-admin/themes.php&quot;</code></pre><p>大概是处理 php 页面的时候 timeout 了，Google 了发现问题出在 fastCGI 上:<a href="https://talk.plesk.com/threads/upstream-timed-out-110-connection-timed-out-randomly.350497/">https://talk.plesk.com/threads/upstream-timed-out-110-connection-timed-out-randomly.350497/</a><br>解决方案就是在 nginx 配置文件内定义一下相关超时时间设定：</p><pre><code>proxy_connect_timeout 600;
proxy_send_timeout 600;
proxy_read_timeout 600;
send_timeout 600;</code></pre><p>将上述内容加入 config 文件，reload nginx 测试页面加载是否正常：</p><pre><code>sudo service nginx configtest
sudo service nginx reload


</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1280.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1280.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Windows 10 WSL 不支持 systemd]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1258.html" />
<id>https://blog.niekun.net/archives/1258.html</id>
<updated>2020-03-04T11:44:25+08:00</updated>
<published>2020-03-04T11:44:25+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在使用 WSL 中发现无法使用 systemd 指令，会有如下报错信息：System has not been booted with systemd as init system (PID 1...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1258.html" xml:lang="zh-CN"><![CDATA[
<p>在使用 WSL 中发现无法使用 systemd 指令，会有如下报错信息：System has not been booted with systemd as init system (PID 1). Can't operate</p><p>查询后发现 WSL 的确有这个问题：<a href="https://github.com/MicrosoftDocs/WSL/issues/457">https://github.com/MicrosoftDocs/WSL/issues/457</a></p><p>解决方法是用<strong>管理员权限打开 WSL</strong>，然后使用 <code>sudo service</code> 来控制进程，如：</p><pre><code>sudo service nginx start
</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1258.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1258.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Nginx 可用指令和变量索引]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1257.html" />
<id>https://blog.niekun.net/archives/1257.html</id>
<updated>2020-03-04T11:19:18+08:00</updated>
<published>2020-03-04T11:19:18+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[手册：http://nginx.org/en/docs/涵盖了安装教程，开始使用教程，常用使用情景教程，指令索引，变量索引 等链接。变量：http://nginx.org/en/docs/var...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1257.html" xml:lang="zh-CN"><![CDATA[
<p>手册：<a href="http://nginx.org/en/docs/">http://nginx.org/en/docs/</a></p><blockquote>涵盖了<strong>安装教程，开始使用教程，常用使用情景教程，指令索引，变量索引</strong> 等链接。</blockquote><p>变量：<a href="http://nginx.org/en/docs/varindex.html">http://nginx.org/en/docs/varindex.html</a></p><blockquote>变量在 nginx 配置中使用很多，使用变量可以根据需要处理特定部分。如：$rui, $scheme, $request_filename, $host, $request_uri</blockquote><p>指令：<a href="http://nginx.org/en/docs/dirindex.html">http://nginx.org/en/docs/dirindex.html</a></p><blockquote>如：listen, include, location, if, auth_basic</blockquote>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1257.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1257.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Typecho 配合 Nginx 设置伪静态链接]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1243.html" />
<id>https://blog.niekun.net/archives/1243.html</id>
<updated>2020-03-03T21:57:00+08:00</updated>
<published>2020-03-03T21:57:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[由于 typecho 是一个动态网页，每篇文章都 URL 都是形如：https://niekun.net/index.php/archives/192.html这种包含 php 的动态网站首先不...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1243.html" xml:lang="zh-CN"><![CDATA[
<p>由于 typecho 是一个动态网页，每篇文章都 URL 都是形如：<a href="https://niekun.net/index.php/archives/192.html">https://niekun.net/index.php/archives/192.html</a></p><p>这种包含 php 的动态网站首先不太美观链接比较长，而且在搜索引擎索引时也对动态链接不太友好。所以需要将以上链接形式进行处理，使网页看起来更像静态链接，形如：<a href="https://niekun.net/archives/192.html">https://niekun.net/archives/192.html</a>。</p><p class="more"><a href="https://blog.niekun.net/archives/1243.html" title="Typecho 配合 Nginx 设置伪静态链接">[...]</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1243.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1243.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[vim 常用指令]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1212.html" />
<id>https://blog.niekun.net/archives/1212.html</id>
<updated>2020-03-02T11:16:00+08:00</updated>
<published>2020-03-02T11:16:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[vim 是 Linux 下常用的编辑器，学会常用的操作如：光标移动 复制 粘贴 删除 撤销 等指令，对于日常使用很有必要，下面介绍常用指令。注意 vim 所有控制指令都区分大小写。]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1212.html" xml:lang="zh-CN"><![CDATA[
<p>vim 是 Linux 下常用的编辑器，学会常用的操作如：光标移动 复制 粘贴 删除 撤销 等指令，对于日常使用很有必要，下面介绍常用指令。</p><p><strong>注意 vim 所有控制指令都区分大小写。</strong></p><p class="more"><a href="https://blog.niekun.net/archives/1212.html" title="vim 常用指令">[...]</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1212.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1212.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[使用 tmux 建立多个 sessions]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1195.html" />
<id>https://blog.niekun.net/archives/1195.html</id>
<updated>2020-02-28T11:18:00+08:00</updated>
<published>2020-02-28T11:18:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[Linux 中，当前对话框就是一个 session，如果正在执行某个进程而不能中断，而又想操作一些其他事情，这是时候可以建立另一个 session 来处理。单独建立的 session 只要没有 ...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1195.html" xml:lang="zh-CN"><![CDATA[
<p>Linux 中，当前对话框就是一个 session，如果正在执行某个进程而不能中断，而又想操作一些其他事情，这是时候可以建立另一个 session 来处理。</p><p>单独建立的 session 只要没有 kill 掉，在返回主 session 并退出登录后，下次登录依然可以返回已经建立的 session。可以达到进程守护的目的。</p><p>可以使用的软件有 screen 和 tmux，这里介绍 tmux 的使用方法。</p><p>GitHub 主页：<a href="https://github.com/tmux/tmux">https://github.com/tmux/tmux</a><br>参考文章：<a href="https://helpful.knobs-dials.com/index.php/Screen_and_tmux">https://helpful.knobs-dials.com/index.php/Screen_and_tmux</a></p><p class="more"><a href="https://blog.niekun.net/archives/1195.html" title="使用 tmux 建立多个 sessions">[...]</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1195.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1195.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Ubuntu 修改 apt 国内源]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1161.html" />
<id>https://blog.niekun.net/archives/1161.html</id>
<updated>2020-02-26T13:25:00+08:00</updated>
<published>2020-02-26T13:25:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[国内使用 apt 安装软件如果感觉比较慢，可能是 deb 源是国外的，通过修改为国内源，可以很好的进行加速下载。系统代号每一个版本的 Ubuntu 都会有一个代号，用来识别不同的版本，比如：14...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1161.html" xml:lang="zh-CN"><![CDATA[
<p><img src="https://niekun.net/usr/uploads/2020/02/3080758679.png" alt="2020-02-26T04:59:18.png" title="2020-02-26T04:59:18.png"></p><p>国内使用 apt 安装软件如果感觉比较慢，可能是 deb 源是国外的，通过修改为国内源，可以很好的进行加速下载。</p><h4>系统代号</h4><p>每一个版本的 Ubuntu 都会有一个代号，用来识别不同的版本，比如：</p><ul><li>14.04 LTS 代号是 <strong>trusty</strong></li><li>16.04 LTS 代号是 <strong>xenial</strong></li><li>18.04 LTS 代号是 <strong>bionic</strong></li></ul><p>在更换源的时候需要使用到代号，可以使用如下命令查看当前系统版本代号：</p><pre><code>lsb_release -c

</code></pre><p class="more"><a href="https://blog.niekun.net/archives/1161.html" title="Ubuntu 修改 apt 国内源">[...]</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1161.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1161.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[在 Windows 和 WSL 中共享 Git credentials 证书]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1159.html" />
<id>https://blog.niekun.net/archives/1159.html</id>
<updated>2020-02-26T12:34:00+08:00</updated>
<published>2020-02-26T12:34:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[将 Git 的 credential 证书保留在系统，可以避免每次操作都需要输入账户密码。各系统中设置缓存参考我的文章：https://niekun.net/index.php/archives...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1159.html" xml:lang="zh-CN"><![CDATA[
<p>将 Git 的 credential 证书保留在系统，可以避免每次操作都需要输入账户密码。</p><p>各系统中设置缓存参考我的文章：<a href="https://niekun.net/index.php/archives/444.html">https://niekun.net/index.php/archives/444.html</a></p><p>对于 Windows 10 用户，系统内置了 Windows subsystem for Linux (WSL)，我们可以共享存储在本地的 Git credential 证书，这样两个系统使用 git 都很方便。</p><p>关于 WSL 的安装与使用参考：<a href="https://niekun.net/index.php/archives/1148.html">https://niekun.net/index.php/archives/1148.html</a></p><p>首先在 Windows 10 下设置 credentials，在 power shell 下输入如下命令：</p><pre><code>git config --global credential.helper wincred
</code></pre><blockquote>可以在仓库内测试执行 git push 命令，如果提示输入账户密码，则输入一次，以后就不会再提示了。</blockquote><p>然后在 WSL 设置，打开系统内安装好的 WSL，首先安装好 git，然后敲入如下命令：</p><pre><code>git config --global credential.helper &quot;/mnt/c/Program\ Files/Git/mingw64/libexec/git-core/git-credential-wincred.exe&quot;

</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1159.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1159.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[ffmpeg build from source]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/891.html" />
<id>https://blog.niekun.net/archives/891.html</id>
<updated>2020-02-09T20:27:00+08:00</updated>
<published>2020-02-09T20:27:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[https://trac.ffmpeg.org/wiki/CompilationGuide/UbuntuUbuntu 14.04add ppa：https://launchpad.net/~mc...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/891.html" xml:lang="zh-CN"><![CDATA[
<p><a href="https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu">https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu</a></p><p>Ubuntu 14.04<br>add ppa：<a href="https://launchpad.net/~mc3man/+archive/ubuntu/trusty-media">https://launchpad.net/~mc3man/+archive/ubuntu/trusty-media</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/891.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/891.html" thr:count="0"/>
</entry>
</feed>