<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
xmlns:thr="http://purl.org/syndication/thread/1.0"
xml:lang="zh-CN"
xml:base="https://blog.niekun.net/category/py/"
>
<title type="text">Marco Nie - python</title>
<subtitle type="text"></subtitle>
<updated>2024-07-01T10:17:13+08:00</updated>
<generator uri="https://typecho.org/" version="1.3.0">Typecho</generator>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/category/py/" />
<id>https://blog.niekun.net/feed/atom/category/py/</id>
<link rel="self" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/" />
<entry>
<title type="html"><![CDATA[使用虚拟环境 env 开发 python]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/env-python.html" />
<id>https://blog.niekun.net/archives/env-python.html</id>
<updated>2024-07-01T10:17:13+08:00</updated>
<published>2024-07-01T10:17:13+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[使用虚拟环境进行Python开发有助于隔离项目的依赖，避免不同项目之间的库版本冲突。以下是如何创建和使用虚拟环境的详细步骤。Python 3.3 及以上版本自带 venv 模块，可以直接使用。使...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/env-python.html" xml:lang="zh-CN"><![CDATA[
<p>使用虚拟环境进行Python开发有助于隔离项目的依赖，避免不同项目之间的库版本冲突。以下是如何创建和使用虚拟环境的详细步骤。</p><p><strong>Python 3.3 及以上版本自带 venv 模块，可以直接使用。</strong></p><h3>使用 venv 创建虚拟环境</h3><h4>创建虚拟环境</h4><p>在你的项目目录下，运行以下命令来创建一个虚拟环境，这将在项目目录下创建一个名为 <strong>myenv</strong> 的文件夹，其中包含虚拟环境的所有文件：</p><pre><code>python -m venv myenv
</code></pre><h4>激活虚拟环境</h4><p>Windows：</p><pre><code>myenv\Scripts\activate
</code></pre><p>macOS 和 Linux：</p><pre><code>source myenv/bin/activate
</code></pre><h4>安装依赖</h4><p>在虚拟环境中，你可以使用 pip 来安装项目所需的库：</p><pre><code>pip install requests
</code></pre><p>安装的库将只会影响当前虚拟环境，而不会影响系统的 Python 环境或其他项目。</p><h4>冻结依赖</h4><p>为了确保你的项目依赖可以在其他环境中重现，你可以使用以下命令将当前环境的依赖写入 <strong>requirements.txt</strong> 文件：</p><pre><code>pip freeze &gt; requirements.txt
</code></pre><p>requirements.txt 文件将包含所有当前环境中的安装包及其版本信息。</p><h4>使用 requirements.txt 安装依赖</h4><p>在新的环境中，你可以使用 <strong>requirements.txt</strong> 文件来安装所需的所有依赖：</p><pre><code>pip install -r requirements.txt
</code></pre><h4>退出虚拟环境</h4><p>当你完成工作时，可以通过以下命令退出虚拟环境：</p><pre><code>deactivate
</code></pre><p>使用虚拟环境进行Python开发可以有效地隔离项目依赖，避免版本冲突。通过创建和激活虚拟环境、安装依赖、冻结依赖并在新环境中重新安装依赖，可以确保你的项目在不同环境中具有一致的运行表现。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/env-python.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/env-python.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[从源码编译安装 python]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1758.html" />
<id>https://blog.niekun.net/archives/1758.html</id>
<updated>2020-09-21T16:35:00+08:00</updated>
<published>2020-09-21T16:35:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Linux/" term="Linux" />
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[从源码编译程序的好处是可以使用最新版本，下面介绍如何在 Linux 下编译安装 python 和 pip 环境。下载源码包python 官网：https://www.python.org/当前最...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1758.html" xml:lang="zh-CN"><![CDATA[
<p>从源码编译程序的好处是可以使用最新版本，下面介绍如何在 Linux 下编译安装 python 和 pip 环境。</p><h3>下载源码包</h3><p>python 官网：<a href="https://www.python.org/">https://www.python.org/</a></p><p>当前最新版是 3.8.5，在这个页面找到地址：<a href="https://www.python.org/downloads/release/python-385/">https://www.python.org/downloads/release/python-385/</a></p><p><img src="https://blog.niekun.net/usr/uploads/2020/09/3204471917.jpg" alt="1.jpg" title="1.jpg"></p><!--more--><p>下载 tgz 压缩包到本地并解压：</p><pre><code>cd /tmp
wget https://www.python.org/ftp/python/3.8.5/Python-3.8.5.tgz
tar xvf Python-3.8.5.tgz</code></pre><h3>环境安装</h3><p>编译需要安装一些依赖：</p><pre><code>apt install libffi-dev libgdbm-dev libsqlite3-dev libssl-dev zlib1g-dev
</code></pre><h3>编译</h3><p>python 源码使用标准 GNU 编译系统，详细说明参考：<a href="https://blog.niekun.net/archives/883.html">https://blog.niekun.net/archives/883.html</a></p><p>将 python 安装到 <code>/opt</code> 目录，先创建文件夹：</p><pre><code>mkdir /opt/python3.8.5
</code></pre><p>然后配置 configure：</p><pre><code>cd /tmp/Python-3.8.5

./configure \
--prefix=/opt/python3.8.5 \
--enable-optimizations \</code></pre><p>没有错误提示的话就开始编译和安装：</p><pre><code>make
make install
</code></pre><p>安装完成后测试执行：</p><pre><code>/opt/python3.8.5/bin/python3 --version
</code></pre><p>返回版本信息则安装完成。</p><p>下面将可执行文件加入系统路径，创建软连接：</p><pre><code>ln -s /opt/python3.8.5/bin/python3 /usr/bin/python
</code></pre><p>测试运行：</p><pre><code>python --version
</code></pre><h3>安装 pip</h3><p>源码编译安装的 python 不自带 pip，需要自己安装，可以使用 get-pip.py 脚本来安装。</p><p>官网：<a href="https://pip.pypa.io/en/stable/installing/">https://pip.pypa.io/en/stable/installing/</a></p><p>下载脚本到本地：</p><pre><code>curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</code></pre><p>使用刚才安装的 python 执行脚本：</p><pre><code>/opt/python3.8.5/bin/python3 get-pip.py
</code></pre><p>pip 的安装路径是 <code>/opt/python3.8.5/bin/</code>，测试命令：</p><pre><code>/opt/python3.8.5/bin/pip3 --version
</code></pre><p>返回版本信息则安装完成。</p><p>添加软连接到系统路径：</p><pre><code>ln -s /opt/python3.8.5/bin/pip3 /usr/bin/pip
</code></pre><p>测试命令：</p><pre><code>pip --version
</code></pre><h3>参考链接</h3><p><a href="https://docs.rstudio.com/resources/install-python-source/">https://docs.rstudio.com/resources/install-python-source/</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1758.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/1758.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[使用 subprocess.check_output 执行cmd命令并返回结果到字符串]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1753.html" />
<id>https://blog.niekun.net/archives/1753.html</id>
<updated>2020-09-18T15:13:51+08:00</updated>
<published>2020-09-18T15:13:51+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[语法：subprocess.check_output(args, *, stdin=None, stderr=None, shell=False, universal_newlines=Fals...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1753.html" xml:lang="zh-CN"><![CDATA[
<p>语法：</p><pre><code>subprocess.check_output(args, *, stdin=None, stderr=None, shell=False, universal_newlines=False)
</code></pre><p>执行cmd命令并返回结果到字符串。</p><p>用法：</p><pre><code>import subprocess

output = check_output([&quot;cat&quot;, &quot;/etc/hostname&quot;]).strip()
print(output)</code></pre><p>以上脚本会执行 <code>cat /etc/hostname</code> 命令然后将结果赋值给 <code>output</code> 变量。<br><code>strip()</code> 可以将 string 的前后空格去掉。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1753.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/1753.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[argparse and struct in python]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1718.html" />
<id>https://blog.niekun.net/archives/1718.html</id>
<updated>2020-08-14T11:20:39+08:00</updated>
<published>2020-08-14T11:20:39+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[https://docs.python.org/3/library/argparse.htmlhttps://docs.python.org/3/library/struct.html]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1718.html" xml:lang="zh-CN"><![CDATA[
<p><a href="https://docs.python.org/3/library/argparse.html">https://docs.python.org/3/library/argparse.html</a><br><a href="https://docs.python.org/3/library/struct.html">https://docs.python.org/3/library/struct.html</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1718.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/1718.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[string &lt;-&gt; byte in python]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1688.html" />
<id>https://blog.niekun.net/archives/1688.html</id>
<updated>2020-08-12T14:08:00+08:00</updated>
<published>2020-08-12T14:08:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[To transform a unicode string to a byte string in Python do this:&amp;gt;&amp;gt;&amp;gt; 'foo'.encode('utf_8...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1688.html" xml:lang="zh-CN"><![CDATA[
<p>To transform a unicode string to a byte string in Python do this:</p><pre><code>&gt;&gt;&gt; 'foo'.encode('utf_8')
b'foo'
</code></pre><p>To transform a byte string to a unicode string:</p><pre><code>&gt;&gt;&gt; b'foo'.decode('utf_8')
'foo'

</code></pre><ol><li><p>To convert a string to bytes.</p><pre><code>data = &quot;&quot;               #string
data = &quot;&quot;.encode()      #bytes
data = b&quot;&quot;              #bytes</code></pre></li><li><p>To convert bytes to a String.</p><pre><code>data = b&quot;&quot;              #bytes
data = b&quot;&quot;.decode()     #string
data = str(b&quot;&quot;)         #string</code></pre></li></ol>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1688.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/1688.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[winreg 操作 Windows 注册表 in python]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1685.html" />
<id>https://blog.niekun.net/archives/1685.html</id>
<updated>2020-08-12T13:56:00+08:00</updated>
<published>2020-08-12T13:56:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[https://docs.python.org/3/library/winreg.html#https://stackoverflow.com/questions/15128225/python...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1685.html" xml:lang="zh-CN"><![CDATA[
<p><a href="https://docs.python.org/3/library/winreg.html#">https://docs.python.org/3/library/winreg.html#</a><br><a href="https://stackoverflow.com/questions/15128225/python-script-to-read-and-write-a-path-to-registry">https://stackoverflow.com/questions/15128225/python-script-to-read-and-write-a-path-to-registry</a></p><pre><code>import winreg

REG_PATH = r&quot;Control Panel\Mouse&quot;

def set_reg(name, value):
    try:
        winreg.CreateKey(winreg.HKEY_CURRENT_USER, REG_PATH)
        registry_key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, REG_PATH, 0, 
                                       winreg.KEY_WRITE)
        winreg.SetValueEx(registry_key, name, 0, winreg.REG_SZ, value)
        winreg.CloseKey(registry_key)
        return True
    except WindowsError:
        return False

def get_reg(name):
    try:
        registry_key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, REG_PATH, 0,
                                       winreg.KEY_READ)
        value, regtype = winreg.QueryValueEx(registry_key, name)
        winreg.CloseKey(registry_key)
        return value
    except WindowsError:
        return None

#Example MouseSensitivity
#Read value 
print (get_reg('MouseSensitivity'))

#Set Value 1/20 (will just write the value to reg, the changed mouse val requires a win re-log to apply*)
set_reg('MouseSensitivity', str(10))

#*For instant apply of SystemParameters like the mouse speed on-write, you can use win32gui/SPI
#http://docs.activestate.com/activepython/3.4/pywin32/win32gui__SystemParametersInfo_meth.html</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1685.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/1685.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[使用 opencv 处理图像]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1684.html" />
<id>https://blog.niekun.net/archives/1684.html</id>
<updated>2020-08-07T11:37:51+08:00</updated>
<published>2020-08-07T11:37:51+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[安装：https://pypi.org/project/opencv-python/使用：https://opencv-python-tutroals.readthedocs.io/en/lat...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1684.html" xml:lang="zh-CN"><![CDATA[
<p>安装：<a href="https://pypi.org/project/opencv-python/">https://pypi.org/project/opencv-python/</a><br>使用：<a href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_setup/py_table_of_contents_setup/py_table_of_contents_setup.html">https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_setup/py_table_of_contents_setup/py_table_of_contents_setup.html</a><br>示例：<a href="https://www.askaswiss.com/2016/01/how-to-create-pencil-sketch-opencv-python.html">https://www.askaswiss.com/2016/01/how-to-create-pencil-sketch-opencv-python.html</a><br>打包 exe：<a href="https://pypi.org/project/auto-py-to-exe/">https://pypi.org/project/auto-py-to-exe/</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1684.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/1684.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[使用 TelegramBot 键盘 InlineKeyboardButton 提示 BUTTON_DATA_INVALID 报错原因分析]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/880.html" />
<id>https://blog.niekun.net/archives/880.html</id>
<updated>2020-02-01T18:06:06+08:00</updated>
<published>2020-02-01T18:06:06+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[今天在测试 telegram Bot 的时候，发现 keyboard 不能正确弹出来，后台查看发现报错了，提示 Bad Request: BUTTON_DATA_INVALID反复检查代码没有发...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/880.html" xml:lang="zh-CN"><![CDATA[
<p>今天在测试 telegram Bot 的时候，发现 keyboard 不能正确弹出来，后台查看发现报错了，提示 <code>Bad Request: BUTTON_DATA_INVALID</code></p><p>反复检查代码没有发现语法错误，查找之后了解到 <strong>InlineKeyboardButton</strong> 响应后返回的 <strong>Callback Data</strong> 有大小限制，最大64位：</p><p><img src="https://niekun.net/usr/uploads/2020/02/2328405825.png" alt="2020-02-01T10:02:48.png" title="2020-02-01T10:02:48.png"></p><p>的确我想返回的内容长度的确超过了大小限制，优化源码后问题解决了。</p><p>参考链接：<br><a href="https://core.telegram.org/bots/api#inlinekeyboardbutton">https://core.telegram.org/bots/api#inlinekeyboardbutton</a><br><a href="https://stackoverflow.com/questions/46389040/inlinekeyboardbutton-are-limited-in-inlinekeyboardmarkup-telegram-bot-c-sharp">https://stackoverflow.com/questions/46389040/inlinekeyboardbutton-are-limited-in-inlinekeyboardmarkup-telegram-bot-c-sharp</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/880.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/880.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[python 常用语法收集]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/438.html" />
<id>https://blog.niekun.net/archives/438.html</id>
<updated>2019-10-17T14:52:00+08:00</updated>
<published>2019-10-17T14:52:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<summary type="html"><![CDATA[在我使用过程中遇到的常用语法，这里做一些记录。]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/438.html" xml:lang="zh-CN"><![CDATA[
<p>在我使用过程中遇到的常用语法，这里做一些记录。</p><!--more--><h1>os.system()</h1><p>可以用来运行终端命令：</p><pre><code>import os
os.system('date')
-----------------------
The current date is: 10/17/2019 Thu </code></pre><h1>glob</h1><p>用来将匹配的文件放入数组：</p><pre><code>import glob
import os
CWD = os.getcwd()#当前目录路径
for name in glob.glob(CWD+'/*'):
    print(name)</code></pre><p>以上输出当前目录下所有文件的文件名。</p><pre><code>for name in glob.glob(CWD+'/file?.txt'):
    print(name)</code></pre><p>以上输出  filea.txt, fileb.txt filec.txt 等文件名。</p><p>可以使用类似正则表达式的方式匹配文件名：</p><pre><code>glob.glob(CWD+'/*[12].*')
</code></pre><p>从python3.5开始，支持使用一下方法进行递归搜索目录内文件及文件夹：</p><pre><code>for name in glob.glob(CWD+'/**/*', recursive=True):
    print(name)</code></pre><p>以上会输出目录内文件及子文件夹内文件。</p><h1>split()</h1><p>字符串分割：</p><p><strong>按空格分割，注意两个部分之间的空格可以是1个或多个，不影响分割效果：</strong></p><pre><code>txt = &quot;welcome to the jungle&quot;
x = txt.split()</code></pre><p>将 txt 字符串按空格来分成4个部分，x 是数组。</p><p><strong>分割成设定的个数：</strong></p><pre><code>txt = &quot;welcome to the jungle&quot;
x = txt.split(' ', 1)</code></pre><p>输出结果：x = ['welcome', 'to the jungle']</p><p><strong>按特定字符分割：</strong></p><pre><code>txt = &quot;apple#banana#cherry#orange&quot;
x = txt.split(&quot;#&quot;, 1)</code></pre><p>输出结果：x = ['apple', 'banana#cherry#orange']</p><h1>next()</h1><p>用于 iterator 的顺序提取。</p><pre><code>mylist = iter([&quot;apple&quot;, &quot;banana&quot;, &quot;cherry&quot;])
x = next(mylist)
print(x)
y = next(mylist)
print(x)
z = next(mylist)
print(x)</code></pre><p>输出结果：x = 'apple' y = 'banana' z = 'cherry'</p><h1>format()</h1><p><strong>用于字符串内的赋值：</strong></p><pre><code>print (&quot;{}, A computer science portal for geeks&quot;.format(&quot;GeeksforGeeks&quot;))</code></pre><p>输出：GeeksforGeeks, A computer science portal for geeks</p><p><strong>多个输入参数：</strong></p><pre><code>print (&quot;Hi ! My name is {} and I am {} years old&quot;
                            .format(&quot;User&quot;, 19)) </code></pre><p>带索引的多参数输入：</p><pre><code>print(&quot;Every {3} should know the use of {2} {1} programming and {0}&quot;
        .format(&quot;programmer&quot;, &quot;Open&quot;, &quot;Source&quot;, &quot;Operating Systems&quot;)) </code></pre><p>输出结果：Every Operating Systems should know the use of Source Open programming and programmer</p><h1>strip()</h1><p><strong>删除字符串前和后的空格：</strong></p><pre><code>txt = &quot;     banana     &quot;
x = txt.strip()</code></pre><p>输出：x = 'banana'</p><p>删除字符串前和后的自定义字符：</p><pre><code>txt = &quot;,,,,,rrttgg.....banana....rrr&quot;
x = txt.strip(&quot;,.grt&quot;)</code></pre><p>输出： x = 'banana'</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/438.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/438.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[使用 telegram bot 做一个视频下载器]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/428.html" />
<id>https://blog.niekun.net/archives/428.html</id>
<updated>2019-10-16T15:56:00+08:00</updated>
<published>2019-10-16T15:56:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<category scheme="https://blog.niekun.net/category/Linux/" term="Linux" />
<category scheme="https://blog.niekun.net/category/py/" term="python" />
<category scheme="https://blog.niekun.net/category/web/" term="web" />
<summary type="html"><![CDATA[需要环境：Linuxpython3python-telegram-botyt-dlpinstaloader]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/428.html" xml:lang="zh-CN"><![CDATA[
<p>需要环境：<br>Linux<br>python3<br>python-telegram-bot<br>yt-dlp<br>instaloader</p><!--more--><h3>python</h3><p>我是用的是 python3.8，使用系统包管理器安装：</p><pre><code>apt install python3
</code></pre><p>如果系统内安装了多个版本的 python，修改 /usr/bin/python 的默认链接，具体修改方法查看此教程：<br><a href="https://niekun.net/index.php/archives/413.html">https://niekun.net/index.php/archives/413.html</a></p><h3>python-telegram-bot</h3><p>安装或升级：</p><pre><code> pip install python-telegram-bot --upgrade
</code></pre><h3>yt-dlp 安装</h3><p>原来的 youtube-dl 最近好久不更新了，发现下载速度极慢，最近切换到 yt-dlp 效果很好。</p><p>GitHub：<a href="https://github.com/yt-dlp/yt-dlp">https://github.com/yt-dlp/yt-dlp</a></p><p>pip 方式安装及更新：</p><pre><code>python3 -m pip install -U yt-dlp
</code></pre><h3>instaloader 安装</h3><p>instaloader 可以下载 Instagram 的图片或视频。</p><p>GitHub 主页：<a href="https://github.com/instaloader/instaloader">https://github.com/instaloader/instaloader</a></p><p>instaloader 需要 python 3.5 以上。推荐直接安装最新版 python。</p><p>使用 pip3 安装：</p><pre><code>pip3 install instaloader --upgrade
</code></pre><h3>telegram bot</h3><p>首先在 telegram 客户端内添加 <a href="https://telegram.me/botfather">BotFather</a></p><p><strong>Creating a new bot</strong><br>Use the <code>/newbot</code> command to create a new bot. The BotFather will ask you for a name and username, then generate an authorization token for your new bot.</p><p>The <code>name</code> of your bot is displayed in contact details and elsewhere.</p><p>The <code>Username</code> is a short name, to be used in mentions and telegram.me links. Usernames are 5-32 characters long and are case insensitive, but may only include Latin characters, numbers, and underscores. Your bot's username must end in ‘bot’, e.g. ‘tetris_bot’ or ‘TetrisBot’.</p><p>The <code>token</code> is a string along the lines of <code>110201543:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw</code> that is required to authorize the bot and send requests to the Bot API. Keep your token secure and store it safely, it can be used by anyone to control your bot.</p><p>Generating an authorization token<br>If your existing token is compromised or you lost it for some reason, use the <code>/token</code> command to generate a new one.</p><h3>bot 源码</h3><p>我的开源地址：<a href="https://github.com/nie11kun/telegram-bot-youtube-downloader">https://github.com/nie11kun/telegram-bot-youtube-downloader</a></p><p>使用脚本需要配置两个环境变量：<strong>BOT_TOKEN</strong>, <strong>INS_ACCOUNT</strong>。分别是 bot token 和你的 Instagram 用户名。</p><h3>开机自动运行脚本</h3><p><strong>较新的 Linux 发行版可以使用 systemd 来实现自动启动</strong>，参考：<a href="https://blog.niekun.net/archives/1334.html">https://blog.niekun.net/archives/1334.html</a></p><p>以下是 telegrambot-downloader.service unit 内容：</p><pre><code>[Unit]
Description=telegrambot to download media Service
After=network.target nss-lookup.target

[Service]
User=root
EnvironmentFile=/etc/env_addon
ExecStart=/usr/bin/python /home/script/telegram-bot-youtube-downloader/main.py
Restart=on-failure

[Install]
WantedBy=multi-user.target</code></pre><p>其中 EnvironmentFile 指向了自定义的环境变量文件地址，文件内容如下：</p><pre><code>BOT_TOKEN=xxxxxxxxxxxxxx
INS_ACCOUNT=xxxxxx</code></pre><h3>可能运行报错问题及解决</h3><h4>执行脚本后，出现类似如下错误：</h4><pre><code>from tornado.httpserver import HTTPServer from tornado.httpserver import HTTPServer 
syntaxError: invalid syntax</code></pre><p>可能是 tornado 版本过高，需要进行降级：</p><pre><code>pip install tornado==4.5.3
</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/428.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/category/py/archives/428.html" thr:count="0"/>
</entry>
</feed>