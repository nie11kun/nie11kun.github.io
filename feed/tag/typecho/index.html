<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
xmlns:content="http://purl.org/rss/1.0/modules/content/"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
xmlns:atom="http://www.w3.org/2005/Atom"
xmlns:wfw="http://wellformedweb.org/CommentAPI/">
<channel>
<title>Marco Nie - typecho</title>
<link>https://blog.niekun.net/tag/typecho/</link>
<atom:link href="https://blog.niekun.net/feed/tag/typecho/" rel="self" type="application/rss+xml" />
<language>zh-CN</language>
<description></description>
<lastBuildDate>Tue, 03 Mar 2020 22:34:48 +0800</lastBuildDate>
<pubDate>Tue, 03 Mar 2020 22:34:48 +0800</pubDate>
<item>
<title>关于手机端无法使用 typecho 的搜索框解决</title>
<link>https://blog.niekun.net/archives/1249.html</link>
<guid>https://blog.niekun.net/archives/1249.html</guid>
<pubDate>Tue, 03 Mar 2020 22:34:48 +0800</pubDate>
<dc:creator>admin</dc:creator>
<content:encoded xml:lang="zh-CN"><![CDATA[
<div id="md_content_1" class="md_content" style="min-height: 50px;"><textarea id="append-test" style="display:none;">最近自己做了一个 typecho 的主题，主要是手机端的页面优化和字体优化，使用了 bootstrap 来渲染，主题在 GitHub 上开源：https://github.com/nie11kun/TypechoAwesome

但是测试发现搜索框无法正确搜索，总是返回主页。

今天终于发现问题所在了，由于我的网站使用的 NS 服务是 cloudflare 的，在当时设置的时候，把移动端 Mobile Redirect 优化选择上了，每次访问网站都会重定向到 **m.niekun.net**，估计是 cf 做了什么精简，导致功能丢失，把 Mobile Redirect 关闭就正常了。

具体修改路径是 speed - optimisation：
![2020-03-03T14:33:02.png][1]

页面拉到最下方，将 Mobile Redirect 关掉：
![2020-03-03T14:33:36.png][2]

再次访问主页，就不会重定向到 **m.niekun.net** 而是 **niekun.net** 了。

  [1]: https://niekun.net/usr/uploads/2020/03/448267460.png
  [2]: https://niekun.net/usr/uploads/2020/03/412183147.png</textarea></div>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/1249.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/tag/typecho/</wfw:commentRss>
</item>
<item>
<title>TypechoAwesome theme for Typecho</title>
<link>https://blog.niekun.net/archives/820.html</link>
<guid>https://blog.niekun.net/archives/820.html</guid>
<pubDate>Thu, 19 Dec 2019 09:55:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<content:encoded xml:lang="zh-CN"><![CDATA[
<div id="md_content_2" class="md_content" style="min-height: 50px;"><textarea id="append-test" style="display:none;">![TypechoAwesome-logo.jpg][1]

此主题是我在 typecho 原版默认主题基础上做了移动端的优化处理，适合喜欢简洁风格的人使用。

typecho 是一款轻量的博客系统，风格很简洁，相比较 wordpress 占用资源很少，所以我选择了 typecho。

官网：http://typecho.org/
GitHub 主页：https://github.com/typecho/typecho

关于 typecho 的安装参考我的教程：https://niekun.net/index.php/archives/6.html


<!--more-->


## 下载主题

此主题是基于 typecho 最新 GitHub master 分支制作的，不保证向下兼容，请升级到最新源码后在使用此主题，升级教程参考：https://niekun.net/index.php/archives/21.html

GitHub 主页：https://github.com/nie11kun/TypechoAwesome
release 页面：https://github.com/nie11kun/TypechoAwesome/releases

首先从 release 页面下载最新版本的源码到 typecho themes 目录：

    wget -O /tmp/TypechoAwesome.tar.gz https://github.com/nie11kun/TypechoAwesome/archive/V1.0.1.tar.gz
    tar -zxvf /tmp/TypechoAwesome.tar.gz -C /path/to/typecho/usr/themes/

进网站后台，选择 控制台 - 外观：
![2019-12-19T01:53:10.png][3]

找到 TypechoAwesome 点击**启用**：
![2019-12-19T01:54:06.png][4]

然后就可以返回网站查看效果了。

桌面端访问效果：
![2019-12-19T01:55:20.png][5]

移动端访问效果：
![2019-12-19T01:55:46.png][6]

移动端导航栏内容：
![2019-12-19T01:56:13.png][7]


  [1]: https://niekun.net/usr/uploads/2019/12/725033772.jpg
  [2]: https://niekun.net/usr/uploads/2019/12/2062542184.png
  [3]: https://niekun.net/usr/uploads/2019/12/2830202577.png
  [4]: https://niekun.net/usr/uploads/2019/12/1589661904.png
  [5]: https://niekun.net/usr/uploads/2019/12/3356972157.png
  [6]: https://niekun.net/usr/uploads/2019/12/3169287597.png
  [7]: https://niekun.net/usr/uploads/2019/12/37920406.png</textarea></div>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/820.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/tag/typecho/</wfw:commentRss>
</item>
<item>
<title>Nginx PHP 修改上传限制</title>
<link>https://blog.niekun.net/archives/371.html</link>
<guid>https://blog.niekun.net/archives/371.html</guid>
<pubDate>Thu, 15 Aug 2019 12:38:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<content:encoded xml:lang="zh-CN"><![CDATA[
<div id="md_content_3" class="md_content" style="min-height: 50px;"><textarea id="append-test" style="display:none;">使用 typecho 时，发现附件过大时无法上传，wordpress 也出现：413 request entity too large 这个错误码，这是 php 和 nginx 端的限制，修改配置文件可以提高上传文件大小。

修改 php.ini 文件，我使用的是 php5.6 版，所以首先查找 fpm 的配置文件：
    locate php.ini

找到后打开文件，如：
    vim /etc/php5.6/fpm/php.ini

使用 **/** 搜索字段，修改如下：
    upload_max_filesize = 1024M
    post_max_size = 1024M
    max_execution_time=600

重启 php 服务：
    service php5.6-fpm restart

nginx 配置中 http 段增加如下：
    client_max_body_size 50m;

重启 nginx：
    service nginx reload
</textarea></div>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/371.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/tag/typecho/</wfw:commentRss>
</item>
<item>
<title>如何升级Typecho</title>
<link>https://blog.niekun.net/archives/21.html</link>
<guid>https://blog.niekun.net/archives/21.html</guid>
<pubDate>Mon, 18 Feb 2019 10:42:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<content:encoded xml:lang="zh-CN"><![CDATA[
<div id="md_content_4" class="md_content" style="min-height: 50px;"><textarea id="append-test" style="display:none;">**我使用的是Github上的源码，且将源码放在网站根目录以方便更新，所以以下步骤对使用源码安装的有效。**
Typecho源码地址：https://github.com/typecho/typecho

- 进入你的网站根目录。使用命令`rm -r`和`rm`删除以下目录和文件`admin` `var` `index.php` `install.php`
- 进入你的Typecho源码目录，`git pull`更新文件，如果没有安装git需要先`apt-get install git`来安装
- 将Typecho源码文件夹下的`admin` `var` `index.php` `install.php`复制到网站根目录，使用命令`cp -r`和`cp`

修改新文件夹权限：
    chown -R www-data:www-data /path/to/blog

以上就是Typecho简单更新方法。

参考链接：http://docs.typecho.org/upgrade
</textarea></div>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/21.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/tag/typecho/</wfw:commentRss>
</item>
<item>
<title>Typecho安装笔记</title>
<link>https://blog.niekun.net/archives/6.html</link>
<guid>https://blog.niekun.net/archives/6.html</guid>
<pubDate>Sat, 16 Feb 2019 10:42:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<content:encoded xml:lang="zh-CN"><![CDATA[
<div id="md_content_5" class="md_content" style="min-height: 50px;"><textarea id="append-test" style="display:none;">## 背景

近几年来，自己断断续续的使用了很多VPS，学习了Linux的简单操作，学习了html,css,js,php等网络相关的东西，在进一步的使用远程服务器中，我接触了如何申请域名，如何CDN，如何使用Nginx做代理服务器实现自己编写的html脚本。

随着使用的深入，我想了解目前主流的网站是如何实现的，通过搜索，我发现Dajango的存在，由于之前有学习Python的基础知识，所以我很快学会了Dajango的使用，也在自己VPS上用Nginx，uwsgi托管了Dajango代码，看到网络上自己的网站第一次实现，真的有一种成就感。

有一个自己的blog一直是我的目标，之前想过使用Dajango来做，但是通过查找，发现相应的开源项目很少，所以一直没有去做，此事就一直耽搁了下来，近些天工作上的事情比较轻松，于是我又一次着手查找解决方案，发现了一个比较好的解决方案：**PHP-MySQL-Typecho**。


----------
## 关于Tpeocho

**Typecho**是一款免费开源的动态博客系统，运行在PHP环境下，界面简洁干净是他的特点。
文章支持markdown语法，很方便排版。
官网：http://typecho.org/


<!--more-->


安装环境要求：
- PHP 5.1以上
- Mysql, PostgreSQL, SQLite 任意一种数据库支持，并在PHP中安装了相关扩展
- CURL或者Socket扩展支持
- mbstring或者iconv扩展支持


----------
## 开始搭建

系统环境：ubantu14.04

### 安装Nginx

我使用的是Nginx代理，所以第一步安装nginx。

apt 安装：
    apt-get update
    apt-get install nginx

也可以从官网安装最新版，安装教程参考：https://niekun.net/index.php/archives/30.html

编辑配置文件：
    vim /etc/nginx/nginx.conf

user 改为 www-data:
    user  www-data;

在server段添加如下代码：

    server {
        listen                80;
        listen                [::]:80;
        server_name           your.domain;
        keepalive_timeout     70;

        root                  /www/path;
        index                 index.html index.htm;

        location / {
            try_files         $uri $uri/ =404;
        }
    }

启动服务：

    service nginx reload
    service nginx start

添加开机启动：
    vim /etc/init.d/rc.local
在文件最后添加：
    sudo service nginx start

访问你的域名，如果显示Nginx欢迎画面表示Nginx搭建成功。

在nginx.conf文件里定义的root目录编写测试index.html文件，刷新页面查看是否显示自定义页面。

如果一直显示nginx欢迎画面可能是：/etc/nginx/sites-enable/defalut需要删掉默认的配置

## 安装PHP

我安装的是PHP5.6版
    apt-get install php5.6-fpm php5.6-mysql

修改php.ini：
    find / -name php.ini
    vim /etc/php/5.6/fpm/php.ini

文本内搜索
    /cgi.fix_pathinfo

修改字段
    cgi.fix_pathinfo=0 ;设置为1可能会引起安全问题。

修改www.conf：
    vim /etc/php/5.6/fpm/pool.d/www.conf

    listen.owner = www-data
    listen.group = www-data

重启php-fpm服务

    service php5.6-fpm restart

### 配置Nginx的php

打开nginx.conf

server段内修改如下
```
index                          index.php index.html index.htm;

location / {
    try_files                  $uri $uri/ =404;
}

location ~ [^/]\.php(/|$) {
    try_files $fastcgi_script_name =404;
    fastcgi_split_path_info ^(.+?\.php)(.*)$;
    fastcgi_pass unix:/run/php/php5.6-fpm.sock;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
}

location ~ /\.ht {
    deny all;
}
```

重启nginx服务

    service nginx reload
    service nginx restart

测试php是否代理成功，在网站root目录新建文件index.php，访问主页。
    <?php
        phpinfo();
    ?>

如果显示access denied可能是权限问题
- nginx 和php-fpm不再一个用户下运行，查看上面的说到的配置(默认都是www-data)
   - ps -aux | grep nginx
   - ps -aux | grep php
- 网站目录权限不对
   - chmod -R 755 /www/path
   - chown -R www-data /www/path

## 安装MySQL

    apt-get install mysql-server

安装会自动创建一个root用户，期间会提示创建用户密码

进入MySQL
    mysql -uroot -p....
创建数据库(每条命令行尾加分号;)
    create database blog; 
    grant all privileges on blog.* to "root"@"localhost" identified by "password"; 
    show databases;
    quit;

## 安装Typecho

进入网站根目录
    cd /www/path
下载源码并解压，我下载的是开发板
    git clone https://github.com/typecho/typecho.git
    mv typecho/. /www/path

浏览器访问：domain.you/install.php开始安装，一步步跟随提示就OK了。
MySQL部分输入上面创建的密码和数据库名。

以上就是 Typecho 的安装过程，期间遇到访问 其他页面 404 的问题，通过修改 cgi.fix_pathinfo=1 临时解决了，但是有安全隐患，后通过学习 FastCGI 详细资料，通过修改 nginx config 中 php 的 location 段解决了问题。

关于 fastCGI 参考我的 wordpress 安装教程：https://niekun.net/index.php/archives/204.html</textarea></div>
]]></content:encoded>
<slash:comments>2</slash:comments>
<comments>https://blog.niekun.net/archives/6.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/tag/typecho/</wfw:commentRss>
</item>
</channel>
</rss>