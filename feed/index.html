<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
xmlns:content="http://purl.org/rss/1.0/modules/content/"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
xmlns:atom="http://www.w3.org/2005/Atom"
xmlns:wfw="http://wellformedweb.org/CommentAPI/">
<channel>
<title>Marco Nie</title>
<link>https://blog.niekun.net/</link>
<atom:link href="https://blog.niekun.net/feed/" rel="self" type="application/rss+xml" />
<language>zh-CN</language>
<description>you are the company you keep...</description>
<lastBuildDate>Sun, 07 Aug 2022 14:08:23 +0800</lastBuildDate>
<pubDate>Sun, 07 Aug 2022 14:08:23 +0800</pubDate>
<item>
<title>自建 RustDesk server</title>
<link>https://blog.niekun.net/archives/2744.html</link>
<guid>https://blog.niekun.net/archives/2744.html</guid>
<pubDate>Sun, 07 Aug 2022 14:08:23 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[RustDesk 是一款开源的跨平台远程桌面软件，类似于 TeamViewer 的 UI 样式，但它是完全免费的。RustDesk 提供了 3 个免费的转发服务器，会根据你的地理位置自动选择最快...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>RustDesk 是一款开源的跨平台远程桌面软件，类似于 TeamViewer 的 UI 样式，但它是完全免费的。</p><p>RustDesk 提供了 3 个免费的转发服务器，会根据你的地理位置自动选择最快的，一般使用足够了，如果对安全性有担忧，它们也提供了 server 端应用，可以自建转发服务器。下面就对搭建 server 端做一些介绍。</p><p>RustDesk GitHub 主页：<a href="https://github.com/rustdesk/rustdesk">https://github.com/rustdesk/rustdesk</a><br>RustDesk Server GitHub 主页：<a href="https://github.com/rustdesk/rustdesk-server">https://github.com/rustdesk/rustdesk-server</a></p><p>服务器平台：ubuntu 20.04</p><!--more--><h3>安装 server</h3><p>我是通过 docker 安装的 server 端，这样最快速简单。</p><p>关于 docker 和 docker compose 的安装可以参考我之前的文章：<a href="https://blog.niekun.net/archives/2742.html#title-1">https://blog.niekun.net/archives/2742.html#title-1</a></p><p><strong>docker-compose.yml</strong> 文件内容如下：</p><pre><code>version: '3'

networks:
  rustdesk-net:
    external: false

services:
  hbbs:
    container_name: hbbs
    ports:
      - 21115:21115
      - 21116:21116
      - 21116:21116/udp
      - 21118:21118
    image: rustdesk/rustdesk-server:latest
    command: hbbs -r 127.0.0.1:21117
    volumes:
      - ./data:/root
    networks:
      - rustdesk-net
    depends_on:
      - hbbr
    restart: unless-stopped

  hbbr:
    container_name: hbbr
    ports:
      - 21117:21117
      - 21119:21119
    image: rustdesk/rustdesk-server:latest
    command: hbbr
    volumes:
      - ./data:/root
    networks:
      - rustdesk-net
    restart: unless-stopped</code></pre><p>默认监听的是 21117 端口，客户端默认也是链接服务器的这个端口。这里配置监听本地 127.0.0.1。实际在通过域名或 IP 访问服务器时依然可以连接上服务。如果修改这里的默认端口，则在客户端设置的时候也需要指定此端口。</p><p>启动服务：</p><pre><code>docker-compose up -d
</code></pre><p>此时在客户端设置 ID server：<br><img src="https://blog.niekun.net/usr/uploads/2022/08/43407160.jpg" alt="1.jpg" title="1.jpg"></p><p>在第一行填入服务器 IP 地址即可：<br><img src="https://blog.niekun.net/usr/uploads/2022/08/2720143847.jpg" alt="2.jpg" title="2.jpg"></p><p>确认后，如果下方状态栏显示 <strong>ready</strong> 表示服务器链接正常：<br><img src="https://blog.niekun.net/usr/uploads/2022/08/4049467528.jpg" alt="3.jpg" title="3.jpg"></p><h3>配置域名访问</h3><p>如果想要使用域名作为 server id，只需要在你的域名服务器里加上一条自定义的域名 NS 解析即可，如：rust.abc.com。</p><p>注意如果你使用的是 cloudflare 服务，由于它在启用 CDN 后只支持少数端口的转发，而我们需要使用的是 21115 - 21119 这些端口，所以需要在 dns 配置时取消这个自定义域名的<strong>小黄云</strong>，只使用其 dns 服务：<br><img src="https://blog.niekun.net/usr/uploads/2022/08/1547842714.jpg" alt="4.jpg" title="4.jpg"></p><p>关于 cloudflare 的网络端口转发相关的信息参考官网内容：<a href="https://developers.cloudflare.com/fundamentals/get-started/reference/network-ports/">Network ports</a></p><p>自定义域名配置好后，就可以在客户端的 ID server 中使用域名链接了。方法和上面介绍的用服务器 IP 设置的方法相同。</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/2744.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>Joplin server 搭建</title>
<link>https://blog.niekun.net/archives/2742.html</link>
<guid>https://blog.niekun.net/archives/2742.html</guid>
<pubDate>Thu, 14 Jul 2022 08:19:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[joplin 是一款开源笔记应用，全平台适用，支持多种云端同步方式。最近体验了下感觉不错，尤其是可以自行搭建 server 服务端保存数据，适合喜欢管理整个数据流程的人士。下面介绍如何在服务器通...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>joplin 是一款开源笔记应用，全平台适用，支持多种云端同步方式。最近体验了下感觉不错，尤其是可以自行搭建 server 服务端保存数据，适合喜欢管理整个数据流程的人士。下面介绍如何在服务器通过 docker 搭建 joplin server 的方法。</p><p>joplin 官网：<a href="https://joplinapp.org/">https://joplinapp.org/</a><br>GitHub 主页：<a href="https://github.com/laurent22/joplin">https://github.com/laurent22/joplin</a><br>各个平台客户端下载：<a href="https://joplinapp.org/download/">https://joplinapp.org/download/</a></p><p>我的服务器系统平台是 Ubuntu 20.04。</p><!--more--><h3>docker 环境安装</h3><p>首先如果安装过老版的 docker 先卸载:</p><pre><code>sudo apt-get remove docker docker-engine docker.io containerd runc
</code></pre><p>安装基础环境：</p><pre><code> sudo apt-get update
 sudo apt-get install \
    ca-certificates \
    curl \
    gnupg \
    lsb-release</code></pre><p>添加 docker 官方 GPG key：</p><pre><code>sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</code></pre><p>安装 docker 和 docker-compose：</p><pre><code> sudo apt-get update
 sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin</code></pre><p>docker 配置为非 root 用户，解决执行命令需要 sudo：</p><pre><code>sudo groupadd docker
sudo usermod -aG docker $USER
su - ${USER}</code></pre><h3>配置 docker-compose</h3><p>通过 docker-compose 可以方便的配置 docker 容器设置及多容器之间数据交互。</p><p>新建 joplin 文件夹用来存放配置 <code>docker-compose.yml</code> 以及 <code>.env</code> 环境变量文件，我喜欢放在 opt 路径下：</p><pre><code>mkdir /opt/docker/joplin
cd /opt/docker/joplin
</code></pre><p>新建环境变量文件 <code>.env</code> 内容如下：</p><pre><code>APP_BASE_URL=https://joplin.your.site
APP_PORT=22300
# 
DB_CLIENT=postgres
POSTGRES_PASSWORD=PASSWORD
POSTGRES_DATABASE=joplin
POSTGRES_USER=USERNAME
POSTGRES_PORT=5432
POSTGRES_HOST=localhost</code></pre><p>上面的配置中需要自行修改几项：</p><ul><li><code>APP_BASE_URL</code> 修改为你实际访问 joplin 服务的外网地址，需要提前配置好 dns 映射，我是通过 cloudflare 管理的</li><li><code>POSTGRES_PASSWORD</code> 修改数据库密码</li><li><code>POSTGRES_USER</code> 修改数据库用户名</li></ul><p>新建 <code>docker-compose.yml</code> 内容如下：</p><pre><code>version: '3'
services:
    db:
        image: postgres:13
        volumes:
            - ./data/postgres:/var/lib/postgresql/data
        ports:
            - &quot;5432:5432&quot;
        restart: unless-stopped
        environment:
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
            - POSTGRES_USER=${POSTGRES_USER}
            - POSTGRES_DB=${POSTGRES_DATABASE}
        network_mode: host
    app:
        image: joplin/server:latest
        depends_on:
            - db
        ports:
            - &quot;22300:22300&quot;
        restart: unless-stopped
        environment:
            - APP_PORT=${APP_PORT}
            - APP_BASE_URL=${APP_BASE_URL}
            - DB_CLIENT=${DB_CLIENT}
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
            - POSTGRES_DATABASE=${POSTGRES_DATABASE}
            - POSTGRES_USER=${POSTGRES_USER}
            - POSTGRES_PORT=${POSTGRES_PORT}
            - POSTGRES_HOST=${POSTGRES_HOST}
        network_mode: host</code></pre><p>docker-compose 会自动调用同一路径下的 <code>.env</code> 文件中定义的环境变量。</p><p>完成配置后启动容器：</p><pre><code>docker-compose up -d
</code></pre><h3>nginx 配置</h3><p>外网访问上面定义的 url 后，需要通过反向代理将数据流传给 joplin server 端口 22300，我使用的是 nginx 配置如下：</p><pre><code>server {
    listen        443 ssl http2;
    listen        [::]:443 ssl http2;
    server_name   joplin.your.site;
    include       my-server/ssl; 加入 ssl 相关配置

    location / {
        proxy_pass          http://127.0.0.1:22300;
        proxy_redirect      off;

        proxy_set_header    Host              $host;
        proxy_set_header    X-Real-IP         $remote_addr;
        proxy_set_header    X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto $scheme;
        proxy_set_header    Upgrade           $http_upgrade;
        proxy_set_header    Connection        &quot;upgrade&quot;;
        proxy_http_version  1.1;
    }
}</code></pre><p>完成后重启 nginx：</p><pre><code>systemctl restart nginx
</code></pre><h3>访问</h3><p>配置好 docker 和 nginx 后就可以访问上面设置的 url 访问 joplin 了，默认会自动创建一个用户 <strong>admin@localhost</strong>，密码是 <strong>admin</strong>。</p><p>第一次登录进去后最好修改下默认管理员密码，还可以创建多个账户。</p><p>如果要适用账户的邮件服务，需要额外配置 SMTP 相关的内容，这里不做介绍，新建账户的激活邮件可以在管理菜单中找到，没有配置邮件服务的话无法发送成功，可以手动将邮件中的账户激活链接发送给别人。</p><p>如果登录网址无法访问网页，可能是 docker 配置有问题，可以通过 log 查看是否有报错信息：</p><pre><code>docker container list # 查询到容器的 ID
docker logs ID # 通过 joplin 的容器 ID 查询其日志
</code></pre><h3>插件</h3><p>joplin 桌面版支持安装插件，第三方插件有很多，可以在下面链接查找：<a href="https://github.com/joplin/plugins/blob/master/README.md#plugins">Joplin Plugin Repository</a></p><h3>参考链接</h3><p><a href="https://docs.docker.com/engine/install/ubuntu/">nstall Docker Engine on Ubuntu</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04">How To Install and Use Docker on Ubuntu 20.04</a><br><a href="https://docs.docker.com/engine/reference/commandline/logs/">docker logs</a><br><a href="https://github.com/laurent22/joplin/blob/dev/packages/server/README.md">joplin server install</a><br><a href="https://github.com/laurent22/joplin/blob/dev/docker-compose.server.yml">docker-compose.server.yml</a><br><a href="https://github.com/laurent22/joplin/blob/dev/.env-sample">.env-sample</a></p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/2742.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>Gradient 渐变色研究</title>
<link>https://blog.niekun.net/archives/2731.html</link>
<guid>https://blog.niekun.net/archives/2731.html</guid>
<pubDate>Wed, 06 Jul 2022 11:44:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[图片中经常可以使用到渐变色，两个颜色形成自然过渡效果，在实际体验中可以发现，有时候渐变色看起来很舒服，有时候看起来比较别扭，下面分析一下其中原因。下图是两个颜色组成的渐变效果，它们两端的颜色都一...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>图片中经常可以使用到渐变色，两个颜色形成自然过渡效果，在实际体验中可以发现，有时候渐变色看起来很舒服，有时候看起来比较别扭，下面分析一下其中原因。</p><p>下图是两个颜色组成的渐变效果，它们两端的颜色都一样，但是效果相差很多：<br><img src="https://blog.niekun.net/usr/uploads/2022/07/2750142518.png" alt="2022-07-06T03:24:36.png" title="2022-07-06T03:24:36.png"></p><p>明显左边的看起来更加舒服，右边的比较生硬。</p><!--more--><p>我们知道每个颜色都是 RGB 的组合，通常 RGB 各自有 256 种变化范围，它们之间的组合产生了各种颜色：<br><img src="https://blog.niekun.net/usr/uploads/2022/07/3590542115.png" alt="2022-07-06T03:45:23.png" title="2022-07-06T03:45:23.png"></p><p>在 Photoshop 中选取一种颜色的方法有四种：RGB，HSB，LAB，CMYK。最常用的就是 RGB 和 HSB，下面主要围绕这两种方法介绍。</p><p>不同于 RGB，HSB 或 HSV 拾取一种颜色是通过 H色相，S饱和度，B亮度确定的：<br><img src="https://blog.niekun.net/usr/uploads/2022/07/2439180221.png" alt="2022-07-06T03:30:35.png" title="2022-07-06T03:30:35.png"></p><p>当我们需要创建两个颜色的渐变图时，如果使用 RGB 模式，则它们的渐变过程是直接从两个颜色之间直线过渡。而使用 HSB 模式，它们的渐变过程是围绕 H色相环过渡到目标颜色：<br><img src="https://blog.niekun.net/usr/uploads/2022/07/1147253076.png" alt="2022-07-06T03:45:52.png" title="2022-07-06T03:45:52.png"></p><p>所以 RGB 模式就会穿过中间的灰色地带，效果就是过渡中颜色变淡变暗，这也就是看起开不舒服的原因。而 HSB 模式下饱和度和亮度都保持不变，只是色相发生变化，从而整体色彩持续保持鲜艳，呈现的效果就是看起来舒服。</p><p>Photoshop 中创建渐变时，提供了 3 种模式可供选择，还原了 RGB 模式 和 HSB 模式的规则，分别是：perceptual，linear，classic：<br><img src="https://blog.niekun.net/usr/uploads/2022/07/845880559.png" alt="2022-07-06T03:36:45.png" title="2022-07-06T03:36:45.png"></p><p>各种模式区别为：</p><ul><li>linear 最接近 HSB 模式，保证了过渡时候的饱和度和亮度，反映出颜色最鲜艳</li><li>perceptual 在过渡中保证亮度稳定，但是降低了饱和度</li><li>classic 在过渡中保证了饱和度稳定，但是降低了亮度</li></ul><p>三者对比图如下：<br><img src="https://blog.niekun.net/usr/uploads/2022/07/79679391.png" alt="2022-07-06T03:43:30.png" title="2022-07-06T03:43:30.png"></p><p>实际使用中根据需要选择合适效果。</p><p><strong>参考链接：</strong><br><a href="https://twitter.com/finmoorhouse/status/1543580508508065794">https://twitter.com/finmoorhouse/status/1543580508508065794</a></p>
]]></content:encoded>
<slash:comments>1</slash:comments>
<comments>https://blog.niekun.net/archives/2731.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>安装内核插件修复第三方 SSD 导致 MacBook 待机耗电大问题</title>
<link>https://blog.niekun.net/archives/2727.html</link>
<guid>https://blog.niekun.net/archives/2727.html</guid>
<pubDate>Sun, 26 Jun 2022 13:05:33 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[前几年给我的 MacBook Pro 2015 升级了 512G SSD 硬盘，什么都挺好就是合盖待机耗电量很大，一晚上基本就跑了 20% 电量，之前也研究过解决方法，还写过几篇博客：使用 Op...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>前几年给我的 MacBook Pro 2015 升级了 512G SSD 硬盘，什么都挺好就是合盖待机耗电量很大，一晚上基本就跑了 20% 电量，之前也研究过解决方法，还写过几篇博客：<a href="https://blog.niekun.net/archives/2353.html">使用 OpenCore Legacy Patcher 为 2015 款 MacBook Pro 激活 AirPlay</a>，<a href="https://blog.niekun.net/archives/1622.html">macOS 电源管理修复 MacBook 休眠耗电大问题</a>，但是最后都发现问题依旧。</p><p>今天在国外苹果论坛上看到有人介绍通过安装一些内核插件降低待机时候 ssd 的功率从而解决耗电问题<a href="https://discussions.apple.com/thread/252167491">https://discussions.apple.com/thread/252167491</a>：</p><blockquote>1) Get the newest firmware, where power management is already better and/or some sleep/wake issues are resolved<br>a) Either by upgrading to Big Sur (or in Catalina, Mojave the latest security updates) with your original SSD inside<br>OR<br>b) Upgrading Boot ROM Version without upgrading to Big Sur<br>2) Install tools which significantly lower the idle wattage for 3rd party SSDs<br>a) SsdPmEnabler<br>b) NVMeFix plugin inside lilu<br>c) a+b combined reach an even lower wattage in most cases</blockquote><p>主要是第二条介绍的几个内核插件，<a href="https://github.com/kvic-z/SsdPmEnabler">SsdPmEnabler</a>, <a href="https://github.com/acidanthera/lilu">lilu</a>, <a href="https://github.com/acidanthera/NVMeFix">NVMeFix</a><br>都是在 GitHub 上的开源软件，三个都是提供 .kext 文件，需要将 <code>.kext</code> 文件复制到系统路径 <code>/Library/Extensions</code>，重启系统即可。</p><p>后续我会测试是否有效。</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/2727.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>esxi 配置 GPU 显卡直通给虚拟机使用</title>
<link>https://blog.niekun.net/archives/2705.html</link>
<guid>https://blog.niekun.net/archives/2705.html</guid>
<pubDate>Wed, 25 May 2022 08:56:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[最近在我家里的 Ubuntu 上安装了 jellyfin 媒体中心，发现局域网内播放高码率视频卡顿严重，原因是默认设置的是软解码导致 cpu 负载很高，在设置里可以开启硬件解码，但是配置后发现播...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>最近在我家里的 Ubuntu 上安装了 jellyfin 媒体中心，发现局域网内播放高码率视频卡顿严重，原因是默认设置的是软解码导致 cpu 负载很高，在设置里可以开启硬件解码，但是配置后发现播放视频会报错：</p><blockquote>客户端配置文件存在问题，服务器未发送兼容的媒体格式</blockquote><p>看后台 log 日志，发现在 ffmpeg 解码时有如下报错信息：</p><pre><code>[AVHWDeviceContext @ 0x558b80b15a80] libva: vaGetDriverNameByIndex() failed with unknown libva error, driver_name = (null)
[AVHWDeviceContext @ 0x558b80b15a80] Failed to initialise VAAPI connection: -1 (unknown libva error).
Device creation failed: -5.
Failed to set value 'vaapi=va:/dev/dri/renderD128' for option 'init_hw_device': Input/output error
Error parsing global options: Input/output error</code></pre><!--more--><h3>查找原因</h3><p>测试在 docker-compose.yml 中开启全部权限，配置 root PUID PGID，以及映射 GPU 设备给 docker：</p><pre><code>    environment:
      - PUID=0
      - PGID=0
    devices:
      - /dev/dri:/dev/dri
    privileged: true</code></pre><p>重启容器后依然会报错。</p><p>报错信息显示无法读取 gpu 驱动名称，这应该不是 docker 的问题，在主机上测试 <code>vainfo</code> 也会报错：</p><pre><code>$ vainfo
error: can't connect to X server!
libva info: VA-API version 1.14.0
libva error: vaGetDriverNameByIndex() failed with unknown libva error, driver_name = (null)
vaInitialize failed with error code -1 (unknown libva error),exit</code></pre><p>报错内容和 jellyfin 的日志类似，测试添加环境变量强制指定驱动名称：</p><pre><code>export LIBVA_DRIVER_NAME=iHD</code></pre><p>再次 vainfo：</p><pre><code>$ vainfo
error: can't connect to X server!
libva info: VA-API version 1.14.0
libva info: User environment variable requested driver 'iHD'
libva info: Trying to open /usr/local/lib/dri/iHD_drv_video.so
libva info: Found init function __vaDriverInit_1_14
DRM_IOCTL_I915_GEM_APERTURE failed: Invalid argument
Assuming 131072kB available aperture size.
May lead to reduced performance or incorrect rendering.
get chip id failed: -1 [22]
param: 4, val: 0
libva error: /usr/local/lib/dri/iHD_drv_video.so init failed
libva info: va_openDriver() returns 18
vaInitialize failed with error code 18 (invalid parameter),exit</code></pre><p>现在看来应该是其他问题了，经过查询，esxi 默认是分配了虚拟显卡给虚拟机，导致虚拟机无法调用 gpu 底层的一些功能，从而导致 ffmpeg 等工具硬件解码失效。处理办法就是在 esxi 上配置显卡直通，然后添加给对应虚拟机直接调用硬件资源。</p><p><strong>经过下面的尝试，我还是设置显卡直通，导致最终无法实现硬件解码。可能是主板上有限制吧。</strong></p><h3>显卡直通</h3><p>显卡直通应该就可以解决上面的问题，但是当我直接进入 esxi 控制台设备管理中却找不到 GPU 设备，需要进入 esxi ssh 查看是否有 GPU 设备类似于：<strong>UHD Graphics 630</strong>。</p><p>ssh 登录 esxi 后台，首先查看是否有 GPU相关设备信息，终端命令行执行：</p><pre><code>lspci -v
</code></pre><p>找到显卡设备ID，如图所示：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3352280738.png" alt="2022-05-25T00:39:59.png" title="2022-05-25T00:39:59.png"></p><p><strong>8086:9bc8</strong> 就是显卡设备 ID，其中 8086 是供应商 ID，也就是代表 Intel，9bc8 就是这块显卡的设备硬件 ID。</p><p>然后关闭 esxi 对 GPU 的调用，然后手动添加 pci 设备信息，然后就可以在控制台配置直通了。</p><p>通过 ssh 登录 esxi，输入如下命令取消显卡占用，注意取消后就不能连接显示器访问 esxi 后台图形界面了：</p><pre><code>esxcli system settings kernel set -s vga -v FALSE</code></pre><p>后期如果需要取消显卡直通或者登录图形后台需要重新开启显卡调用：</p><pre><code>esxcli system settings kernel set -s vga -v TRUE</code></pre><p>然后修改 <strong>passthru.map</strong> 添加 PCIE 设备 ID 信息。</p><p>修改<strong>/etc/vmware/passthru.map</strong> 文件，根据上面找到的设备 ID 信息，在最底部增加以下信息：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/244215120.png" alt="2022-05-25T00:41:31.png" title="2022-05-25T00:41:31.png"></p><p>完成后保存并退出，然后重启 esxi。</p><p>重启完成后就可以从控制台 pci 设备中找到显卡了：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1706081722.png" alt="2022-05-25T00:42:58.png" title="2022-05-25T00:42:58.png"></p><p>配置好直通后，给对应虚拟机配置显卡。</p><h3>虚拟机配置</h3><p>首先编辑虚拟机，CPU虚拟化这三个选项全部取消，未取消开启虚拟机会报错：由于硬件或软件支持不可用,因此无法为 0:2.0 注册设备 pciPassthru0：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3232202527.png" alt="2022-05-25T00:44:00.png" title="2022-05-25T00:44:00.png"></p><p>内存勾选<strong>预留所有客户机内存（全部锁定）</strong>选项，不勾选启动虚拟机会报错：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3432325478.png" alt="2022-05-25T00:44:56.png" title="2022-05-25T00:44:56.png"></p><p>最后添加显卡：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/19783185.png" alt="2022-05-25T00:45:30.png" title="2022-05-25T00:45:30.png"><br><img src="https://blog.niekun.net/usr/uploads/2022/05/3251442515.png" alt="2022-05-25T00:45:40.png" title="2022-05-25T00:45:40.png"></p><p>然后配置虚拟机自定义参数：</p><p>进入<strong>虚拟机选项 → 高级 → 配置参数 → 编辑配置</strong>添加以下参数：</p><table><thead><tr><th align="center"> </th><th align="center"> </th></tr></thead><tbody><tr><td align="center">键</td><td align="center">值</td></tr><tr><td align="center">hypervisor.cpuid.v0</td><td align="center">FALSE</td></tr></tbody></table><p>此参数的作用：不让操作系统识别是在虚拟机环境运行，一般直通独立显卡需要这样设置，核显可忽略，但设置也无妨。</p><p>如下图所示：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1105053334.png" alt="2022-05-25T00:47:09.png" title="2022-05-25T00:47:09.png"><br><img src="https://blog.niekun.net/usr/uploads/2022/05/1984221498.png" alt="2022-05-25T00:47:24.png" title="2022-05-25T00:47:24.png"><br><img src="https://blog.niekun.net/usr/uploads/2022/05/323988867.png" alt="2022-05-25T00:47:35.png" title="2022-05-25T00:47:35.png"></p><p>由于虚拟机默认有一个虚拟显卡，我们又添加了一个直通显卡，现在就有了两个显卡，但我们只想要直通的显卡工作，可以在配置参数里添加一行:</p><table><thead><tr><th align="center"> </th><th align="center"> </th></tr></thead><tbody><tr><td align="center">键</td><td align="center">值</td></tr><tr><td align="center">svga.present</td><td align="center">FALSE</td></tr></tbody></table><p><img src="https://blog.niekun.net/usr/uploads/2022/05/4078790044.png" alt="2022-05-25T00:52:18.png" title="2022-05-25T00:52:18.png"></p><p>这样操作后，我们开启虚拟机后再 <code>/dev/dri</code> 目录下就只会有一个 renderD128：</p><pre><code>ls -l /dev/dri/

total 0
crw-rw---- 1 root video 226,   0 Oct 23 20:41 card0
crw-rw---- 1 root video 226, 128 Oct 23 20:41 renderD128</code></pre><p>查看 pci 设备信息：</p><pre><code>&lt;&gt; sudo lspci -v -s  04:00.0
04:00.0 VGA compatible controller: Intel Corporation HD Graphics 530 (rev 06) (prog-if 00 [VGA controller])
    Subsystem: Hewlett-Packard Company Device 82bf
    Physical Slot: 161
    Flags: bus master, fast devsel, latency 64, IRQ 67
    Memory at fc000000 (64-bit, non-prefetchable) [size=16M]
    Memory at d0000000 (64-bit, prefetchable) [size=256M]
    I/O ports at 7000 [size=64]
    Expansion ROM at &lt;unassigned&gt; [disabled]
    Capabilities: [40] Vendor Specific Information: Len=0c &lt;?&gt;
    Capabilities: [70] Express Endpoint, MSI 00
    Capabilities: [ac] MSI: Enable+ Count=1/1 Maskable- 64bit-
    Capabilities: [d0] Power Management version 2
    Capabilities: [100] Process Address Space ID (PASID)
    Capabilities: [200] Address Translation Service (ATS)
    Capabilities: [300] Page Request Interface (PRI)
    Kernel driver in use: i915
    Kernel modules: i915</code></pre><p>这样显卡就直接直通给了虚拟机，注意这样配置后包括 esxi 本身和其他虚拟机就没有显卡可用了，导致没有图形界面。</p><h3>参考链接</h3><p><a href="https://nucfans.com/p/4622.html">ESXI 7.02 Intel 核心显卡直通开启3D加速</a><br><a href="https://elatov.github.io/2018/04/esxi-65-passthrough-video-card-to-plex-vm/#disabling-primary-video-card-on-a-vm">ESXi 6.5 Passthrough Video Card/GPU to Plex VM</a><br><a href="https://www.reddit.com/r/PleX/comments/n913ui/hw_transcoding_vaapi_intel_not_working/">HW Transcoding - VAAPI - Intel not working</a><br><a href="https://techzone.vmware.com/resource/deploying-hardware-accelerated-graphics-vmware-horizon-7">Deploying Hardware-Accelerated Graphics with VMware Horizon</a><br><a href="https://www.right.com.cn/forum/thread-4045612-1-1.html">Esxi 6.7核显直通问题求教各位恩山大神</a><br><a href="https://pci-ids.ucw.cz/read/PC/8086/3e91">Name: UHD Graphics 630</a></p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/2705.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>Ubuntu 开启 RDP 远程连接</title>
<link>https://blog.niekun.net/archives/2703.html</link>
<guid>https://blog.niekun.net/archives/2703.html</guid>
<pubDate>Mon, 23 May 2022 10:18:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[之前介绍过通过安装 TightVNC vnc server 远程连接 Ubuntu 桌面的教程，Windows 下常用的是 RDP 方式远程，使用体验非常流畅，不占用带宽。Linux 下也可以通...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>之前介绍过通过安装 TightVNC vnc server 远程连接 Ubuntu 桌面的教程，Windows 下常用的是 RDP 方式远程，使用体验非常流畅，不占用带宽。Linux 下也可以通过安装 Xrdp 的方式实现 rdp 连接。</p><p>参考教程：<a href="https://blog.niekun.net/archives/2281.html">Ubuntu desktop 配置 vnc server</a></p><!--more--><p>xrdp 是对 Windows rdp 协议的开源实现。</p><h3>安装</h3><p>我的系统是 Ubuntu desktop 20.04，首先需要保证有一个已经安装的桌面环境，desktop 版默认是 genome，也可以安装其他的如 xfce：</p><pre><code>sudo apt install ubuntu-desktop</code></pre><p>安装 xrdp：</p><pre><code>sudo apt install xrdp</code></pre><p>安装完成后，xrdp 会自动启动，可以通过命令查看状态：</p><pre><code>$  sudo systemctl status xrdp
 
● xrdp.service - xrdp daemon
     Loaded: loaded (/lib/systemd/system/xrdp.service; enabled; vendor preset: enabled)
     Active: active (running) since Mon 2022-05-23 09:50:43 CST; 20min ago
       Docs: man:xrdp(8)
             man:xrdp.ini(5)
    Process: 83586 ExecStartPre=/bin/sh /usr/share/xrdp/socksetup (code=exited, status=0/SUCCESS)
    Process: 83594 ExecStart=/usr/sbin/xrdp $XRDP_OPTIONS (code=exited, status=0/SUCCESS)
   Main PID: 83595 (xrdp)
      Tasks: 2 (limit: 9459)
     Memory: 26.4M
     CGroup: /system.slice/xrdp.service
             ├─83595 /usr/sbin/xrdp
             └─83597 /usr/sbin/xrdp</code></pre><p>默认 rdp 端口为 3389.</p><h3>配置</h3><p>xrdp 安装后，会自动将一个 ssl key <code>ssl-cert-snakeoil.key</code> 放入 <code>/etc/ssl/private/</code> 文件夹，需要将 xrdp 用户添加到 ssl-cert 用户组确保 xrdp 可以读取这个 ssl key：</p><pre><code>sudo adduser xrdp ssl-cert</code></pre><p>默认配置测试访问会有黑屏问题，显示不出来界面，需要修改 <code>/etc/xrdp/startwm.sh</code> 文件，在文件最后的 <code>test -x /etc/X11/Xsession</code> 前面加入如下内容：</p><pre><code>unset DBUS_SESSION_BUS_ADDRESS
unset XDG_RUNTIME_DIR</code></pre><p>重启 xrdp 服务：</p><pre><code>sudo systemctl restart xrdp</code></pre><p>现在就可以正常通过 rdp 连接到 Ubuntu了。</p><p>在使用中，我出现了输入用户密码后停留在解锁界面无法登录进去的问题，经过查询 xdrp 目前不可以同时在多个设备上尝试登录。同时登录 xrdp 的用户如果和正常在主机上登录的是同一个用户，需要删除 <code>dbus-user-session</code> 包，用 <code>dbus-x11</code> 代替。第三点，需要保证 gdm3 运行，执行下面的命令：</p><pre><code>sudo apt remove dbus-user-session
sudo apt install dbus-x11

sudo systemctl set-default graphical
sudo systemctl isolate graphical</code></pre><p>重启 xrdp 服务：</p><pre><code>sudo systemctl restart xrdp</code></pre><p>此时应该就可以正常通过 rdp 客户端链接 ubuntu 界面了。</p><p>但是我测试发现，第一次登录进去没问题，关闭后过一会儿再次尝试链接发现卡在登录界面没反应了，尝试执行如下命令：</p><pre><code>echo xfce4-session &gt; $HOME/.xsession
chmod +x .xsession</code></pre><p>发现问题似乎解决了，但是调用的事 xfce 桌面环境。</p><h3>远程登录</h3><p>在局域网下访问比较流畅，但是在外网下发现没法达到 Windows rdp 流畅的效果。解决方法可以是在外网通过 rdp 链接一个局域网下 Windows 设备，然后在 Windows 设备下通过 rdp 链接局域网内的 ubuntu 设备。</p><h3>参考链接</h3><p><a href="https://www.tecmint.com/install-xrdp-on-ubuntu/">How to Install Xrdp on Ubuntu 20.04</a><br><a href="https://github.com/neutrinolabs/xrdp/issues/1795#issuecomment-859471779">Xrdp stuck on login, after password is entered, unblocked if I unlock from the ubuntu rdp server</a><br><a href="https://github.com/neutrinolabs/xrdp/wiki/Debian-dbus-user-session-package">Using the console and XRDP together in Debian / Ubuntu / Mint</a><br><a href="https://github.com/neutrinolabs/xrdp/issues/1412#issuecomment-730311330">XRDP session immediately closes after loggin in</a></p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/2703.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>使用曲线匹配颜色 in Photoshop</title>
<link>https://blog.niekun.net/archives/2672.html</link>
<guid>https://blog.niekun.net/archives/2672.html</guid>
<pubDate>Thu, 12 May 2022 10:36:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[之前介绍过几种色彩匹配的方法，通过对亮度、颜色、饱和度的进行匹配，也可以通过设置曲线的黑、灰、白场来匹配颜色。下面介绍通过通过提取源图像和目标图像的黑白灰色彩，然后通过曲线将他们进行色彩匹配达到...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p><img src="https://blog.niekun.net/usr/uploads/2022/05/2965344295.png" alt="2022-05-12T01:50:32.png" title="2022-05-12T01:50:32.png"><br>之前介绍过几种色彩匹配的方法，通过对亮度、颜色、饱和度的进行匹配，也可以通过设置曲线的黑、灰、白场来匹配颜色。下面介绍通过通过提取源图像和目标图像的黑白灰色彩，然后通过曲线将他们进行色彩匹配达到最终的效果。</p><p>参考教程：<br><a href="https://blog.niekun.net/archives/680.html">精细匹配颜色 in Photoshop</a><br><a href="https://blog.niekun.net/archives/691.html">简易匹配颜色 in Photoshop</a></p><p>用到的技术：曲线，拾色器</p><!--more--><p>原图如下：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/4227986356.png" alt="2022-05-12T01:52:28.png" title="2022-05-12T01:52:28.png"></p><p>我们的目标是将左边的衣服颜色转换为右边衣服的色彩。</p><p>首先在背景图层上新建两个空白图层，用来提取两人的衣服的黑白灰色彩信息：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/189434051.png" alt="2022-05-12T02:35:57.png" title="2022-05-12T02:35:57.png"></p><p>通过拾色工具分别拾取两个衣服的黑白灰部区域的色彩，并通过画笔工具记录在两个图层中，注意拾取颜色的时候设置为 3×3 或 5×5：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3544724699.png" alt="2022-05-12T02:40:27.png" title="2022-05-12T02:40:27.png"><br><img src="https://blog.niekun.net/usr/uploads/2022/05/308610655.png" alt="2022-05-12T02:40:42.png" title="2022-05-12T02:40:42.png"></p><p>新建曲线图层，放在最上方：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/2311187890.png" alt="2022-05-12T02:42:15.png" title="2022-05-12T02:42:15.png"></p><p>首先提取右侧衣服色彩 rgb 信息，快捷键 I 选择拾色工具然后按 shift + alt 键分别在三条色彩上点击，注意操作的时候要选择到最上方的图层，否则拾取的颜色会不对：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/331668660.png" alt="2022-05-12T02:48:26.png" title="2022-05-12T02:48:26.png"></p><p>可以看到面板中保存了三个点位的rgb信息，我们后续需要将左侧的三条色条匹配为这里记录的颜色。</p><p>下面在曲线图层中操作，我们需要在曲线中找到左侧三条颜色所在的位置，按 shift + ctrl 点击左侧第一条线，在曲线图层中会自动创建一个锚点就是拾取颜色所在的位置，在 rgb，red，green，blue 通道中都会有一个点：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3550273877.png" alt="2022-05-12T02:53:06.png" title="2022-05-12T02:53:06.png"><br><img src="https://blog.niekun.net/usr/uploads/2022/05/2123676973.png" alt="2022-05-12T02:53:23.png" title="2022-05-12T02:53:23.png"><br><img src="https://blog.niekun.net/usr/uploads/2022/05/451596522.png" alt="2022-05-12T02:53:44.png" title="2022-05-12T02:53:44.png"></p><p>同样的方法将左侧三条颜色都在曲线中获取锚点：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/685607622.png" alt="2022-05-12T03:01:37.png" title="2022-05-12T03:01:37.png"></p><p>我们需要在 red green blue 通道的锚点中，将 output 信息修改为目标颜色的对应通道数值，比如右侧第一条亮部 rgb 为：216，92，59。我们就将刚才每个通道的 output 信息修改为这个值：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/308199194.png" alt="2022-05-12T02:58:28.png" title="2022-05-12T02:58:28.png"></p><p>以此类推将左侧三条颜色所在锚点的 output 修改为右侧记录的颜色 rgb 值：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1412283846.png" alt="2022-05-12T03:03:41.png" title="2022-05-12T03:03:41.png"></p><p>将 reference 图层放到曲线上方，可以看到记录的两个衣服色彩的 reference 和 target 图层颜色已经完全一致了：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3872104491.png" alt="2022-05-12T03:05:13.png" title="2022-05-12T03:05:13.png"></p><p>选中拾色器工具，同样的 shift + alt 点击三个之前创建的锚点可以删除它们。</p><p>下面需要选出左侧衣服部分，临时关闭除背景外的其他图层，使用钢笔工具或其他你常用的工具提取出左侧衣服部分的选区，然后给曲线图层添加图层蒙版：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/2430549175.png" alt="2022-05-12T03:09:46.png" title="2022-05-12T03:09:46.png"></p><p>根据实际情况，可以对曲线每个锚点的位置进行微调，以达到最佳效果。</p><p>最终效果如下：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/116183390.png" alt="2022-05-12T03:15:55.png" title="2022-05-12T03:15:55.png"></p><p>以上就完成了简单的颜色匹配。</p>
]]></content:encoded>
<slash:comments>1</slash:comments>
<comments>https://blog.niekun.net/archives/2672.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>制作水坑效果 in Photoshop</title>
<link>https://blog.niekun.net/archives/2642.html</link>
<guid>https://blog.niekun.net/archives/2642.html</guid>
<pubDate>Sat, 07 May 2022 14:53:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[今天介绍给晴朗路面添加雨天水坑效果，实际效果还不错。用到的技术：vanishing point，channel，puddle texture材质。]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p><img src="https://blog.niekun.net/usr/uploads/2022/05/3454525268.png" alt="2022-05-07T06:30:42.png" title="2022-05-07T06:30:42.png"></p><p>今天介绍给晴朗路面添加雨天水坑效果，实际效果还不错。</p><p>用到的技术：vanishing point，channel，puddle texture材质。</p><!--more--><p>原图如下：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3137131938.png" alt="2022-05-07T06:34:42.png" title="2022-05-07T06:34:42.png"></p><p>首先我们创建路面部分的立体平面，选择 filter - vanishing point：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1362261339.png" alt="2022-05-07T06:36:49.png" title="2022-05-07T06:36:49.png"></p><p>点击 create plant tool：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/2812973481.png" alt="2022-05-07T06:40:46.png" title="2022-05-07T06:40:46.png"></p><p>根据路面形状，通过点击绘制出一个大致的梯形，注意如果轨迹不符合路面形状会显示为红色：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1679968172.png" alt="2022-05-07T06:42:23.png" title="2022-05-07T06:42:23.png"></p><p>拖拽线段扩展到整个路面：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3316359648.png" alt="2022-05-07T06:43:34.png" title="2022-05-07T06:43:34.png"></p><p>以上就完成了平面的构建，点击确认返回。</p><p>首先复制背景图层。</p><p>然后我们通过钢笔工具或者其他工具建立地面的选区：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1402794448.png" alt="2022-05-07T06:47:59.png" title="2022-05-07T06:47:59.png"></p><p>给复制的图层建立图层蒙版：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/951008614.png" alt="2022-05-07T06:53:54.png" title="2022-05-07T06:53:54.png"></p><p>然后解锁蒙版和图层的锁，否则后面颠倒图层蒙版也会动：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/2525946237.png" alt="2022-05-07T06:56:50.png" title="2022-05-07T06:56:50.png"></p><p>然后选中图层而不是蒙版，点击 edit - transform - flip vertical：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/4274866273.png" alt="2022-05-07T06:58:20.png" title="2022-05-07T06:58:20.png"></p><p>调整图层位置到合适：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/222031413.png" alt="2022-05-07T06:59:03.png" title="2022-05-07T06:59:03.png"></p><p>然后临时关闭路面倒影的图层，我们制作水坑的效果。</p><p>首先需要一个水坑素材图片，如下图：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1926304447.png" alt="2022-05-07T07:00:57.png" title="2022-05-07T07:00:57.png"></p><p>导入 ps 后选中材质图层，按住 ctrl 点击图层全选材质图层，点击 ctrl c 复制图层，然后就可以关闭材质图层了：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1066803471.png" alt="2022-05-07T07:02:23.png" title="2022-05-07T07:02:23.png"></p><p>新建一个空白图层，再次打开 vanishing point，按 ctrl v 复制材质图层到界面：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1408343792.png" alt="2022-05-07T07:04:18.png" title="2022-05-07T07:04:18.png"></p><p>首先按ctrl T适当缩小图像，然后拖拽图层到下方创建的平面内：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/292082319.png" alt="2022-05-07T07:05:57.png" title="2022-05-07T07:05:57.png"></p><p>按住 ctrl 拖拽图层，复制多个图层铺满整个路面：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/918686170.png" alt="2022-05-07T07:07:04.png" title="2022-05-07T07:07:04.png"></p><p>完成后点击确认返回 ps，会将填充的平面内容在新图层上：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/2386401779.png" alt="2022-05-07T07:07:33.png" title="2022-05-07T07:07:33.png"></p><p>我们需要利用涂层的黑白部分反差作为模拟水滩效果，所以首先提高图层反差，新建曲线图层并设置只影响材质图层，提高亮部：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/694459945.png" alt="2022-05-07T07:13:18.png" title="2022-05-07T07:13:18.png"></p><p>然后临时关闭其他图层，只保留材质图层：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/2252142406.png" alt="2022-05-07T07:14:17.png" title="2022-05-07T07:14:17.png"></p><p>进入通道，选择一个通道按住 ctrl 点击通道获取选区：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/4040686630.png" alt="2022-05-07T07:15:15.png" title="2022-05-07T07:15:15.png"></p><p>然后关闭材质图层，打开背景图层和路面反转图层，并将反转图层单独建立一个组：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/802640037.png" alt="2022-05-07T07:16:40.png" title="2022-05-07T07:16:40.png"></p><p>选中组，点击创建蒙版：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/2853149168.png" alt="2022-05-07T07:17:12.png" title="2022-05-07T07:17:12.png"></p><p>这样我们就有了基本效果啦。</p><p>下面微调效果，首先倒影是在路面上形成的，所以他的颜色分布也应该符合路面的色彩分布，所以我们在反转组内建立一个 gradient map 图层并锁定之影响下方图层：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/1502050116.png" alt="2022-05-07T07:20:46.png" title="2022-05-07T07:20:46.png"></p><p>修改 map 颜色，亮部选区一个路面上较量区域的色彩，同样的暗部选取一个路面较暗的区域色彩，注意选择 3×3 拾取颜色：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3742793332.png" alt="2022-05-07T07:23:13.png" title="2022-05-07T07:23:13.png"></p><p>根据情况调节 gradient map 不透明度：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3937721709.png" alt="2022-05-07T07:24:26.png" title="2022-05-07T07:24:26.png"></p><p>水坑里的倒影一般会有一定的模糊，我们先将倒影图层转换为 smart object 然后选 filter - blur galley - path blur：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/2108128443.png" alt="2022-05-07T07:26:48.png" title="2022-05-07T07:26:48.png"></p><p>根据情况可以适当加强一下饱和度，新建 vibrate 图层，调节饱和度：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/3681898173.png" alt="2022-05-07T07:28:05.png" title="2022-05-07T07:28:05.png"></p><p>最终效果对比：<br><img src="https://blog.niekun.net/usr/uploads/2022/05/145471677.png" alt="2022-05-07T07:30:20.png" title="2022-05-07T07:30:20.png"></p>
]]></content:encoded>
<slash:comments>1</slash:comments>
<comments>https://blog.niekun.net/archives/2642.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>使用线条快速进行人像高光阴影处理 in Photoshop</title>
<link>https://blog.niekun.net/archives/2631.html</link>
<guid>https://blog.niekun.net/archives/2631.html</guid>
<pubDate>Tue, 26 Apr 2022 08:54:51 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[人像面部的 dodge and burning 对提高立体感很有帮助，之前介绍过一些方法来进行这一步，比如通过灰度图层下的 overlay 混合模式配合笔刷工具，通过频率分离调整色彩图层的颜色分...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p><img src="https://blog.niekun.net/usr/uploads/2022/04/3130294525.png" alt="2022-04-26T00:28:01.png" title="2022-04-26T00:28:01.png"></p><p>人像面部的 dodge and burning 对提高立体感很有帮助，之前介绍过一些方法来进行这一步，比如通过灰度图层下的 overlay 混合模式配合笔刷工具，通过频率分离调整色彩图层的颜色分布等，下面介绍另一种简单高效的处理过程。</p><p>教程参考：<br><a href="https://blog.niekun.net/archives/2502.html">PHP频率分离处理皮肤 in Photoshop</a></p><!--more--><p>最上面的图片就是典型的人像面部光线分布情况，白色就是高光区域，黑色就是阴影区域，我们要做的就是通过曲线工具建立高光和阴影图层，然后通过笔刷根据典型亮度分布画出各自的蒙版线条，最后通过调整蒙版羽化程度调整效果。</p><p>使用到的技术：曲线，蒙版，蒙版属性</p><p>原图如下：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/4292688247.png" alt="2022-04-26T00:39:05.png" title="2022-04-26T00:39:05.png"></p><p>建立一个曲线图层 burning，降低亮度：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/1824541112.png" alt="2022-04-26T00:40:01.png" title="2022-04-26T00:40:01.png"></p><p>反转图层蒙版，待后续使用：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/2146239759.png" alt="2022-04-26T00:40:50.png" title="2022-04-26T00:40:50.png"></p><p>类似的方法再次建立一个曲线 dodging，提高亮度：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/2384595311.png" alt="2022-04-26T00:41:42.png" title="2022-04-26T00:41:42.png"></p><p>反转图层蒙版：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/3794425381.png" alt="2022-04-26T00:42:08.png" title="2022-04-26T00:42:08.png"></p><p>下面就可以通过画笔工具根据标准模板分别在两个曲线图层画出高光和阴影线条，<strong>注意这里需要使用硬笔刷</strong>：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/4100894395.png" alt="2022-04-26T00:47:12.png" title="2022-04-26T00:47:12.png"></p><p>然后就是重点了，进入蒙版属性，调整羽化值，使效果达到合适状态：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/1410222056.png" alt="2022-04-26T00:48:35.png" title="2022-04-26T00:48:35.png"><br><img src="https://blog.niekun.net/usr/uploads/2022/04/3280114636.png" alt="2022-04-26T00:49:07.png" title="2022-04-26T00:49:07.png"></p><p>最后可以将两个图层合并为组，根据情况调整不透明度。</p><p>最终效果对比：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/564281209.png" alt="2022-04-26T00:52:47.png" title="2022-04-26T00:52:47.png"></p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/2631.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
<item>
<title>使用高斯模糊锐化图片 in Photoshop</title>
<link>https://blog.niekun.net/archives/2629.html</link>
<guid>https://blog.niekun.net/archives/2629.html</guid>
<pubDate>Wed, 13 Apr 2022 10:01:00 +0800</pubDate>
<dc:creator>admin</dc:creator>
<description><![CDATA[之前介绍过几种锐化方法：smart sharpen 配合 darken 和 lighten 混合模式通过 overlay 配合 high pass 的方式锐化通过频率分离，复制 texture ...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<p>之前介绍过几种锐化方法：</p><ul><li>smart sharpen 配合 darken 和 lighten 混合模式</li><li>通过 overlay 配合 high pass 的方式锐化</li><li>通过频率分离，复制 texture 图层的方式</li></ul><p>下面介绍另一种通过 vivid light 配合高斯模糊的方式锐化且效果很好。</p><!--more--><p>首先复制两份原图，改名为 normal 和 vivid light：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/2371117545.png" alt="2022-04-13T01:54:48.png" title="2022-04-13T01:54:48.png"></p><p>将 vivid light 图层 ctr I 反转图像，然后混合模式修改为 vivid light，并将图层设置为 smart object 方便后期调整：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/3057092689.png" alt="2022-04-13T01:55:53.png" title="2022-04-13T01:55:53.png"></p><p>vivid 图层选择高斯模糊，调整数值到能够提取出细节：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/1396839348.png" alt="2022-04-13T01:57:28.png" title="2022-04-13T01:57:28.png"></p><p>将 vivid 和 normal 图层合并为一个组，将组的混合模式修改为 overlay：<br><img src="https://blog.niekun.net/usr/uploads/2022/04/3392384066.png" alt="2022-04-13T01:59:25.png" title="2022-04-13T01:59:25.png"></p><p>这样整个图像就锐化了，根据实际情况配合蒙版调整锐化区域。</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://blog.niekun.net/archives/2629.html#comments</comments>
<wfw:commentRss>https://blog.niekun.net/feed/</wfw:commentRss>
</item>
</channel>
</rss>