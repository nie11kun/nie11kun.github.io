<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>openwrt network 配置 - Marco Nie</title>
<link rel="icon" href="https://niekun.net/favicon.ico" sizes="192x192" />
<link href="../usr/themes/Single/static/kico.css" rel="stylesheet" type="text/css" />
<link href="../usr/themes/Single/static/single.css" rel="stylesheet" type="text/css" />
<link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1" />
<meta property="og:site_name" content="Marco Nie">
<meta property="og:title" content="openwrt network 配置" />
<meta name="description" content="openwrt 适合作为路由器系统使用，我们的路由器上一般会有多个网卡接口可供使用，其中一个作为 wan 口来连接外网，其他的可以作为 lan 口连接本地设备。在默认的 network 配置文件..." />
<link rel="alternate" type="application/rss+xml" title="openwrt network 配置 &raquo; Marco Nie &raquo; RSS 2.0" href="../feed/archives/2291.html" />
<link rel="alternate" type="application/rdf+xml" title="openwrt network 配置 &raquo; Marco Nie &raquo; RSS 1.0" href="../feed/rss/archives/2291.html" />
<link rel="alternate" type="application/atom+xml" title="openwrt network 配置 &raquo; Marco Nie &raquo; ATOM 1.0" href="../feed/atom/archives/2291.html" />
<script type="b8aa9c43df5aece254c76dbb-text/javascript">
(function () {
    window.TypechoComment = {
        dom : function (id) {
            return document.getElementById(id);
        },
    
        create : function (tag, attr) {
            var el = document.createElement(tag);
        
            for (var key in attr) {
                el.setAttribute(key, attr[key]);
            }
        
            return el;
        },

        reply : function (cid, coid) {
            var comment = this.dom(cid), parent = comment.parentNode,
                response = this.dom('respond-post-2291'), input = this.dom('comment-parent'),
                form = 'form' == response.tagName ? response : response.getElementsByTagName('form')[0],
                textarea = response.getElementsByTagName('textarea')[0];

            if (null == input) {
                input = this.create('input', {
                    'type' : 'hidden',
                    'name' : 'parent',
                    'id'   : 'comment-parent'
                });

                form.appendChild(input);
            }

            input.setAttribute('value', coid);

            if (null == this.dom('comment-form-place-holder')) {
                var holder = this.create('div', {
                    'id' : 'comment-form-place-holder'
                });

                response.parentNode.insertBefore(holder, response);
            }

            comment.appendChild(response);
            this.dom('cancel-comment-reply-link').style.display = '';

            if (null != textarea && 'text' == textarea.name) {
                textarea.focus();
            }

            return false;
        },

        cancelReply : function () {
            var response = this.dom('respond-post-2291'),
            holder = this.dom('comment-form-place-holder'), input = this.dom('comment-parent');

            if (null != input) {
                input.parentNode.removeChild(input);
            }

            if (null == holder) {
                return true;
            }

            this.dom('cancel-comment-reply-link').style.display = 'none';
            holder.parentNode.insertBefore(response, holder);
            return false;
        }
    };
})();
</script>
<script type="b8aa9c43df5aece254c76dbb-text/javascript">
(function () {
    var event = document.addEventListener ? {
        add: 'addEventListener',
        triggers: ['scroll', 'mousemove', 'keyup', 'touchstart'],
        load: 'DOMContentLoaded'
    } : {
        add: 'attachEvent',
        triggers: ['onfocus', 'onmousemove', 'onkeyup', 'ontouchstart'],
        load: 'onload'
    }, added = false;

    document[event.add](event.load, function () {
        var r = document.getElementById('respond-post-2291'),
            input = document.createElement('input');
        input.type = 'hidden';
        input.name = '_';
        input.value = (function () {
    var _zcoF = //'tb'
'9'+'b'//'ETh'
+'a'//'g'
+/* 'D4c'//'D4c' */''+'6'//'UO1'
+'87'//'ia'
+//'eu'
'c06'+'5d8'//'Uvm'
+//'S2'
'2'+'487'//'av'
+'6'//'T'
+'b8'//'x9a'
+//'o'
'd36'+'ae'//'U1'
+//'E9X'
'7b9'+//'A'
'33'+//'yx'
'4'+/* 'y'//'y' */''+//'vl'
'b'+//'H'
'1', _ZmNjd = [];
    
    for (var i = 0; i < _ZmNjd.length; i ++) {
        _zcoF = _zcoF.substring(0, _ZmNjd[i][0]) + _zcoF.substring(_ZmNjd[i][1]);
    }

    return _zcoF;
})();

        if (null != r) {
            var forms = r.getElementsByTagName('form');
            if (forms.length > 0) {
                function append() {
                    if (!added) {
                        forms[0].appendChild(input);
                        added = true;
                    }
                }
            
                for (var i = 0; i < event.triggers.length; i ++) {
                    var trigger = event.triggers[i];
                    document[event.add](trigger, append);
                    window[event.add](trigger, append);
                }
            }
        }
    });
})();
</script></head>
<body>
<header>
<div class="head-title">
<h4>Marco Nie</h4>
</div>
<div class="head-action">
<div class="toggle-btn"></div>
<div class="light-btn"></div>
<div class="search-btn"></div>
</div>
<form class="head-search" method="post">
<input type="text" name="s" placeholder="搜索什么？">
</form>
<nav class="head-menu">
<a href="../index.html">首页</a>
<div class="has-child">
<a>分类</a>
<div class="sub-menu">
<a href="../category/Linux/index.html">Linux</a><a href="../category/ubuntu/index.html">ubuntu</a><a href="../category/photo/index.html">Photograph</a><a href="../category/media/index.html">media process</a><a href="../category/ps/index.html">photoshop</a><a href="../category/fxp/index.html">final cut pro</a><a href="../category/lr/index.html">lightroom</a><a href="../category/c4d/index.html">cinema 4D</a><a href="../category/Windows/index.html">Windows</a><a href="../category/macos/index.html">macOS</a><a href="../category/hardware/index.html">hardware</a><a href="../category/router/index.html">router</a><a href="../category/a73/index.html">SONY A7M3</a><a href="../category/essay/index.html">essay</a><a href="../category/other/index.html">other</a><a href="../category/dev/index.html">Development</a><a href="../category/cpp/index.html">c++</a><a href="../category/py/index.html">python</a><a href="../category/go/index.html">go</a><a href="../category/siemens/index.html">siemens</a><a href="../category/web/index.html">web</a><a href="../category/html/index.html">html</a><a href="../category/css/index.html">css</a><a href="../category/js/index.html">javascript</a><a href="../category/node/index.html">node.js</a><a href="../category/react/index.html">react</a><a href="../category/software/index.html">software</a> </div>
</div>
<a href="../start-page.html">关于我</a> </nav>
</header>
<main>
<div class="wrap min">
<section class="post-title">
<h2>openwrt network 配置</h2>
<div class="post-meta">
<time class="date">2021-04-10</time>
<span class="category"><a href="../category/Linux/index.html">Linux</a></span>
<span class="comments">0</span>
</div>
</section>
<article class="post-content">
<blockquote>这篇文章上次修改于 230 天前，可能其部分内容已经发生变化，如有疑问可询问作者。</blockquote>
<p>openwrt 适合作为路由器系统使用，我们的路由器上一般会有多个网卡接口可供使用，其中一个作为 wan 口来连接外网，其他的可以作为 lan 口连接本地设备。</p><p>在默认的 network 配置文件中 lan 内只绑定了一个网卡，也就是只有一个接口可以连接到 lan 网络，下面介绍如何配置多个网卡通过桥接的方式共享 lan 网络。这样可以实现无论将设备接入哪一个网卡都可以连接到同一个 lan。</p><p>下面是一个默认的 <code>/etc/config/network</code> 文件内容：</p><pre><code>&quot;/etc/config/network&quot;

config interface 'loopback'
        option ifname 'lo'
        option proto 'static'
        option ipaddr '127.0.0.1'
        option netmask '255.0.0.0'

config globals 'globals'
        option ula_prefix 'fd6e:929e:e9ab::/48'

config interface 'lan'
        option ifname 'eth0'
        option proto 'static'
        option ipaddr '192.168.85.1'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '27.168.1.1'

config interface 'wan'
        option ifname 'eth1'
        option proto 'dhcp'

config interface 'wan6'
        option ifname 'eth1'
        option proto 'dhcpv6'</code></pre><p>可以看到默认配置了 lan 和 wan 网络，各自分配了一个网卡 eth0 和 eth1，其中 eth0 属于 lan 网络且设置了 static 静态地址，作为内网的网关，<strong>注意 lan 的 downlink 下级链接会自动开启 dhcp 服务</strong>，所以通过 eth0 连接的设备可以自动获取到地址。eth1 属于 wan 网络且配置为 dhcp 自动获取 ip 地址，作为连接外网使用。</p><p>以上默认的 network 配置包含了 global 配置块和 <strong>loopback</strong>，<strong>lan</strong>，<strong>wan</strong> interface 的配置块。这也是最基本的需要配置的网络设置。</p><p>关于 network 配置文件的结构参考：<a href="https://openwrt.org/docs/guide-user/base-system/basic-networking">Network basics /etc/config/network</a></p><p>interfaces 配置块定义了对应 interface 具体连接的物理网卡名称和协议类型，通过 <strong>option</strong> 来定义这个 interface 具体参数。</p><p>一个最基本的 interface 配置项需要包含 <strong>proto 协议类型</strong>和 <strong>ifname 网卡名称</strong>，例如：</p><pre><code>config 'interface' 'wan'
        option 'proto' 'dhcp'
        option 'ifname' 'eth0.2'</code></pre><ul><li>wan 表示这个 interface 名称</li><li>dhcp 表示协议类型</li><li>eth0.2 表示绑定的物理网卡名称</li></ul><p>常用的 proto 协议类型有：</p><pre><code>static    Static configuration with fixed address and netmask    ip/ifconfig
dhcp    Address and netmask are assigned by DHCP    udhcpc (Busybox)
dhcpv6    Address and netmask are assigned by DHCPv6    odhcpc6c
ppp    PPP protocol - dialup modem connections    pppd
pppoe    PPP over Ethernet - DSL broadband connection    pppd + plugin rp-pppoe.so
pppoa    PPP over ATM - DSL connection using a builtin modem    pppd + plugin …</code></pre><p>更多协议介绍：<a href="https://openwrt.org/docs/guide-user/base-system/basic-networking#interfaces">interface</a></p><p>配置了协议后需要定义详细的 option 选项参数，下面是常用的适用于所有类型协议的 option 可选项：</p><table><thead><tr><th align="center">Name</th><th align="center">Type</th><th>Default Description</th></tr></thead><tbody><tr><td align="center">ifname</td><td align="center">物理网卡名称</td><td>如eth0 eth1 eth2，当定义 type 为 bridge 桥接时，可以是一个集合</td></tr><tr><td align="center">type</td><td align="center">字符串</td><td>如果设置为 bridge，会桥接在 ifname 中定义的物理网卡名称集合</td></tr><tr><td align="center">stp</td><td align="center">boolean</td><td>Only valid for type bridge, enables the Spanning Tree Protocol</td></tr><tr><td align="center">bridge_empty</td><td align="center">boolean</td><td>Only valid for type bridge, enables creating empty bridges</td></tr><tr><td align="center">igmp_snooping</td><td align="center">boolean</td><td>Only valid for type bridge, sets the multicast_snooping kernel setting for a bridge</td></tr><tr><td align="center">macaddr</td><td align="center">mac地址</td><td>Override MAC address of this interface. Example: 62:11:22:aa:bb:cc</td></tr><tr><td align="center">mtu</td><td align="center">number</td><td>Override the default MTU on this interface</td></tr></tbody></table><p>具体到某个 proto 协议会有各自特殊需要定义的 option 参数，下面介绍 static 模式下需要定义的参数：</p><table><thead><tr><th align="center">名称</th><th align="center">类型</th><th>描述</th></tr></thead><tbody><tr><td align="center">ipaddr</td><td align="center">ip address</td><td>IP address</td></tr><tr><td align="center">netmask</td><td align="center">netmask</td><td>子网掩码</td></tr><tr><td align="center">gateway</td><td align="center">ip address</td><td>Default gateway</td></tr><tr><td align="center">broadcast</td><td align="center">ip address</td><td>Broadcast address (autogenerated if not set)</td></tr><tr><td align="center">dns</td><td align="center">list of ip addresses</td><td>DNS server(s)</td></tr><tr><td align="center">dns_search</td><td align="center">list of domain names</td><td>Search list for host-name lookup</td></tr><tr><td align="center">metric</td><td align="center">integer</td><td>Specifies the default route metric to use</td></tr></tbody></table><p>关于 proto 协议的配置项参考：<a href="https://openwrt.org/docs/guide-user/network/ipv4/start#protocol_static_ipv4">openwrt IPv4</a></p><h3>示例</h3><p>下面通过示例来介绍一些典型配置模式。</p><p>lan 网络的 Downstream 下层流量配置：</p><pre><code>config interface 'lan'
        option ifname 'eth1'
        option proto 'static'
        option ipaddr '192.168.85.1'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '27.168.1.1'</code></pre><p>lan 网络的下层链接会自动启用 dhcp 服务。</p><p>lan 网络配置多网卡桥接模式：</p><pre><code>config interface 'lan'
        option type 'bridge'
        option ifname 'eth1 eth2 eth3'
        option proto 'static'
        option ipaddr '192.168.85.1'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '27.168.1.1'
        option dns '1.1.1.1'</code></pre><p>多 dns 配置：</p><pre><code>config interface 'example'
        option proto     'static'
        option ifname    'eth0'
        option ipaddr    '192.168.1.200'
        option netmask   '255.255.255.0'
        list   dns       '192.168.1.1'
        list   dns       '192.168.10.1'</code></pre><h3>参考链接</h3><p><a href="https://openwrt.org/docs/guide-user/base-system/basic-networking#interfaces">interface</a><br><a href="https://openwrt.org/docs/guide-user/network/ipv4/start#protocol_static_ipv4">IPv4</a></p> </article>
<section class="post-near">
<ul>
<li>上一篇: <a href="2290.html" title="通过 GitHub API 获取数据">通过 GitHub API 获取数据</a></li>
<li>下一篇: <a href="2294.html" title=" openwrt 时区设置"> openwrt 时区设置</a></li>
</ul>
</section>
<section class="post-comments">
<h3>没有评论</h3>
<div class="comment-form" id="respond-post-2291">
<span class="cancel-comment-reply">
<a id="cancel-comment-reply-link" href="2291.html#respond-post-2291" rel="nofollow" style="display:none" onclick="if (!window.__cfRLUnblockHandlers) return false; return TypechoComment.cancelReply();" data-cf-modified-b8aa9c43df5aece254c76dbb-="">取消回复</a> </span>
<form method="post" action="https://blog.niekun.net/archives/2291.html/comment" role="form">
<div class="row">
<fieldset class="col-m-6">
<input type="text" name="author" placeholder="昵称 *：" value="" required>
<input type="email" name="mail" placeholder="电邮 *：" value="" required>
<input type="url" name="url" placeholder="http://" value="">
</fieldset>
<fieldset class="col-m-6">
<textarea rows="3" name="text" id="textarea" placeholder="快来评论吧 (*≧ω≦)ﾉ" required></textarea>
<button type="submit" class="btn">写好了~</button>
</fieldset>
</div>
</form>
</div>
</section> </div>
</main>
<footer>
<div class="buttons">
<a class="to-top" href="2291.html#"></a>
</div>
<div class="wrap min">
<section class="widget">
<div class="row">
<div class="col-m-4">
<h3 class="title-recent">最新文章：</h3>
<ul>
<li><a href="2352.html" target="_blank">常用校验类正则表达式大全</a></li><li><a href="2348.html" target="_blank">PT 下载时停留在 99% 问题处理</a></li><li><a href="2340.html" target="_blank">解除 Windows 11 TPM 或 CPU 限制</a></li><li><a href="2330.html" target="_blank">828D 执行程序提示：等待插补缓冲</a></li><li><a href="2329.html" target="_blank">React 入门教程之九 -- composition 模块化 和 inheritance 继承</a></li><li><a href="2324.html" target="_blank">React 入门教程之八 -- Lifting State Up 提升 state 层级</a></li> </ul>
</div>
<div class="col-m-4">
<h3 class="title-date">时光机：</h3>
<ul>
<li><a href="../2021/11/index.html" rel="nofollow" target="_blank">2021 年 11 月</a></li><li><a href="../2021/10/index.html" rel="nofollow" target="_blank">2021 年 10 月</a></li><li><a href="../2021/09/index.html" rel="nofollow" target="_blank">2021 年 09 月</a></li><li><a href="../2021/08/index.html" rel="nofollow" target="_blank">2021 年 08 月</a></li><li><a href="../2021/06/index.html" rel="nofollow" target="_blank">2021 年 06 月</a></li><li><a href="../2021/05/index.html" rel="nofollow" target="_blank">2021 年 05 月</a></li> </ul>
</div>
<div class="col-m-4">
<h3 class="title-comments">最近评论：</h3>
<ul>
<li>admin: <a href="1640.html#comment-41" rel="nofollow" target="_blank">paralle...</a></li>
<li>unswimmingfish: <a href="1640.html#comment-40" rel="nofollow" target="_blank">macbook...</a></li>
<li>marco nie: <a href="1680.html#comment-39" rel="nofollow" target="_blank">给一个文件添加...</a></li>
<li>ch: <a href="1680.html#comment-38" rel="nofollow" target="_blank">你好我想请问一...</a></li>
<li>ahxinny: <a href="2330.html#comment-32" rel="nofollow" target="_blank">在endwhi...</a></li>
<li>ahxinny: <a href="2330.html#comment-31" rel="nofollow" target="_blank">一个问题是系统...</a></li>
</ul>
</div>
</div>
</section>
<section class="sub-footer">
<p>© 2021 <a href="../index.html">Marco Nie</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Single" target="_blank" rel="nofollow">Single</a>.</p>
</section>
</div>
</footer>
<script src="../usr/themes/Single/static/kico.js" type="b8aa9c43df5aece254c76dbb-text/javascript"></script>
<script src="../usr/themes/Single/static/single.js" type="b8aa9c43df5aece254c76dbb-text/javascript"></script>
<script src="../usr/themes/Single/static/prism.js" type="b8aa9c43df5aece254c76dbb-text/javascript"></script>
<script type="b8aa9c43df5aece254c76dbb-text/javascript">var single = new Paul_Single({copyright: false, night: true});</script>
<script src="../cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="b8aa9c43df5aece254c76dbb-|49" defer=""></script></body>
</html>