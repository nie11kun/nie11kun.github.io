<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>openwrt network 配置 - Marco Nie</title>
<link rel="icon" href="https://niekun.net/favicon.ico" sizes="192x192" />
<link href="../usr/themes/Single/static/kico.css" rel="stylesheet" type="text/css" />
<link href="../usr/themes/Single/static/single.css" rel="stylesheet" type="text/css" />
<link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1" />
<meta property="og:site_name" content="Marco Nie">
<meta property="og:title" content="openwrt network 配置" />
<meta name="description" content="openwrt 适合作为路由器系统使用，我们的路由器上一般会有多个网卡接口可供使用，其中一个作为 wan 口来连接外网，其他的可以作为 lan 口连接本地设备。在默认的 network 配置文件..." />
<link rel="alternate" type="application/rss+xml" title="openwrt network 配置 &raquo; Marco Nie &raquo; RSS 2.0" href="../feed/archives/2291.html" />
<link rel="alternate" type="application/rdf+xml" title="openwrt network 配置 &raquo; Marco Nie &raquo; RSS 1.0" href="../feed/rss/archives/2291.html" />
<link rel="alternate" type="application/atom+xml" title="openwrt network 配置 &raquo; Marco Nie &raquo; ATOM 1.0" href="../feed/atom/archives/2291.html" />
<script type="3c2e70d438aecb30be36039b-text/javascript">
(function () {
    window.TypechoComment = {
        dom : function (id) {
            return document.getElementById(id);
        },
    
        create : function (tag, attr) {
            var el = document.createElement(tag);
        
            for (var key in attr) {
                el.setAttribute(key, attr[key]);
            }
        
            return el;
        },

        reply : function (cid, coid) {
            var comment = this.dom(cid), parent = comment.parentNode,
                response = this.dom('respond-post-2291'), input = this.dom('comment-parent'),
                form = 'form' == response.tagName ? response : response.getElementsByTagName('form')[0],
                textarea = response.getElementsByTagName('textarea')[0];

            if (null == input) {
                input = this.create('input', {
                    'type' : 'hidden',
                    'name' : 'parent',
                    'id'   : 'comment-parent'
                });

                form.appendChild(input);
            }

            input.setAttribute('value', coid);

            if (null == this.dom('comment-form-place-holder')) {
                var holder = this.create('div', {
                    'id' : 'comment-form-place-holder'
                });

                response.parentNode.insertBefore(holder, response);
            }

            comment.appendChild(response);
            this.dom('cancel-comment-reply-link').style.display = '';

            if (null != textarea && 'text' == textarea.name) {
                textarea.focus();
            }

            return false;
        },

        cancelReply : function () {
            var response = this.dom('respond-post-2291'),
            holder = this.dom('comment-form-place-holder'), input = this.dom('comment-parent');

            if (null != input) {
                input.parentNode.removeChild(input);
            }

            if (null == holder) {
                return true;
            }

            this.dom('cancel-comment-reply-link').style.display = 'none';
            holder.parentNode.insertBefore(response, holder);
            return false;
        }
    };
})();
</script>
<script type="3c2e70d438aecb30be36039b-text/javascript">
(function () {
    var event = document.addEventListener ? {
        add: 'addEventListener',
        triggers: ['scroll', 'mousemove', 'keyup', 'touchstart'],
        load: 'DOMContentLoaded'
    } : {
        add: 'attachEvent',
        triggers: ['onfocus', 'onmousemove', 'onkeyup', 'ontouchstart'],
        load: 'onload'
    }, added = false;

    document[event.add](event.load, function () {
        var r = document.getElementById('respond-post-2291'),
            input = document.createElement('input');
        input.type = 'hidden';
        input.name = '_';
        input.value = (function () {
    var _7FS = /* 'l'//'l' */''+'9b'//'s1'
+//'LZZ'
'LZZ'+'a68'//'U'
+'7c0'//'HHi'
+//'0'
'65'+'d82'//'GG'
+'487'//'FP'
+'6b'//'ZZ'
+'8'//'Z'
+//'ROz'
'd'+'36'//'lko'
+//'ao'
'ae'+//'pJ'
'7b9'+//'6B'
'3'+//'5X'
'34b'+'Da'//'Da'
+''///*'RD'*/'RD'
+/* 'qM'//'qM' */''+//'3'
'3'+'e7l'//'e7l'
+//'c'
'1', _8Qc = [[2,5],[31,33],[31,32],[31,34]];
    
    for (var i = 0; i < _8Qc.length; i ++) {
        _7FS = _7FS.substring(0, _8Qc[i][0]) + _7FS.substring(_8Qc[i][1]);
    }

    return _7FS;
})();

        if (null != r) {
            var forms = r.getElementsByTagName('form');
            if (forms.length > 0) {
                function append() {
                    if (!added) {
                        forms[0].appendChild(input);
                        added = true;
                    }
                }
            
                for (var i = 0; i < event.triggers.length; i ++) {
                    var trigger = event.triggers[i];
                    document[event.add](trigger, append);
                    window[event.add](trigger, append);
                }
            }
        }
    });
})();
</script><link rel="stylesheet" href="../usr/plugins/YoduBGM/css/player.css"><style>@media only screen and (max-width:766px){.ymusic{display:none}}</style>
</head>
<body>
<header>
<div class="head-title">
<h4>Marco Nie</h4>
</div>
<div class="head-action">
<div class="toggle-btn"></div>
<div class="light-btn"></div>
<div class="search-btn"></div>
</div>
<form class="head-search" method="post">
<input type="text" name="s" placeholder="搜索什么？">
</form>
<nav class="head-menu">
<a href="../index.html">首页</a>
<div class="has-child">
<a>分类</a>
<div class="sub-menu">
<a href="../category/Linux/index.html">Linux</a><a href="../category/ubuntu/index.html">ubuntu</a><a href="../category/photo/index.html">Photograph</a><a href="../category/media/index.html">media process</a><a href="../category/ps/index.html">photoshop</a><a href="../category/fxp/index.html">final cut pro</a><a href="../category/lr/index.html">lightroom</a><a href="../category/c4d/index.html">cinema 4D</a><a href="../category/Windows/index.html">Windows</a><a href="../category/macos/index.html">macOS</a><a href="../category/hardware/index.html">hardware</a><a href="../category/router/index.html">router</a><a href="../category/a73/index.html">SONY A7M3</a><a href="../category/essay/index.html">essay</a><a href="../category/other/index.html">other</a><a href="../category/dev/index.html">Development</a><a href="../category/cpp/index.html">c++</a><a href="../category/py/index.html">python</a><a href="../category/go/index.html">go</a><a href="../category/siemens/index.html">siemens</a><a href="../category/web/index.html">web</a><a href="../category/html/index.html">html</a><a href="../category/css/index.html">css</a><a href="../category/js/index.html">javascript</a><a href="../category/node/index.html">node.js</a><a href="../category/react/index.html">react</a><a href="../category/software/index.html">software</a> </div>
</div>
<a href="../start-page.html">关于我</a> </nav>
</header>
<main>
<div class="wrap min">
<section class="post-title">
<h2>openwrt network 配置</h2>
<div class="post-meta">
<time class="date">2021-04-10</time>
<span class="category"><a href="../category/Linux/index.html">Linux</a></span>
<span class="comments">0</span>
</div>
</section>
<article class="post-content">
<blockquote>这篇文章上次修改于 182 天前，可能其部分内容已经发生变化，如有疑问可询问作者。</blockquote>
<div id="md_content_2" class="md_content" style="min-height: 50px;"><textarea id="append-test" style="display:none;">openwrt 适合作为路由器系统使用，我们的路由器上一般会有多个网卡接口可供使用，其中一个作为 wan 口来连接外网，其他的可以作为 lan 口连接本地设备。

在默认的 network 配置文件中 lan 内只绑定了一个网卡，也就是只有一个接口可以连接到 lan 网络，下面介绍如何配置多个网卡通过桥接的方式共享 lan 网络。这样可以实现无论将设备接入哪一个网卡都可以连接到同一个 lan。


<!--more-->

下面是一个默认的 `/etc/config/network` 文件内容：
```
"/etc/config/network"

config interface 'loopback'
        option ifname 'lo'
        option proto 'static'
        option ipaddr '127.0.0.1'
        option netmask '255.0.0.0'

config globals 'globals'
        option ula_prefix 'fd6e:929e:e9ab::/48'

config interface 'lan'
        option ifname 'eth0'
        option proto 'static'
        option ipaddr '192.168.85.1'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '27.168.1.1'

config interface 'wan'
        option ifname 'eth1'
        option proto 'dhcp'

config interface 'wan6'
        option ifname 'eth1'
        option proto 'dhcpv6'
```

可以看到默认配置了 lan 和 wan 网络，各自分配了一个网卡 eth0 和 eth1，其中 eth0 属于 lan 网络且设置了 static 静态地址，作为内网的网关，**注意 lan 的 downlink 下级链接会自动开启 dhcp 服务**，所以通过 eth0 连接的设备可以自动获取到地址。eth1 属于 wan 网络且配置为 dhcp 自动获取 ip 地址，作为连接外网使用。

以上默认的 network 配置包含了 global 配置块和 **loopback**，**lan**，**wan** interface 的配置块。这也是最基本的需要配置的网络设置。

关于 network 配置文件的结构参考：[Network basics /etc/config/network](https://openwrt.org/docs/guide-user/base-system/basic-networking)

interfaces 配置块定义了对应 interface 具体连接的物理网卡名称和协议类型，通过 **option** 来定义这个 interface 具体参数。

一个最基本的 interface 配置项需要包含 **proto 协议类型**和 **ifname 网卡名称**，例如：
```
config 'interface' 'wan'
        option 'proto' 'dhcp'
        option 'ifname' 'eth0.2'
```

- wan 表示这个 interface 名称
- dhcp 表示协议类型
- eth0.2 表示绑定的物理网卡名称

常用的 proto 协议类型有：
```
static	Static configuration with fixed address and netmask	ip/ifconfig
dhcp	Address and netmask are assigned by DHCP	udhcpc (Busybox)
dhcpv6	Address and netmask are assigned by DHCPv6	odhcpc6c
ppp	PPP protocol - dialup modem connections	pppd
pppoe	PPP over Ethernet - DSL broadband connection	pppd + plugin rp-pppoe.so
pppoa	PPP over ATM - DSL connection using a builtin modem	pppd + plugin …
```

更多协议介绍：[interface](https://openwrt.org/docs/guide-user/base-system/basic-networking#interfaces)

配置了协议后需要定义详细的 option 选项参数，下面是常用的适用于所有类型协议的 option 可选项：
|Name|Type|Default Description|
|:--:|:--:|
|ifname |         物理网卡名称 | 如eth0 eth1 eth2，当定义 type 为 bridge 桥接时，可以是一个集合
|type    |        字符串     |  如果设置为 bridge，会桥接在 ifname 中定义的物理网卡名称集合
|stp      |       boolean	|     Only valid for type bridge, enables the Spanning Tree Protocol
|bridge_empty	|boolean	 |    Only valid for type bridge, enables creating empty bridges
|igmp_snooping	|boolean	  |   Only valid for type bridge, sets the multicast_snooping kernel setting for a bridge
|macaddr    | mac地址 | Override MAC address of this interface. Example: 62:11:22:aa:bb:cc
|mtu	|number| Override the default MTU on this interface
  
具体到某个 proto 协议会有各自特殊需要定义的 option 参数，下面介绍 static 模式下需要定义的参数：
|名称|类型|描述
|:--:|:--:|
|ipaddr	|ip address	|IP address
|netmask|netmask	|子网掩码
|gateway|ip address	|Default gateway
|broadcast|ip address	|Broadcast address (autogenerated if not set)
|dns	|list of ip addresses	|DNS server(s)
|dns_search	|list of domain names	|Search list for host-name lookup
|metric	|integer	|Specifies the default route metric to use

关于 proto 协议的配置项参考：[openwrt IPv4](https://openwrt.org/docs/guide-user/network/ipv4/start#protocol_static_ipv4)

### 示例

下面通过示例来介绍一些典型配置模式。

lan 网络的 Downstream 下层流量配置：
```
config interface 'lan'
        option ifname 'eth1'
        option proto 'static'
        option ipaddr '192.168.85.1'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '27.168.1.1'
```

lan 网络的下层链接会自动启用 dhcp 服务。

lan 网络配置多网卡桥接模式：
```
config interface 'lan'
        option type 'bridge'
        option ifname 'eth1 eth2 eth3'
        option proto 'static'
        option ipaddr '192.168.85.1'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '27.168.1.1'
        option dns '1.1.1.1'
```

多 dns 配置：
```
config interface 'example'
        option proto     'static'
        option ifname    'eth0'
        option ipaddr    '192.168.1.200'
        option netmask   '255.255.255.0'
        list   dns       '192.168.1.1'
        list   dns       '192.168.10.1'
```

### 参考链接

[interface](https://openwrt.org/docs/guide-user/base-system/basic-networking#interfaces)
[IPv4](https://openwrt.org/docs/guide-user/network/ipv4/start#protocol_static_ipv4)






</textarea></div> </article>
<section class="post-near">
<ul>
<li>上一篇: <a href="2290.html" title="通过 GitHub API 获取数据">通过 GitHub API 获取数据</a></li>
<li>下一篇: <a href="2294.html" title=" openwrt 时区设置"> openwrt 时区设置</a></li>
</ul>
</section>
<section class="post-comments">
<h3>没有评论</h3>
<div class="comment-form" id="respond-post-2291">
<span class="cancel-comment-reply">
<a id="cancel-comment-reply-link" href="2291.html#respond-post-2291" rel="nofollow" style="display:none" onclick="if (!window.__cfRLUnblockHandlers) return false; return TypechoComment.cancelReply();" data-cf-modified-3c2e70d438aecb30be36039b-="">取消回复</a> </span>
<form method="post" action="https://blog.niekun.net/archives/2291.html/comment" role="form">
<div class="row">
<fieldset class="col-m-6">
<input type="text" name="author" placeholder="昵称 *：" value="" required>
<input type="email" name="mail" placeholder="电邮 *：" value="" required>
<input type="url" name="url" placeholder="http://" value="">
</fieldset>
<fieldset class="col-m-6">
<textarea rows="3" name="text" id="textarea" placeholder="快来评论吧 (*≧ω≦)ﾉ" required></textarea>
<button type="submit" class="btn">写好了~</button>
</fieldset>
</div>
</form>
</div>
</section> </div>
</main>
<footer>
<div class="buttons">
<a class="to-top" href="2291.html#"></a>
</div>
<div class="wrap min">
<section class="widget">
<div class="row">
<div class="col-m-4">
<h3 class="title-recent">最新文章：</h3>
<ul>
<li><a href="2340.html" target="_blank">解除 Windows 11 TPM 或 CPU 限制</a></li><li><a href="2330.html" target="_blank">828D 执行程序提示：等待插补缓冲</a></li><li><a href="2329.html" target="_blank">React 入门教程之九 -- composition 模块化 和 inheritance 继承</a></li><li><a href="2324.html" target="_blank">React 入门教程之八 -- Lifting State Up 提升 state 层级</a></li><li><a href="2321.html" target="_blank">openwrt 扩展根目录空间</a></li><li><a href="2320.html" target="_blank">理解 Linux shell 脚本的 2&gt;&amp;1</a></li> </ul>
</div>
<div class="col-m-4">
<h3 class="title-date">时光机：</h3>
<ul>
<li><a href="../2021/10/index.html" rel="nofollow" target="_blank">2021 年 10 月</a></li><li><a href="../2021/09/index.html" rel="nofollow" target="_blank">2021 年 09 月</a></li><li><a href="../2021/08/index.html" rel="nofollow" target="_blank">2021 年 08 月</a></li><li><a href="../2021/06/index.html" rel="nofollow" target="_blank">2021 年 06 月</a></li><li><a href="../2021/05/index.html" rel="nofollow" target="_blank">2021 年 05 月</a></li><li><a href="../2021/04/index.html" rel="nofollow" target="_blank">2021 年 04 月</a></li> </ul>
</div>
<div class="col-m-4">
<h3 class="title-comments">最近评论：</h3>
<ul>
<li>marco nie: <a href="2330.html#comment-37" rel="nofollow" target="_blank">testtes...</a></li>
<li>ahxinny: <a href="2330.html#comment-36" rel="nofollow" target="_blank">好像有空格就断句了。</a></li>
<li>ahxinny: <a href="2330.html#comment-35" rel="nofollow" target="_blank">显示不出来后面...</a></li>
<li>ahxinny: <a href="2330.html#comment-34" rel="nofollow" target="_blank">if abs(...</a></li>
<li>ahxinny: <a href="2330.html#comment-33" rel="nofollow" target="_blank">在endwhi...</a></li>
<li>ahxinny: <a href="2330.html#comment-32" rel="nofollow" target="_blank">在endwhi...</a></li>
</ul>
</div>
</div>
</section>
<section class="sub-footer">
<p>© 2021 <a href="../index.html">Marco Nie</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Single" target="_blank" rel="nofollow">Single</a>.</p>
</section>
</div>
</footer>
<script src="../usr/themes/Single/static/kico.js" type="3c2e70d438aecb30be36039b-text/javascript"></script>
<script src="../usr/themes/Single/static/single.js" type="3c2e70d438aecb30be36039b-text/javascript"></script>
<script src="../usr/themes/Single/static/prism.js" type="3c2e70d438aecb30be36039b-text/javascript"></script>
<script type="3c2e70d438aecb30be36039b-text/javascript">var single = new Paul_Single({copyright: false, night: true});</script>
<link rel="stylesheet" href="../usr/plugins/EditorMD/css/emojify.min.css" />
<script type="3c2e70d438aecb30be36039b-text/javascript">
    window.jQuery || document.write(unescape('%3Cscript%20type%3D%22text/javascript%22%20src%3D%22https://blog.niekun.net/usr/plugins/EditorMD/lib/jquery.min.js%22%3E%3C/script%3E'));
</script>
<script src="../usr/plugins/EditorMD/lib/marked.min.js" type="3c2e70d438aecb30be36039b-text/javascript"></script>
<script src="../usr/plugins/EditorMD/js/editormd.min.js" type="3c2e70d438aecb30be36039b-text/javascript"></script>
<script src="../usr/plugins/EditorMD/js/emojify.min.js" type="3c2e70d438aecb30be36039b-text/javascript"></script>
<script type="3c2e70d438aecb30be36039b-text/javascript">
$(function() {
    var parseMarkdown = function () {
        var markdowns = document.getElementsByClassName("md_content");
        $(markdowns).each(function () {
            var markdown = $(this).children("#append-test").text();
            //$('#md_content_'+i).text('');
            var editormdView;
            editormdView = editormd.markdownToHTML($(this).attr("id"), {
                markdown: markdown,//+ "\r\n" + $("#append-test").text(),
                toolbarAutoFixed: false,
                htmlDecode: true,
                emoji: true,
                tex: true,
                toc: true,
                tocm: true,
                taskList: true,
                flowChart: false,
                sequenceDiagram: false,
            });
        });
    };
    parseMarkdown();
    $(document).on('pjax:complete', function () {
        parseMarkdown()
    });
    emojify.setConfig({
        img_dir: "//cdn.staticfile.org/emoji-cheat-sheet/1.0.0",
        blacklist: {
            'ids': [],
            'classes': ['no-emojify'],
            'elements': ['^script$', '^textarea$', '^pre$', '^code$']
        },
    });
    emojify.run();
});
</script>
<bgm>
<a class="ymusic" onclick="if (!window.__cfRLUnblockHandlers) return false; playbtu();" target="_blank" data-cf-modified-3c2e70d438aecb30be36039b-=""><i id="ydmc"></i></a>
</bgm>
<script data-no-instant type="3c2e70d438aecb30be36039b-text/javascript">
var yaudio = new Audio();
yaudio.controls = true;
var musicArr=[
             {mp3:"https://blog.niekun.net/usr/myuploads/bgmusic.m4a"}
              ];
 
/*首次随机播放*/
var a=parseInt(Math.random()*musicArr.length);
var sj=musicArr[a];
yaudio.src=sj.mp3;
 </script>
<script src="../usr/plugins/YoduBGM/js/player.js" data-no-instant type="3c2e70d438aecb30be36039b-text/javascript"></script><script src="../usr/plugins/YoduBGM/js/prbug.js" type="3c2e70d438aecb30be36039b-text/javascript"></script>
<script src="../cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="3c2e70d438aecb30be36039b-|49" defer=""></script></body>
</html>