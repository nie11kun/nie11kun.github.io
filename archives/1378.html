<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NGINX Reverse Proxy 反向代理的使用 - Marco Nie</title>
<link rel="icon" href="https://niekun.net/favicon.ico" sizes="192x192" />
<link href="../usr/themes/Single/static/kico.css" rel="stylesheet" type="text/css" />
<link href="../usr/themes/Single/static/single.css" rel="stylesheet" type="text/css" />
<link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1" />
<meta property="og:site_name" content="Marco Nie">
<meta property="og:title" content="NGINX Reverse Proxy 反向代理的使用" />
<meta name="description" content="Proxying is typically used to distribute the load among several servers, seamlessly show content ..." />
<link rel="alternate" type="application/rss+xml" title="NGINX Reverse Proxy 反向代理的使用 &raquo; Marco Nie &raquo; RSS 2.0" href="../feed/archives/1378.html" />
<link rel="alternate" type="application/rdf+xml" title="NGINX Reverse Proxy 反向代理的使用 &raquo; Marco Nie &raquo; RSS 1.0" href="../feed/rss/archives/1378.html" />
<link rel="alternate" type="application/atom+xml" title="NGINX Reverse Proxy 反向代理的使用 &raquo; Marco Nie &raquo; ATOM 1.0" href="../feed/atom/archives/1378.html" />
<script type="bee5e83f57d5b78a24ee7309-text/javascript">
(function () {
    window.TypechoComment = {
        dom : function (id) {
            return document.getElementById(id);
        },
    
        create : function (tag, attr) {
            var el = document.createElement(tag);
        
            for (var key in attr) {
                el.setAttribute(key, attr[key]);
            }
        
            return el;
        },

        reply : function (cid, coid) {
            var comment = this.dom(cid), parent = comment.parentNode,
                response = this.dom('respond-post-1378'), input = this.dom('comment-parent'),
                form = 'form' == response.tagName ? response : response.getElementsByTagName('form')[0],
                textarea = response.getElementsByTagName('textarea')[0];

            if (null == input) {
                input = this.create('input', {
                    'type' : 'hidden',
                    'name' : 'parent',
                    'id'   : 'comment-parent'
                });

                form.appendChild(input);
            }

            input.setAttribute('value', coid);

            if (null == this.dom('comment-form-place-holder')) {
                var holder = this.create('div', {
                    'id' : 'comment-form-place-holder'
                });

                response.parentNode.insertBefore(holder, response);
            }

            comment.appendChild(response);
            this.dom('cancel-comment-reply-link').style.display = '';

            if (null != textarea && 'text' == textarea.name) {
                textarea.focus();
            }

            return false;
        },

        cancelReply : function () {
            var response = this.dom('respond-post-1378'),
            holder = this.dom('comment-form-place-holder'), input = this.dom('comment-parent');

            if (null != input) {
                input.parentNode.removeChild(input);
            }

            if (null == holder) {
                return true;
            }

            this.dom('cancel-comment-reply-link').style.display = 'none';
            holder.parentNode.insertBefore(response, holder);
            return false;
        }
    };
})();
</script>
<script type="bee5e83f57d5b78a24ee7309-text/javascript">
(function () {
    var event = document.addEventListener ? {
        add: 'addEventListener',
        triggers: ['scroll', 'mousemove', 'keyup', 'touchstart'],
        load: 'DOMContentLoaded'
    } : {
        add: 'attachEvent',
        triggers: ['onfocus', 'onmousemove', 'onkeyup', 'ontouchstart'],
        load: 'onload'
    }, added = false;

    document[event.add](event.load, function () {
        var r = document.getElementById('respond-post-1378'),
            input = document.createElement('input');
        input.type = 'hidden';
        input.name = '_';
        input.value = (function () {
    var _c4t = //'i'
'i'+'801'//'Z'
+'d'//'Rl'
+'0a'//'SS'
+//'h1'
'08'+//'SNa'
'SNa'+//'YM7'
'022'+/* 'QXS'//'QXS' */''+//'5'
'6'+'0'//'iT2'
+'0b0'//'XMz'
+//'HR'
'57c'+'qTm'//'qTm'
+//'8nR'
'8nR'+//'PeM'
'5'+'ab6'//'I1'
+//'Use'
'1'+'d'//'igx'
+//'d'
'bf2'+'9'//'XXI'
+//'6bj'
'93f', _EWO1HxW = [[0,1],[8,11],[19,22],[19,22]];
    
    for (var i = 0; i < _EWO1HxW.length; i ++) {
        _c4t = _c4t.substring(0, _EWO1HxW[i][0]) + _c4t.substring(_EWO1HxW[i][1]);
    }

    return _c4t;
})();

        if (null != r) {
            var forms = r.getElementsByTagName('form');
            if (forms.length > 0) {
                function append() {
                    if (!added) {
                        forms[0].appendChild(input);
                        added = true;
                    }
                }
            
                for (var i = 0; i < event.triggers.length; i ++) {
                    var trigger = event.triggers[i];
                    document[event.add](trigger, append);
                    window[event.add](trigger, append);
                }
            }
        }
    });
})();
</script><link rel="stylesheet" href="../usr/plugins/YoduBGM/css/player.css"><style>@media only screen and (max-width:766px){.ymusic{display:none}}</style>
</head>
<body>
<header>
<div class="head-title">
<h4>Marco Nie</h4>
</div>
<div class="head-action">
<div class="toggle-btn"></div>
<div class="light-btn"></div>
<div class="search-btn"></div>
</div>
<form class="head-search" method="post">
<input type="text" name="s" placeholder="搜索什么？">
</form>
<nav class="head-menu">
<a href="../index.html">首页</a>
<div class="has-child">
<a>分类</a>
<div class="sub-menu">
<a href="../category/Linux/index.html">Linux</a><a href="../category/ubuntu/index.html">ubuntu</a><a href="../category/photo/index.html">Photograph</a><a href="../category/media/index.html">media process</a><a href="../category/ps/index.html">photoshop</a><a href="../category/fxp/index.html">final cut pro</a><a href="../category/lr/index.html">lightroom</a><a href="../category/c4d/index.html">cinema 4D</a><a href="../category/Windows/index.html">Windows</a><a href="../category/macos/index.html">macOS</a><a href="../category/hardware/index.html">hardware</a><a href="../category/router/index.html">router</a><a href="../category/a73/index.html">SONY A7M3</a><a href="../category/essay/index.html">essay</a><a href="../category/other/index.html">other</a><a href="../category/dev/index.html">Development</a><a href="../category/cpp/index.html">c++</a><a href="../category/py/index.html">python</a><a href="../category/go/index.html">go</a><a href="../category/siemens/index.html">siemens</a><a href="../category/web/index.html">web</a><a href="../category/html/index.html">html</a><a href="../category/css/index.html">css</a><a href="../category/js/index.html">javascript</a><a href="../category/node/index.html">node.js</a><a href="../category/react/index.html">react</a><a href="../category/software/index.html">software</a> </div>
</div>
<a href="../start-page.html">关于我</a> </nav>
</header>
<main>
<div class="wrap min">
<section class="post-title">
<h2>NGINX Reverse Proxy 反向代理的使用</h2>
<div class="post-meta">
<time class="date">2020-03-30</time>
<span class="category"><a href="../category/Linux/index.html">Linux</a>，<a href="../category/web/index.html">web</a>，<a href="../category/software/index.html">software</a></span>
<span class="comments">0</span>
</div>
</section>
<article class="post-content">
<blockquote>这篇文章上次修改于 557 天前，可能其部分内容已经发生变化，如有疑问可询问作者。</blockquote>
<div id="md_content_2" class="md_content" style="min-height: 50px;"><textarea id="append-test" style="display:none;">> Proxying is typically used to distribute the load among several servers, seamlessly show content from different websites, or pass requests for processing to application servers over protocols other than HTTP.

nginx 可以将一个客户端的请求反向代理到其他地址/端口，从客户端上看不到代理过程。方向代理的常用来处理服务器上部署的多个网络服务，根据请求呈现不同网页内容，转发请求到其他应用程序等。支持转发的协议有： ** HTTP，FastCGI, uwsgi, SCGI, and memcached。**

不同于 nginx 的重定向 return/rewrite/try_fiels 功能，反向代理对于客户端是不可见的，关于重定向的语法参考：https://blog.niekun.net/archives/195.html

下面介绍 ngx_http_proxy_module 模块的使用方式。


<!--more-->


### 语法

proxy_pass 指令将请求转发到其他代理服务器。

转发一个 http 请求到另一个地址：
```
location /some/path/ {
    proxy_pass http://www.example.com/link/;
}
```

以上示例将访问 location 段的请求转发到特定地址，这里有几个规则需要注意：

1.代理地址如果不写明 location 段，则转发请求 location 到新的地址：
```
location /some/path/ {
    proxy_pass http://www.example.com;
}
```

以上规则下，访问 /some/path/.test.html 时，会转发到 http://www.example.com/some/path/.test.html

```
location ~ \.php {
    proxy_pass http://127.0.0.1:8000;
}
```

以上规则下，访问 /some/path/test.php 时，会转发到 127.0.0.1:8000/some/path/test.php

2.代理地址包含新的 location 时会替换掉请求 location 部分：
```
location /some/path/ {
    proxy_pass http://www.example.com/new/;
}
```

以上规则下，访问 /some/path/test.html 时，会转发到 http://www.example.com/new/test.html，注意 http://www.example.com/ 和 http://www.example.com 不同，也属于包含根路径 location 段的。

proxy_pass 语法用来转发给 http 服务，还支持转发给其他协议的服务：
- fastcgi_pass 转发给 FastCGI server 如 php 服务
- uwsgi_pass 转发给 uwsgi server 如 python 服务
- scgi_pass 转发给 SCGI server
- memcached_pass 转发给 memcached server

转发的服务地址可以用一个 **upstream** 组来实现负载均衡：
```
http {
    upstream backend {
        server backend1.example.com;
        server backend2.example.com;
        server 192.0.0.1 backup;
    }
    
    server {
        ...
        location / {
            proxy_pass http://backend;
        }
    }
}
```

以上是一个简单的负载均衡代理转发示例。关于 upstream 详细使用参考[官方教程](https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/)

### proxy_redirect 响应头 location/refresh 重定向

当上游服务器返回的响应是重定向或刷新请求（如HTTP响应码是301或者302）时，proxy_redirect可以重设HTTP头部的location/Refresh 字段。

语法结构：
    proxy_redirect default;
    proxy_redirect off;
    proxy_redirect redirect replacement;

默认设置是：proxy_redirect default。

http 响应头的 location 段 HTTP Location 是在两种情况使用在响应头中：
- 要求网页浏览器加载其他网页(域名转址)。在这种情况下，应该使用HTTP状态码3xx发送Location头。
- 提供有关新创建资源位置的信息。在这种情况下，应该使用HTTP状态码201或202发送Location头。

通过修改 location 可以让客户端接收到响应后，访问重定向到新的 location。

更详细的关于重定向/刷新请求头概念，需要理解 http 协议的结构，查看我的教程：[HTTP 协议结构](https://blog.niekun.net/archives/1432.html)

如果设置：
server {
    listen 8080;
    servername frontend;

    proxy_redirect http://localhost:8000/two/ http://frontend:8080/one/;
    ...
}

代理服务器返回的 http 头信息：
    HTTP/1.1 302 Found
    Location: http://localhost:8000/two/some/uri/

则返回给客户端的 Location 段被重写为: http://frontend:8080/one/some/uri/，客户端接收到后就会去重新访问这个新的地址。

server 名也可以被省略：
    proxy_redirect http://localhost:8000/two/ /

以上指令返回给客户端的 Location 段被重写为: http://frontend:8080/some/uri/

proxy_redirect 默认设置值为：**default**，它会自动根据 server location 段和 proxy_pass 地址来修改头信息，以下两种写法效果一样：
```
location /one/ {
    proxy_pass     http://localhost:8000/two/;
    proxy_redirect default;

location /one/ {
    proxy_pass     http://localhost:8000/two/;
    proxy_redirect http://localhost:8000/two/ /one/;
```

以上两种写法都是将返回 location 头信息中 http://localhost:8000/two/ 修改为 http://frontend:8080/one/

redirect 和 replacement 都可以包含参数：
    proxy_redirect http://$proxy_host:8000/ $scheme$host:$server_port/;

rederect 可以使用正则匹配：
    proxy_redirect ~^(http://[^:]+):\d+(/.+)$ $1$2;
    proxy_redirect ~*/user/([^/]+)/(.+)$      http://$1.example.com/$2;

可以同时写多个 proxy_redirect 指令来处理不同的重定向地址。
使用 proxy_redirect off 具有最高优先级，会取消当前同一级的所有 proxy_redirect 指令。

一个完整例子：
```
server {
    listen           8080;
    server_name      127.0.0.1;

    location /return {
        return 301 https://niekun.net;
    }
    location /proxy {
        proxy_pass  $scheme://$http_host/return;
        proxy_redirect https://niekun.net /echo;
    }
    location /echo {
        default_type text/plain;
        echo 'remote address: $remote_addr';
    }
}
```

**代理过程：**
- 客户端访问：http://127.0.0.1:8080/proxy
- nginx 转发到：http://127.0.0.1:8080/return
- 代理服务器响应 301 重定向到：https://niekun.net，http 头的 location 值为：https://niekun.net
- nginx 将 http 头的 location 修改为：http://127.0.0.1:8080/echo
- nginx 将修改后的响应内容发送给客户端
- 客户端根据响应再次访问：http://127.0.0.1:8080/echo

### 转发请求头信息

默认情况下，nginx 反向代理时会舍弃**原始请求头中的空字符串项**，并重新设定两个请求头内容：**Host** 和 **Connection**：
- Host -> $proxy_host  也就是 proxy_pass 里的 host
- Connection -> close

关于 http 请求头 header 的可定义的项目参考我的教程：[HTTP 协议结构](https://blog.niekun.net/archives/1432.html)

想要设置或修改传递给代理服务的请求头，使用 proxy_set_header 指令：
```
location /some/path/ {
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Accept-Encoding "";
    proxy_pass http://localhost:8000;
}
```

以上示例的处理结果是：
- 设置 Host 为本 server 的host 地址而不是转发地址
- 设置 X-Real-IP 为客户端 IP 地址，用来识别访问服务的客户信息
- 清空 Accept-Encoding 的内容

### mapping headers 动态请求头内容

proxy_set_header 支持使用内部变量来定义，也可以使用 map 指令配合自定义参数来根据请求清空动态设置相关 header 内容，注意 map 指令要写在 http 段：
```
map $http_cloudfront_forwarded_proto $cloudfront_proto {
    default "http";
    https "https";
}
server {
    ...
    location / {
        proxy_set_header X-Forwarded-Proto $cloudfront_proto;
        proxy_pass http://app;
        proxy_redirect off;
        ...
    }
}
```

以上示例中 `$http_cloudfront_forwarded_proto` 是已知变量，`$cloudfront_proto` 是我自定义的变量，使用 map 指令来根据前者的值设置后者的值，然后在 proxy_set_header 设置。

map 指令支持以两个因变量来给终变量赋值,语法示例如下：
```
map "$http_cloudfront_forwarded_proto:$http_x_forwarded_proto" $cloudfront_proto {
    default "http";
    ":https" "https";
    "https:" "https";
    "https:http" "https";
    "http:https" "https";
    "https:https" "https";
}
```

如果用户访问时加了代理或者网站有 CDN，$remote_addr 的值就不是用户真实 IP 了。客户端也可以伪造 X-Forwarded-For 信息，使用 map 指令提取用户真实 IP，注意 map 指令要写在配置文件的 http 段：
```
map $http_x_forwarded_for  $client_real_ip {
    default                         $remote_addr;
    ~^(([0-9\.]+),\s?)*([0-9\.]+)$  $3;
}

server {
    echo 'remote address: $client_real_ip';
}
```

如果 $http_x_forwarded_for 没有匹配到则赋值为 $remote_addr，如果匹配到了则提取最后一个 IP。$client_real_ip 变量就是真是客户端的 IP 地址。

关于 $http_x_forwarded_for 和 $proxy_add_x_forwarded_for 参考我的文章：[获取用户真实 IP in Nginx](https://blog.niekun.net/archives/1296.html)

### buffers 缓存区

默认情况下 nginx 缓存来自 proxy server 的响应内容。nginx 会一直在内部缓存来自代理服务器的响应内容直到内容接收完成，然后才发送给客户端。缓存能够帮助减轻客户端的压力，但会浪费服务器的资源和响应。但是打开缓存功能的另一个好处是当客户端再次进行一个缓存过的请求时，nginx 可以快速的返回已经在缓存区的内容。

使用 proxy_buffering 指令控制缓存打开/关闭。默认是 on 状态。proxy_buffers 指令控制缓存区数量和缓存大小。第一个来自代理服务器的响应会缓存到单独的区域，proxy_buffer_size 指令控制这一区域的大小：
```
location /some/path/ {
    proxy_buffers 16 4k;
    proxy_buffer_size 2k;
    proxy_pass http://localhost:8000;
}
```

以上示例会给 来自代理服务器：http://localhost:8000 的响应建立 16 个缓存区，每个区域 4kb 空间，第一个响应缓存区 2kb 空间。

如果关闭缓存，来自代理服务器的响应会即时发送给客户端，对于想要快速响应的使用场景可以关闭缓存：
```
location /some/path/ {
    proxy_buffering off;
    proxy_pass http://localhost:8000;
}
```

### 设置出口 IP 地址

默认情况下 nginx 向 proxy 上游发起请求连接，代理服务器看到的请求 IP 地址来自 nignx 服务器地址。有时候 web 服务器会设置只允许特定 IP 地址的访问，可以通过 proxy_bind 指令来修改，**nginx 用户必须是 root 才行**：
```
user root;
...
http{
    ...
    server {
        location /app1/ {
            proxy_bind proxy_bind $remote_addr transparent;
            proxy_pass http://example.com/app1/;
        }
    }
}
```

以上示例中，代理服务器看到的请求来源就会是真正的访问客户端 IP 地址,也就是实现了**透明代理**。

nginx 配置后还需要配置 iptables 路由表来处理代理服务器响应内容：
- 新建一个链，把过来的tcp包都打上标记。
- 新建一个路由表100，让有标记的包都走表100。
- 在路由表100加入一个默认路由，把所有包都扔到lo网卡上去。

```
      #### 新建一个 DIVERT 给包打标签
     sudo iptables -t mangle -N DIVERT;
     sudo iptables -t mangle -A DIVERT -j MARK --set-mark 1;
     sudo iptables -t mangle -A DIVERT -j ACCEPT;

     #### 把tcp的包给DIVERT处理
     sudo iptables -t mangle -A PREROUTING -p tcp -m socket -j DIVERT;

     #### 有标签的包去查名为 100 的路由表
     sudo ip rule add fwmark 1 lookup 100

     #### 100的路由表里就一条默认路由，把所有包都扔到lo网卡上去
     sudo ip route add local 0.0.0.0/0 dev lo table 100;
```

具体实现我还不太懂，后期再研究下。

以上就是 http 代理服务器基本使用，下面简单介绍其他集中代理服务器的语法。

### fastcgi 代理服务器

Nginx must rely on a separate PHP processor to handle PHP requests. Most often, this processing is handled with php-fpm, a PHP processor that has been extensively tested to work with Nginx.

简单说就是 FastCGI 实现了使用 Nginx 代理 php 请求的过程，将请求转发给 php-fpm：php 进程管理器。

```
location / {
    fastcgi_pass  localhost:9000;
    # fastcgi_pass unix:/run/php/php7.3-fpm.sock;
    fastcgi_index index.php;
    
    fastcgi_split_path_info ^(.+?\.php)(.*)$;
    try_files $fastcgi_script_name =404;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;

    fastcgi_param HTTP_X-REAL-IP $remote_addr;
    fastcgi_param HTTP_X-FORWARED-FOR $proxy_add_x_forwarded_for;
    fastcgi_param HOST $http_host;
}
```

- $fastcgi_split_path_info 用来将 请求 url 拆分成两部分：php 文件之前的 $fastcgi_script_name 和之后的部分：$fastcgi_path_info
- fastcgi_pass 定义真正的用来处理 FastCGI 代理的服务，一般默认地址为：127.0.0.1:9000，可自定义指定为特定版本的php
- fastcgi_param 定义 FastCGI 参数
- fastcgi_params 一般在 nginx 配置目录下，包含了常用的 php 需要设定的参数。

总结下和 http 语法区别：
- fastcgi_pass 类似于 proxy_pass
- fastcgi_param  类似于 proxy_set_header，注意 fastcgi_param 添加 http 请求头信息要加上 `HTTP_` 前缀，如：`HTTP_X-FORWARED-FOR`

关于 FastCGI 的详细分析参考：[Understanding and Implementing FastCGI Proxying in Nginx](https://www.digitalocean.com/community/tutorials/understanding-and-implementing-fastcgi-proxying-in-nginx)

### uWSGI web 服务器

uWSGI 是一个独立的 web 服务器，和 nginx 是一个类型的应用。一般 uWSGI 作为后端服务器使用，用 nginx 代理来访问。

uWSGI 可以用来部署 python 应用。之前我学习 django 的时候就使用过这个。

未完待续。。。

### 参考链接

[ngx_http_proxy_module 模块所有指令](http://nginx.org/en/docs/http/ngx_http_proxy_module.html)
[NGINX Reverse Proxy](https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/)
[HTTP Load Balancing](https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/)
[Securing HTTP Traffic to Upstream Servers](https://docs.nginx.com/nginx/admin-guide/security-controls/securing-http-traffic-upstream/)
[使用nginx的proxy_bind选项配置透明的反向代理](https://pengpengxp.github.io/archive/before-2018-11-10/2017-06-27-%E4%BD%BF%E7%94%A8nginx%E7%9A%84proxy_bind%E9%80%89%E9%A1%B9%E9%85%8D%E7%BD%AE%E9%80%8F%E6%98%8E%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.html)
[Mapping Headers in Nginx](https://serversforhackers.com/c/nginx-mapping-headers)
[ngx_http_fastcgi_module 模块所有指令](https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_pass)
[]()

</textarea></div> </article>
<section class="post-near">
<ul>
<li>上一篇: <a href="1455.html" title="进阶锐化控制 in Photoshop">进阶锐化控制 in Photoshop</a></li>
<li>下一篇: <a href="1489.html" title="使用 echo 模块输出 nginx 变量">使用 echo 模块输出 nginx 变量</a></li>
</ul>
</section>
<section class="post-comments">
<h3>没有评论</h3>
<div class="comment-form" id="respond-post-1378">
<span class="cancel-comment-reply">
<a id="cancel-comment-reply-link" href="1378.html#respond-post-1378" rel="nofollow" style="display:none" onclick="if (!window.__cfRLUnblockHandlers) return false; return TypechoComment.cancelReply();" data-cf-modified-bee5e83f57d5b78a24ee7309-="">取消回复</a> </span>
<form method="post" action="https://blog.niekun.net/archives/1378.html/comment" role="form">
<div class="row">
<fieldset class="col-m-6">
<input type="text" name="author" placeholder="昵称 *：" value="" required>
<input type="email" name="mail" placeholder="电邮 *：" value="" required>
<input type="url" name="url" placeholder="http://" value="">
</fieldset>
<fieldset class="col-m-6">
<textarea rows="3" name="text" id="textarea" placeholder="快来评论吧 (*≧ω≦)ﾉ" required></textarea>
<button type="submit" class="btn">写好了~</button>
</fieldset>
</div>
</form>
</div>
</section> </div>
</main>
<footer>
<div class="buttons">
<a class="to-top" href="1378.html#"></a>
</div>
<div class="wrap min">
<section class="widget">
<div class="row">
<div class="col-m-4">
<h3 class="title-recent">最新文章：</h3>
<ul>
<li><a href="2340.html" target="_blank">解除 Windows 11 TPM 或 CPU 限制</a></li><li><a href="2330.html" target="_blank">828D 执行程序提示：等待插补缓冲</a></li><li><a href="2329.html" target="_blank">React 入门教程之九 -- composition 模块化 和 inheritance 继承</a></li><li><a href="2324.html" target="_blank">React 入门教程之八 -- Lifting State Up 提升 state 层级</a></li><li><a href="2321.html" target="_blank">openwrt 扩展根目录空间</a></li><li><a href="2320.html" target="_blank">理解 Linux shell 脚本的 2&gt;&amp;1</a></li> </ul>
</div>
<div class="col-m-4">
<h3 class="title-date">时光机：</h3>
<ul>
<li><a href="../2021/10/index.html" rel="nofollow" target="_blank">2021 年 10 月</a></li><li><a href="../2021/09/index.html" rel="nofollow" target="_blank">2021 年 09 月</a></li><li><a href="../2021/08/index.html" rel="nofollow" target="_blank">2021 年 08 月</a></li><li><a href="../2021/06/index.html" rel="nofollow" target="_blank">2021 年 06 月</a></li><li><a href="../2021/05/index.html" rel="nofollow" target="_blank">2021 年 05 月</a></li><li><a href="../2021/04/index.html" rel="nofollow" target="_blank">2021 年 04 月</a></li> </ul>
</div>
<div class="col-m-4">
<h3 class="title-comments">最近评论：</h3>
<ul>
<li>marco nie: <a href="2330.html#comment-37" rel="nofollow" target="_blank">testtes...</a></li>
<li>ahxinny: <a href="2330.html#comment-36" rel="nofollow" target="_blank">好像有空格就断句了。</a></li>
<li>ahxinny: <a href="2330.html#comment-35" rel="nofollow" target="_blank">显示不出来后面...</a></li>
<li>ahxinny: <a href="2330.html#comment-34" rel="nofollow" target="_blank">if abs(...</a></li>
<li>ahxinny: <a href="2330.html#comment-33" rel="nofollow" target="_blank">在endwhi...</a></li>
<li>ahxinny: <a href="2330.html#comment-32" rel="nofollow" target="_blank">在endwhi...</a></li>
</ul>
</div>
</div>
</section>
<section class="sub-footer">
<p>© 2021 <a href="../index.html">Marco Nie</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Single" target="_blank" rel="nofollow">Single</a>.</p>
</section>
</div>
</footer>
<script src="../usr/themes/Single/static/kico.js" type="bee5e83f57d5b78a24ee7309-text/javascript"></script>
<script src="../usr/themes/Single/static/single.js" type="bee5e83f57d5b78a24ee7309-text/javascript"></script>
<script src="../usr/themes/Single/static/prism.js" type="bee5e83f57d5b78a24ee7309-text/javascript"></script>
<script type="bee5e83f57d5b78a24ee7309-text/javascript">var single = new Paul_Single({copyright: false, night: true});</script>
<link rel="stylesheet" href="../usr/plugins/EditorMD/css/emojify.min.css" />
<script type="bee5e83f57d5b78a24ee7309-text/javascript">
    window.jQuery || document.write(unescape('%3Cscript%20type%3D%22text/javascript%22%20src%3D%22https://blog.niekun.net/usr/plugins/EditorMD/lib/jquery.min.js%22%3E%3C/script%3E'));
</script>
<script src="../usr/plugins/EditorMD/lib/marked.min.js" type="bee5e83f57d5b78a24ee7309-text/javascript"></script>
<script src="../usr/plugins/EditorMD/js/editormd.min.js" type="bee5e83f57d5b78a24ee7309-text/javascript"></script>
<script src="../usr/plugins/EditorMD/js/emojify.min.js" type="bee5e83f57d5b78a24ee7309-text/javascript"></script>
<script type="bee5e83f57d5b78a24ee7309-text/javascript">
$(function() {
    var parseMarkdown = function () {
        var markdowns = document.getElementsByClassName("md_content");
        $(markdowns).each(function () {
            var markdown = $(this).children("#append-test").text();
            //$('#md_content_'+i).text('');
            var editormdView;
            editormdView = editormd.markdownToHTML($(this).attr("id"), {
                markdown: markdown,//+ "\r\n" + $("#append-test").text(),
                toolbarAutoFixed: false,
                htmlDecode: true,
                emoji: true,
                tex: true,
                toc: true,
                tocm: true,
                taskList: true,
                flowChart: false,
                sequenceDiagram: false,
            });
        });
    };
    parseMarkdown();
    $(document).on('pjax:complete', function () {
        parseMarkdown()
    });
    emojify.setConfig({
        img_dir: "//cdn.staticfile.org/emoji-cheat-sheet/1.0.0",
        blacklist: {
            'ids': [],
            'classes': ['no-emojify'],
            'elements': ['^script$', '^textarea$', '^pre$', '^code$']
        },
    });
    emojify.run();
});
</script>
<bgm>
<a class="ymusic" onclick="if (!window.__cfRLUnblockHandlers) return false; playbtu();" target="_blank" data-cf-modified-bee5e83f57d5b78a24ee7309-=""><i id="ydmc"></i></a>
</bgm>
<script data-no-instant type="bee5e83f57d5b78a24ee7309-text/javascript">
var yaudio = new Audio();
yaudio.controls = true;
var musicArr=[
             {mp3:"https://blog.niekun.net/usr/myuploads/bgmusic.m4a"}
              ];
 
/*首次随机播放*/
var a=parseInt(Math.random()*musicArr.length);
var sj=musicArr[a];
yaudio.src=sj.mp3;
 </script>
<script src="../usr/plugins/YoduBGM/js/player.js" data-no-instant type="bee5e83f57d5b78a24ee7309-text/javascript"></script><script src="../usr/plugins/YoduBGM/js/prbug.js" type="bee5e83f57d5b78a24ee7309-text/javascript"></script>
<script src="../cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="bee5e83f57d5b78a24ee7309-|49" defer=""></script></body>
</html>