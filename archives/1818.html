<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7051950560656517" crossorigin="anonymous" type="2db3820e2eca976a510a049d-text/javascript"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>openwrt 的安装与配置 | Marco Nie</title>
    <link rel="stylesheet" href="../usr/themes/classic-22/static/css/style.css">
        <link rel="canonical" href="1818.html" />
<link rel="pingback" href="../action/xmlrpc" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../action/xmlrpc?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../action/xmlrpc?wlw" />
<link rel="alternate" type="application/rss+xml" title="openwrt 的安装与配置 &raquo; Marco Nie &raquo; RSS 2.0" href="../feed/archives/1818.html" />
<link rel="alternate" type="application/rdf+xml" title="openwrt 的安装与配置 &raquo; Marco Nie &raquo; RSS 1.0" href="../feed/rss/archives/1818.html" />
<link rel="alternate" type="application/atom+xml" title="openwrt 的安装与配置 &raquo; Marco Nie &raquo; ATOM 1.0" href="../feed/atom/archives/1818.html" />
<meta name="description" content="openWrt 是专门为嵌入式设备设计的 Linux 系统，常用来作为软路由系统使用。LEDE 和 openWrt 已经合并到一起。官网：https://openwrt.org/最近研究软路由，..." />
<meta name="generator" content="Typecho 1.3.0" />
<meta name="template" content="classic-22" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.niekun.net/archives/1818.html" />
<meta name="twitter:title" property="og:title" itemprop="name" content="openwrt 的安装与配置" />
<meta name="twitter:description" property="og:description" itemprop="description" content="openWrt 是专门为嵌入式设备设计的 Linux 系统，常用来作为软路由系统使用。LEDE 和 openWrt 已经合并到一起。官网：https://openwrt.org/最近研究软路由，..." />
<meta property="og:site_name" content="Marco Nie" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:domain" content="blog.niekun.net" />
<script type="2db3820e2eca976a510a049d-text/javascript">
(function () {
    window.TypechoComment = {
        dom : function (sel) {
            return document.querySelector(sel);
        },
        
        visiable: function (el, show) {
            el.style.display = show ? '' : 'none';
        },
    
        create : function (tag, attr) {
            const el = document.createElement(tag);
        
            for (const key in attr) {
                el.setAttribute(key, attr[key]);
            }
        
            return el;
        },
        
        inputParent: function (response, coid) {
            const form = 'form' === response.tagName ? response : response.querySelector('form');
            let input = form.querySelector('input[name=parent]');
            
            if (null == input && coid) {
                input = this.create('input', {
                    'type' : 'hidden',
                    'name' : 'parent'
                });

                form.appendChild(input);
            }
            
            if (coid) {
                input.setAttribute('value', coid);
            } else if (input) {
                input.parentNode.removeChild(input);
            }
        },
        
        getChild: function (root, node) {
            const parentNode = node.parentNode;
            
            if (parentNode === null) {
                return null;
            } else if (parentNode === root) {
                return node;
            } else {
                return this.getChild(root, parentNode);
            }
        },

        reply : function (htmlId, coid, btn) {
            const response = this.dom('#respond-post-1818'),
                textarea = response.querySelector('textarea[name=text]'),
                comment = this.dom('#' + htmlId),
                child = this.getChild(comment, btn);

            this.inputParent(response, coid);

            if (this.dom('#respond-post-1818-holder') === null) {
                const holder = this.create('div', {
                    'id' : 'respond-post-1818-holder'
                });

                response.parentNode.insertBefore(holder, response);
            }
            
            if (child) {
                comment.insertBefore(response, child.nextSibling);
            } else {
                comment.appendChild(response);
            }

            this.visiable(this.dom('#cancel-comment-reply-link'), true);

            if (null != textarea) {
                textarea.focus();
            }

            return false;
        },

        cancelReply : function () {
            const response = this.dom('#respond-post-1818'),
                holder = this.dom('#respond-post-1818-holder');

            this.inputParent(response, false);

            if (null === holder) {
                return true;
            }

            this.visiable(this.dom('#cancel-comment-reply-link'), false);
            holder.parentNode.insertBefore(response, holder);
            return false;
        }
    };
})();
</script><script type="2db3820e2eca976a510a049d-text/javascript">
(function () {
    const events = ['scroll', 'mousemove', 'keyup', 'touchstart'];
    let added = false;

    document.addEventListener('DOMContentLoaded', function () {
        const response = document.querySelector('#respond-post-1818');

        if (null != response) {
            const form = 'form' === response.tagName ? response : response.querySelector('form');
            const input = document.createElement('input');
            
            input.type = 'hidden';
            input.name = '_';
            input.value = (function () {
    var _pkA = //'p'
'360'+'99'//'c'
+'43d'//'EI'
+'e7'//'e'
+/* 'm'//'m' */''+//'ojJ'
'342'+'nw'//'nw'
+//'C'
'd1a'+''///*'z2k'*/'z2k'
+//'A'
'A'+'b4'//'GF'
+'2cc'//'K3'
+'c'//'9O3'
+'4'//'hi'
+'5'//'FG'
+''///*'jIp'*/'jIp'
+/* 'F'//'F' */''+'243'//'4NO'
+//'ib'
'45'+//'n6'
'c'+//'iN'
'0'+//'Mua'
'a', _Dnz = [[13,15],[16,17]];
    
    for (var i = 0; i < _Dnz.length; i ++) {
        _pkA = _pkA.substring(0, _Dnz[i][0]) + _pkA.substring(_Dnz[i][1]);
    }

    return _pkA;
})();;
 
            if (form) {
                function append() {
                    if (!added) {
                        form.appendChild(input);
                        added = true;
                    }
                }
            
                for (const event of events) {
                    window.addEventListener(event, append);
                }
            }
        }
    });
})();
</script></head>

<body>

<header class="site-navbar container-fluid">
    <nav>
        <ul class="site-name">
                    <li>
                <a href="../index.html" class="brand">Marco Nie</a>
            </li>
            <li class="desc">you are the company you keep...</li>
                </ul>

        <ul>
            <li>
                <label for="nav-toggler" class="nav-toggler-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></svg>
                </label>
            </li>
        </ul>
    </nav>

    <nav class="site-nav">
        <input type="checkbox" id="nav-toggler">

        <ul class="nav-menu">
            <li>
                <a href="../index.html">首页</a>
            </li>

                                    <li>
                <a href="../start-page.html">关于我</a>
            </li>
                        <li>
                <form method="post" action="../index.html">
                    <input type="search" id="s" name="s">
                </form>
            </li>
        </ul>
    </nav>
</header>

<main class="container">
    <div class="container-thin">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
                <header class="entry-header text-center">
        <h1 class="entry-title" itemprop="name headline">
            <a href="1818.html" itemprop="url">openwrt 的安装与配置</a>
        </h1>
                <ul class="entry-meta list-inline text-muted">
            <li class="feather-calendar"><time datetime="2020-10-15T16:51:00+08:00" itemprop="datePublished">2020-10-15</time></li>
            <li class="feather-folder"><a href="../category/Linux/index.html">Linux</a>, <a href="../category/Windows/index.html">Windows</a></li>
            <li class="feather-message"><a href="1818.html#comments"  itemprop="discussionUrl">暂无评论</a></li>
        </ul>
            </header>

            <div class="entry-content fmt" itemprop="articleBody">
                <p>openWrt 是专门为嵌入式设备设计的 Linux 系统，常用来作为软路由系统使用。LEDE 和 openWrt 已经合并到一起。</p><p>官网：<a href="https://openwrt.org/">https://openwrt.org/</a></p><p>最近研究软路由，所以先使用 VMware 虚拟机安装测试 openWrt，由于 VMware 只能识别 vmdk 格式的虚拟磁盘镜像，而官网下载的是 img 镜像，所以需要进行格式转换。</p><!--more--><h3>固件下载及转换</h3><p>openWrt 固件也是区分不同硬件平台的，需要根据硬件情况下载对应的系统镜像。</p><p>官方固件下载地址：<a href="https://downloads.openwrt.org/">https://downloads.openwrt.org/</a></p><p>目前最新的版本是 19.07.4，我电脑是 x86 平台 64位系统需下载 x86_64 固件，进入列表下载 <code>combined-ext4.img.gz</code> 到本地:<br><img src="../usr/uploads/2020/10/2820863057.jpg" alt="1.jpg" title="1.jpg"></p><p>将下载的压缩包解压出 img 镜像文件。由于我是虚拟机安装，所以需要将下载的 img 镜像转换为 VMware 的虚拟硬盘格式：<code>.vmdk</code>，最方便的是使用 Linux 工具 <code>qemu-img</code> 来完成，这里我是用 wsl 子系统来处理：</p><pre><code>apt install qemu qemu-utils
qemu-img convert -f raw -O vmdk openwrt-19.07.4-x86-64-combined-ext4.img openwrt-19.07.4-x86-64-combined-ext4.vmdk</code></pre><p>完成后得到 vmdk 文件。</p><h3>建立虚拟机</h3><p>新建虚拟机，选择自定义模式：<br><img src="../usr/uploads/2020/10/1077455176.jpg" alt="2.jpg" title="2.jpg"></p><p>硬件兼容选择最新的即可：<br><img src="../usr/uploads/2020/10/1008180166.jpg" alt="3.jpg" title="3.jpg"></p><p>然后选择稍后安装操作系统：<br><img src="../usr/uploads/2020/10/689721582.jpg" alt="4.jpg" title="4.jpg"></p><p>系统选择 Linux 系统，19.07 版本是 4.14 内核，我下载的是 64 位固件，所以选择<strong>其他 Linux 4.x内核，64位</strong>：<br><img src="../usr/uploads/2020/10/1075618772.jpg" alt="5.jpg" title="5.jpg"></p><p>虚拟机名称自己定义：<br><img src="../usr/uploads/2020/10/2232764296.jpg" alt="6.jpg" title="6.jpg"></p><p>处理器默认即可：<br><img src="../usr/uploads/2020/10/1085680336.jpg" alt="7.jpg" title="7.jpg"></p><p>内存分配1G：<br><img src="../usr/uploads/2020/10/89327964.jpg" alt="8.jpg" title="8.jpg"></p><p>剩下的全部默认确定即可，虚拟机初步建立完成。</p><p>下一步开始配置虚拟网卡用来分配给 openwrt 的 lan 内网网卡，点击<strong>编辑 - 虚拟网络编辑器</strong>：<br><img src="../usr/uploads/2020/10/1374273348.jpg" alt="9.jpg" title="9.jpg"></p><p>点击右下角<strong>更改设置</strong>：<br><img src="../usr/uploads/2020/10/691892215.jpg" alt="10.jpg" title="10.jpg"></p><p>点击<strong>添加网络</strong>：<br><img src="../usr/uploads/2020/10/1419508697.jpg" alt="11.jpg" title="11.jpg"></p><p>选择一个可用的网络点击确定，我选择 vnet2：<br><img src="../usr/uploads/2020/10/44933613.jpg" alt="12.jpg" title="12.jpg"></p><p>选择<strong>仅主机模式</strong>，由于 openwrt 自带 DHCP 控制所以这里取消勾选 DHCP 服务：<br><img src="../usr/uploads/2020/10/2381585332.jpg" alt="13.jpg" title="13.jpg"></p><p>点击确认，完成虚拟网卡的建立，我实际建立的子网 IP 段是 192.168.244.0，子网掩码 255.255.255.0。</p><p>下面编辑刚才建立的虚拟机，点击<strong>编辑虚拟机设置</strong>：<br><img src="../usr/uploads/2020/10/1011907668.jpg" alt="14.jpg" title="14.jpg"></p><p>移除不需要的硬件，包括硬盘，保留网络适配器。快捷键 alt + R：<br><img src="../usr/uploads/2020/10/731943422.jpg" alt="15.jpg" title="15.jpg"></p><p>将上面转换的 vmdk 文件拷贝到此虚拟机文件夹：<br><img src="../usr/uploads/2020/10/1633164225.jpg" alt="16.jpg" title="16.jpg"></p><p>点击添加硬件：<br><img src="../usr/uploads/2020/10/1582850006.jpg" alt="17.jpg" title="17.jpg"></p><p>选择<strong>硬盘</strong>，点击下一步：<br><img src="../usr/uploads/2020/10/1091507877.jpg" alt="18.jpg" title="18.jpg"></p><p>选择<strong>使用现有虚拟磁盘</strong>：<br><img src="../usr/uploads/2020/10/3795351894.jpg" alt="19.jpg" title="19.jpg"></p><p>选择刚才复制到目录的 vmdk 文件，点击完成：<br><img src="../usr/uploads/2020/10/3286075109.jpg" alt="20.jpg" title="20.jpg"></p><p>选择<strong>转换</strong>：<br><img src="../usr/uploads/2020/10/3939975986.jpg" alt="21.jpg" title="21.jpg"></p><p>再次添加一个网络适配器：<br><img src="../usr/uploads/2020/10/903097129.jpg" alt="22.jpg" title="22.jpg"></p><p>这里我们有了两个网络适配器，第一个分配给 lan 第二个分配给 wan，注意顺序，<strong>openWrt 默认识别第一个网卡为 lan</strong>。后期进入系统后也可以修改网卡顺序。</p><p>第一个网卡 lan 设置为我们刚才建立的虚拟网卡 vnet2，用来给 openWrt 路由的内网使用：<br><img src="../usr/uploads/2020/10/2504631771.jpg" alt="23.jpg" title="23.jpg"></p><p>第二个网卡 wan 设置为桥接模式，用来连接物理外网：<br><img src="../usr/uploads/2020/10/2177677516.jpg" alt="24.jpg" title="24.jpg"></p><p>确认后启动虚拟机，等待进入进入系统。<strong>进入系统后可以设置一个快照方便以后恢复。</strong></p><h3>网络配置</h3><p>进入系统后，我们需要设置 lan 的 IP 地址为我们创建的虚拟网卡所在的 IP 段，就能从主机访问 openwrt 了。</p><p>首先通过 <code>ip l</code> 命令查看当前安装的网卡名称：</p><pre><code>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP qlen 1000
    link/ether 00:0c:29:c5:39:8d brd ff:ff:ff:ff:ff:ff
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP qlen 1000
    link/ether 00:0c:29:c5:39:97 brd ff:ff:ff:ff:ff:ff</code></pre><p>可以看到除了 lo 本地网络外，有两个网卡 eth0 和 eth1，分别对应第一个网卡和第二个网卡。</p><p>下面我们编辑 <code>/etc/config/network</code> 配置文件,这里我们需要修改 lan 段里的 ipaddr 地址为虚拟网卡网段。我们这里修改为 <code>192.168.244.1</code>:</p><pre><code>config interface 'loopback'
        option ifname 'lo'
        option proto 'static'
        option ipaddr '127.0.0.1'
        option netmask '255.0.0.0'

config globals 'globals'
        option ula_prefix 'fd97:e395:55b0::/48'

config interface 'lan'
        option type 'bridge'
        option ifname 'eth0'
        option proto 'static'
        option ipaddr '192.168.244.1'
        option netmask '255.255.255.0'
        option ip6assign '60'

config interface 'wan'
        option ifname 'eth1'
        option proto 'dhcp'

config interface 'wan6'
        option ifname 'eth1'
        option proto 'dhcpv6'</code></pre><p>修改完成后重启 network 服务即可生效：</p><pre><code>/etc/init.d/network restart
</code></pre><p>重启完成后使用 <code>ip addr</code> 查看系统网络配置，可以看到 wan 口 eth1 分配到主机网络所在局域网 IP 地址，lan 口 eth0 是虚拟网卡 IP 地址：</p><pre><code>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master br-lan state UP qlen 1000
    link/ether 00:0c:29:c5:39:8d brd ff:ff:ff:ff:ff:ff
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP qlen 1000
    link/ether 00:0c:29:c5:39:97 brd ff:ff:ff:ff:ff:ff
    inet 192.168.116.129/24 brd 192.168.116.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fec5:3997/64 scope link
       valid_lft forever preferred_lft forever
5: br-lan: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP qlen 1000
    link/ether 00:0c:29:c5:39:8d brd ff:ff:ff:ff:ff:ff
    inet 192.168.244.1/24 brd 192.168.244.255 scope global br-lan
       valid_lft forever preferred_lft forever
    inet6 fd97:e395:55b0::1/60 scope global
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fec5:398d/64 scope link
       valid_lft forever preferred_lft forever</code></pre><p>使用 ping 查看是否可以连接外网,如果无法 ping 通，则需要检查配置问题。</p><p>主机网络适配器里找到 vmware vnet 2 虚拟网卡：<br><img src="../usr/uploads/2020/10/133092593.jpg" alt="29.jpg" title="29.jpg"></p><p>查看信息，ip 地址是否正确，<strong>注意</strong>如果 openwrt 里的 IP 设置为了 <code>192.168.244.1</code>，则这里的IPv4 地址就需要修改为 <code>192.168.244.2</code> 或其他地址不然就冲突了，网关设置为 <code>192.168.244.1</code> 指向 openwrt 路由器。</p><p>这时候使用主机访问 <code>192.168.244.1</code> 应该就可以进入 LuCl 界面了：<br><img src="../usr/uploads/2020/10/811268622.jpg" alt="28.jpg" title="28.jpg"></p><p>默认没有密码，可以使用 <code>passwd</code> 设置登录密码。</p><p>我们先给 openWrt 设置一个静态 wan 口 Ip，这样局域网设备就可以方便访问了。点击 network - interface：<br><img src="../usr/uploads/2020/10/1641305336.jpg" alt="32.jpg" title="32.jpg"></p><p>wan 口配置点击 edit：<br><img src="../usr/uploads/2020/10/2975940019.jpg" alt="33.jpg" title="33.jpg"></p><p>protocol 选择 static address，点击 switch protocol：<br><img src="../usr/uploads/2020/10/2765529412.jpg" alt="34.jpg" title="34.jpg"></p><p>设置本地局域网内的 IP 地址，网关地址和 DNS 地址，点击保存：<br><img src="../usr/uploads/2020/10/2870937409.jpg" alt="38.jpg" title="38.jpg"></p><p>点击 save：<br><img src="../usr/uploads/2020/10/366895487.jpg" alt="36.jpg" title="36.jpg"></p><h3>更换国内源</h3><p>由于虚拟机内不方便复制粘贴文本，我们使用 ssh 连接虚拟机：<br><img src="../usr/uploads/2020/10/2079947691.jpg" alt="37.jpg" title="37.jpg"></p><p>类似于 Debian，openWrt 也有包管理系统 <code>opkg</code>。默认都是国外源地址访问比较慢，可以替换为国内镜像地址，这里使用清华园镜像：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/openwrt/">https://mirrors.tuna.tsinghua.edu.cn/help/openwrt/</a></p><p>列表路径是：<code>/etc/opkg/</code>，有两个 conf 文件：<code>distfeeds.conf</code>, <code>customfeeds.conf</code></p><p>一键替换命令：</p><pre><code>sed -i 's_downloads.openwrt.org_mirrors.tuna.tsinghua.edu.cn/openwrt_' /etc/opkg/distfeeds.conf
</code></pre><p>更新列表：</p><pre><code>opkg update
</code></pre><p>安装常用工具：</p><pre><code>opkg install sudo bash git-http vim-full curl ca-certificates openssl-util ca-bundle libopenssl luci-ssl-openssl lsof wget ipset luci-i18n-base-zh-cn
</code></pre><p>虚拟机下可以安装 vmtools 来开启虚拟机管理等功能：</p><pre><code>opkg install open-vm-tools
</code></pre><p>如果需要进行透明代理，需要安装 iptables 和 tproxy 扩展：</p><pre><code>opkg install iptables iptables-mod-tproxy iptables-mod-extra iptables-nft iptables-mod-socket libcap
</code></pre><p>iptables 的操作教程参考：<a href="1872.html">https://blog.niekun.net/archives/1872.html</a></p><p>透明代理建议同时打开linux ipv4封包转发：</p><pre><code>sysctl -w net.ipv4.ip_forward=1
</code></pre><p>透明代理建议修改进程 Socket 句柄数：<a href="2572.html">https://blog.niekun.net/archives/2572.html</a></p><p>需要 sftp 连接系统的话需要安装支持包：</p><pre><code>opkg install openssh-sftp-server
</code></pre><p>如果安装了 openssh-sftp-server 就会在网络上声明此 sftp 服务的存在。</p><p>如果需要打开网络发现，这样其他设备就可以主动找到此服务器，可以安装扩展：</p><pre><code>opkg install announce
</code></pre><p>自带的 dnsmasq 是精简版的不支持一些高级语法，可以参考我的文章升级为 dnsmasq-full：<a href="1869.html">https://blog.niekun.net/archives/1869.html</a></p><p>如果从网络上直接下载 ipk 包，安装命令：</p><pre><code>opkg install test.ipk
</code></pre><h3>使用第三方源</h3><p><strong>使用第三方源步骤：</strong></p><ul><li>添加 第三方源 key 文件</li><li>源仓库地址加入 <code>/etc/opkg/customfeeds.conf</code> 文件</li><li>opkg update</li></ul><p>源仓库地址格式：</p><pre><code>src/gz example_feed_name http://www.example.com/path/to/files
</code></pre><p><strong>示例，加入第三方开发者 kuoruan 的源：</strong></p><p>添加 key：</p><pre><code>wget -O kuoruan-public.key http://openwrt.kuoruan.net/packages/public.key
opkg-key add kuoruan-public.key</code></pre><p>添加仓库地址到配置文件：</p><pre><code>echo &quot;src/gz kuoruan_packages http://openwrt.kuoruan.net/packages/releases/$(. /etc/openwrt_release ; echo $DISTRIB_ARCH)&quot; \
  &gt;&gt; /etc/opkg/customfeeds.conf

opkg update</code></pre><p>然后就可以安装第三方库的软件了，例如：</p><pre><code>opkg install v2ray-core
</code></pre><h3>更新软件包</h3><p>查看可更新包：</p><pre><code>opkg list-upgradable
</code></pre><p>更新某个包：</p><pre><code>opkg upgrade xxx
</code></pre><p>一键更新所有可更新的包：</p><pre><code>opkg update &amp;&amp; opkg list-upgradable | awk '{print $1}' | xargs -r opkg upgrade
</code></pre><p>一键更新软件脚本：<a href="https://github.com/tavinus/opkg-upgrade">https://github.com/tavinus/opkg-upgrade</a></p><h3>外网访问</h3><p>默认设置下，openwrt 会禁止 wan 网络对主机的 INPUT 和 FORWARD 流量，只会转发信息给其他设备。这样是为了安全因素。</p><p>如果需要通过 wan 口的网络访问 luci 管理页面，或者远程 ssh 访问 openwrt，就需要打开防火墙设置。如果要<strong>彻底关闭防火墙</strong>，可以进入 <strong>network - firewall - general settings</strong>，编辑下面的 <strong>zone</strong> 中的 <strong>wan</strong> 设置：<br><img src="../usr/uploads/2021/03/1813628993.png" alt="2021-03-30T08:41:16.png" title="2021-03-30T08:41:16.png"></p><p>将 input，output，forward 都设置为 accept：<br><img src="../usr/uploads/2021/03/926631505.png" alt="2021-03-30T08:42:14.png" title="2021-03-30T08:42:14.png"></p><p>这样就会完全开放网络的访问，也可以根据需要只开放指定的端口或服务。</p><p>这样就可以通过 wan 口访问 openwrt 本地服务了。但是为了安全期间，请设置强度高的 root 密码。</p><p>如果需要通过 frp 配置内网穿透访问 luci 页面，需要配置 uhttpd 并且取消强制 http 重定向 https，或者使用 frpc 的 plugin_http2https 插件。</p><p>具体参考：<br><a href="2278.html">openwrt 配置 LuCI ssl 证书</a><br><a href="539.html">使用 frp 实现内网穿透/远程管理/文件服务器</a></p><h3>参考链接：</h3><p><a href="https://openwrt.org/docs/guide-user/virtualization/vmware">https://openwrt.org/docs/guide-user/virtualization/vmware</a><br><a href="https://github.com/kuoruan/luci-app-v2ray">https://github.com/kuoruan/luci-app-v2ray</a></p>                <p itemprop="keywords">标签：无</p>
            </div>
        </article>

        <nav class="post-nav">
            <ul class="page-navigator">
                <li class="prev"><a href="1805.html" title="wsl 2 激活 systemd">wsl 2 激活 systemd</a></li>
                <li class="next"><a href="1863.html" title="iptables 使用教程">iptables 使用教程</a></li>
            </ul>
        </nav>

        <div id="comments">
        
            <div id="respond-post-1818" class="respond">
            <div class="cancel-comment-reply">
                <a id="cancel-comment-reply-link" href="1818.html#respond-post-1818" rel="nofollow" style="display:none" onclick="if (!window.__cfRLUnblockHandlers) return false; return TypechoComment.cancelReply();" data-cf-modified-2db3820e2eca976a510a049d-="">取消回复</a>            </div>

            <h5 id="response">你的评论</h5>

            <form method="post" action="https://blog.niekun.net/archives/1818.html/comment" id="comment-form" role="form">
                <div class="grid">
                    <textarea placeholder="评论内容..." rows="4" cols="300" name="text" id="textarea" required></textarea>
                </div>
                                <div class="grid">
                    <input type="text" placeholder="名字" name="author" id="author" value="" required/>
                    <input type="email" placeholder="Email" name="mail" id="mail" value="" required />
                    <input type="url" placeholder="http://网站（选填）" name="url" id="url" value="" />
                </div>
                                <button type="submit">提交评论</button>
            </form>
        </div>
    </div>
    </div>
</main>

<footer class="site-footer container-fluid">
    <div class="d-flex justify-content-between">
        <ul class="list-inline text-muted">
            <li>&copy; 2025 <a href="../index.html">Marco Nie</a></li>
            <li><a href="../feed/index.html">RSS</a></li>
        </ul>
        <ul class="list-inline text-muted">
            <li>
                Powered by <a href="https://typecho.org">Typecho</a>            </li>
        </ul>
    </div>
</footer>


<script src="../cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="2db3820e2eca976a510a049d-|49" defer></script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9281720eef5cb859',t:'MTc0MzI3MzEwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
