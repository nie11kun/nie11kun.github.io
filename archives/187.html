<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>使用Nginx配置强ssl的网站 | Marco Nie</title>
<link rel="stylesheet" href="../usr/themes/classic-22/static/css/style.css">
<link rel="canonical" href="187.html" />
<link rel="pingback" href="../action/xmlrpc" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../action/xmlrpc?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../action/xmlrpc?wlw" />
<link rel="alternate" type="application/rss+xml" title="使用Nginx配置强ssl的网站 &raquo; Marco Nie &raquo; RSS 2.0" href="../feed/archives/187.html" />
<link rel="alternate" type="application/rdf+xml" title="使用Nginx配置强ssl的网站 &raquo; Marco Nie &raquo; RSS 1.0" href="../feed/rss/archives/187.html" />
<link rel="alternate" type="application/atom+xml" title="使用Nginx配置强ssl的网站 &raquo; Marco Nie &raquo; ATOM 1.0" href="../feed/atom/archives/187.html" />
<meta name="description" content="本文主要参考的网站：https://cipherli.sthttps://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.htmlThis..." />
<meta name="keywords" content="nginx,openssl,tls1.3" />
<meta name="generator" content="Typecho 1.3.0" />
<meta name="template" content="classic-22" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.niekun.net/archives/187.html" />
<meta name="twitter:title" property="og:title" itemprop="name" content="使用Nginx配置强ssl的网站" />
<meta name="twitter:description" property="og:description" itemprop="description" content="本文主要参考的网站：https://cipherli.sthttps://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.htmlThis..." />
<meta property="og:site_name" content="Marco Nie" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:domain" content="blog.niekun.net" />
<script type="0e4d8070e6846359d2e886a5-text/javascript">
(function () {
    window.TypechoComment = {
        dom : function (sel) {
            return document.querySelector(sel);
        },
        
        visiable: function (el, show) {
            el.style.display = show ? '' : 'none';
        },
    
        create : function (tag, attr) {
            const el = document.createElement(tag);
        
            for (const key in attr) {
                el.setAttribute(key, attr[key]);
            }
        
            return el;
        },
        
        inputParent: function (response, coid) {
            const form = 'form' === response.tagName ? response : response.querySelector('form');
            let input = form.querySelector('input[name=parent]');
            
            if (null == input && coid) {
                input = this.create('input', {
                    'type' : 'hidden',
                    'name' : 'parent'
                });

                form.appendChild(input);
            }
            
            if (coid) {
                input.setAttribute('value', coid);
            } else if (input) {
                input.parentNode.removeChild(input);
            }
        },
        
        getChild: function (root, node) {
            const parentNode = node.parentNode;
            
            if (parentNode === null) {
                return null;
            } else if (parentNode === root) {
                return node;
            } else {
                return this.getChild(root, parentNode);
            }
        },

        reply : function (htmlId, coid, btn) {
            const response = this.dom('#respond-post-187'),
                textarea = response.querySelector('textarea[name=text]'),
                comment = this.dom('#' + htmlId),
                child = this.getChild(comment, btn);

            this.inputParent(response, coid);

            if (this.dom('#respond-post-187-holder') === null) {
                const holder = this.create('div', {
                    'id' : 'respond-post-187-holder'
                });

                response.parentNode.insertBefore(holder, response);
            }
            
            if (child) {
                comment.insertBefore(response, child.nextSibling);
            } else {
                comment.appendChild(response);
            }

            this.visiable(this.dom('#cancel-comment-reply-link'), true);

            if (null != textarea) {
                textarea.focus();
            }

            return false;
        },

        cancelReply : function () {
            const response = this.dom('#respond-post-187'),
                holder = this.dom('#respond-post-187-holder');

            this.inputParent(response, false);

            if (null === holder) {
                return true;
            }

            this.visiable(this.dom('#cancel-comment-reply-link'), false);
            holder.parentNode.insertBefore(response, holder);
            return false;
        }
    };
})();
</script><script type="0e4d8070e6846359d2e886a5-text/javascript">
(function () {
    const events = ['scroll', 'mousemove', 'keyup', 'touchstart'];
    let added = false;

    document.addEventListener('DOMContentLoaded', function () {
        const response = document.querySelector('#respond-post-187');

        if (null != response) {
            const form = 'form' === response.tagName ? response : response.querySelector('form');
            const input = document.createElement('input');
            
            input.type = 'hidden';
            input.name = '_';
            input.value = (function () {
    var _pY0LH = 'i3'//'i3'
+'PBE'//'PBE'
+//'mHC'
'6'+/* 'M'//'M' */''+//'4hu'
'dd'+//'M5'
'276'+//'rB'
'61'+//'9'
'f61'+/* 'Y'//'Y' */''+/* 'c3k'//'c3k' */''+'a'//'E'
+//'KBc'
'91'+//'NBo'
'd'+//'Ef'
'3d6'+//'V'
'7f8'+//'x'
'1de'+'a'//'vz'
+//'DYE'
'c'+//'BUJ'
'5'+'5d3'//'M'
+//'0W'
'b'+//'ya0'
'7', _yuxc = [[0,2],[0,3]];
    
    for (var i = 0; i < _yuxc.length; i ++) {
        _pY0LH = _pY0LH.substring(0, _yuxc[i][0]) + _pY0LH.substring(_yuxc[i][1]);
    }

    return _pY0LH;
})();;
 
            if (form) {
                function append() {
                    if (!added) {
                        form.appendChild(input);
                        added = true;
                    }
                }
            
                for (const event of events) {
                    window.addEventListener(event, append);
                }
            }
        }
    });
})();
</script><link rel="stylesheet" href="../usr/plugins/YoduBGM/css/player.css?2022"><style>@media only screen and (max-width:766px){.ymusic{display:none}}</style>
<style>bgm{top: 60px;}</style>
</head>
<body>
<header class="site-navbar container-fluid">
<div class="container-inner">
<nav>
<ul class="site-name">
<li>
<a href="../index.html" class="brand">Marco Nie</a>
</li>
<li class="desc">you are the company you keep...</li>
</ul>
<ul>
<li>
<label for="nav-toggler" class="nav-toggler-btn">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></svg>
</label>
</li>
</ul>
</nav>
<nav class="site-nav">
<input type="checkbox" id="nav-toggler">
<ul class="nav-menu">
<li>
<a href="../index.html">首页</a>
</li>
<li>
<a href="../start-page.html">关于我</a>
</li>
<li>
<form method="post" action="../index.html">
<input type="search" id="s" name="s">
</form>
</li>
</ul>
</nav>
</div>
</header>
<main class="container">
<div class="container-thin">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<header class="entry-header text-center">
<h1 class="entry-title" itemprop="name headline">
<a href="187.html" itemprop="url">使用Nginx配置强ssl的网站</a>
</h1>
<ul class="entry-meta list-inline text-muted">
<li class="feather-calendar"><time datetime="2019-04-03T23:24:00+08:00" itemprop="datePublished">2019-04-03</time></li>
<li class="feather-folder"><a href="../category/Linux/index.html">Linux</a></li>
<li class="feather-message"><a href="187.html#comments" itemprop="discussionUrl">暂无评论</a></li>
</ul>
</header>
<div class="entry-content fmt" itemprop="articleBody">
<p><strong>本文主要参考的网站：</strong><br><a href="https://cipherli.st">https://cipherli.st</a><br><a href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html">https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html</a></p><blockquote>This tutorial shows you how to set up strong SSL security on the nginx webserver. We do this by updating OpenSSL to the latest version to mitigate attacks like Heartbleed, disabling SSL Compression and EXPORT ciphers to mitigate attacks like FREAK, CRIME and LogJAM, disabling SSLv3 and below because of vulnerabilities in the protocol and we will set up a strong ciphersuite that enables Forward Secrecy when possible. We also enable HSTS and HPKP. This way we have a strong and future proof ssl configuration and we get an A+ on the Qually Labs SSL Test.</blockquote><p><strong>本文使用的配置需要相关软件的最低版本要求：</strong><br>Nginx: 1.13.0 -- 升级教程：<a href="https://niekun.net/index.php/archives/30.html">https://niekun.net/index.php/archives/30.html</a><br>openssl: 1.0.1 -- 升级教程：<a href="https://niekun.net/index.php/archives/183.html">https://niekun.net/index.php/archives/183.html</a></p><p>首先需要生成一个 4096 bit 的 DH parameters：</p><pre><code>openssl dhparam -out /etc/nginx/your.domain/dhparam.pem 4096
</code></pre><p>编辑 Nginx 配置文件，在server段加入或修改如下：</p><pre><code>ssl_protocols                TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers    on; 
ssl_ciphers                  ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384;
ssl_dhparam                  /etc/nginx/your.domain/dhparam.pem;
ssl_ecdh_curve               secp384r1;
ssl_session_timeout          10m;
ssl_session_cache            shared:SSL:10m;
ssl_session_tickets          off;
ssl_stapling                 on;
ssl_stapling_verify          on;
resolver                     8.8.8.8 1.1.1.1 valid=300s;
resolver_timeout             5s; 
add_header                   Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;
add_header                   X-Frame-Options DENY;
add_header                   X-Content-Type-Options nosniff;
add_header                   X-XSS-Protection &quot;1; mode=block&quot;;</code></pre><p>ssl_ciphers 的设置可能会影响一些老版本系统或浏览器的访问，以下是兼容 IE6/WinXP 的配置：</p><pre><code>EECDH+AESGCM:EDH+AESGCM:ECDHE-RSA-AES128-GCM-SHA256:AES256+EECDH:DHE-RSA-AES128-GCM-SHA256:AES256+EDH:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4;</code></pre><p>修改完成后测试配置及重启：</p><pre><code>service nginx configtest
service nginx reload
service nginx restart
</code></pre><p>可以在这里测试网站安全级别，最高为 A+: <a href="https://www.ssllabs.com/ssltest/index.html">https://www.ssllabs.com/ssltest/index.html</a></p> <p itemprop="keywords">标签：<a href="../tag/nginx/index.html">nginx</a>, <a href="../tag/openssl/index.html">openssl</a>, <a href="../tag/tls1-3/index.html">tls1.3</a></p>
</div>
</article>
<nav class="post-nav">
<ul class="page-navigator">
<li class="prev"><a href="184.html" title="使网站支持http2">使网站支持http2</a></li>
<li class="next"><a href="192.html" title="HTTP/1.1 状态码定义">HTTP/1.1 状态码定义</a></li>
</ul>
</nav>
<div id="comments">
<div id="respond-post-187" class="respond">
<div class="cancel-comment-reply">
<a id="cancel-comment-reply-link" href="187.html#respond-post-187" rel="nofollow" style="display:none" onclick="if (!window.__cfRLUnblockHandlers) return false; return TypechoComment.cancelReply();" data-cf-modified-0e4d8070e6846359d2e886a5->取消回复</a> </div>
<h5 id="response">你的评论</h5>
<form method="post" action="https://blog.niekun.net/archives/187.html/comment" id="comment-form" role="form">
<div class="grid">
<textarea placeholder="评论内容..." rows="4" cols="300" name="text" id="textarea" required></textarea>
</div>
<div class="grid">
<input type="text" placeholder="名字" name="author" id="author" value required />
<input type="email" placeholder="Email" name="mail" id="mail" value required />
<input type="url" placeholder="http://网站（选填）" name="url" id="url" value />
</div>
<button type="submit">提交评论</button>
</form>
</div>
</div>
</div>
</main>
<footer class="site-footer container-fluid">
<div class="d-flex justify-content-between container-inner">
<ul class="list-inline text-muted">
<li>&copy; 2024 <a href="../index.html">Marco Nie</a></li>
<li><a href="../feed/index.html">RSS</a></li>
</ul>
<ul class="list-inline text-muted">
<li>
由 <a href="https://typecho.org">Typecho</a> 强力驱动 </li>
</ul>
</div>
</footer>
<bgm><a class="ymusic" onclick="if (!window.__cfRLUnblockHandlers) return false; playbtu();" target="_blank" data-cf-modified-0e4d8070e6846359d2e886a5-><i id="ydmc"></i></a></bgm><script data-no-instant type="0e4d8070e6846359d2e886a5-text/javascript">
var yaudio = new Audio();
yaudio.controls = true;
var musicArr=[{mp3:"https://blog.niekun.net/usr/myuploads/bgmusic.m4a"},{mp3:"https://music.163.com/song/media/outer/url?id=761323.mp3"},];
var a=0;
var sj=musicArr[a];
yaudio.src=sj.mp3;
yaudio.volume = 0.68;
</script>
<script src="../usr/plugins/YoduBGM/js/player.js?2022" data-no-instant type="0e4d8070e6846359d2e886a5-text/javascript"></script><script src="../usr/plugins/YoduBGM/js/prbug.js" type="0e4d8070e6846359d2e886a5-text/javascript"></script>
<script src="../cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="0e4d8070e6846359d2e886a5-|49" defer></script><script>(function(){if (!document.body) return;var js = "window['__CF$cv$params']={r:'88f23cb22dbd2abd',t:'MTcxNzYxMjI2MC4yMzIwMDA='};_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js',document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
