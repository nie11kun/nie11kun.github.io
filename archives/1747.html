<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Linux 系统时间设置问题 - Marco Nie</title>
<link rel="icon" href="https://niekun.net/favicon.ico" sizes="192x192" />
<link href="../usr/themes/Single/static/kico.css" rel="stylesheet" type="text/css" />
<link href="../usr/themes/Single/static/single.css" rel="stylesheet" type="text/css" />
<link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1" />
<meta property="og:site_name" content="Marco Nie">
<meta property="og:title" content="Linux 系统时间设置问题" />
<meta name="description" content="昨天重装了 vps 系统，在设置 crontab 定时任务时发现并没有在指定的时间执行脚本。于是就进行排查问题。测试在 /etc/crontab 添加一条测试任务:30  10    *  * ..." />
<link rel="alternate" type="application/rss+xml" title="Linux 系统时间设置问题 &raquo; Marco Nie &raquo; RSS 2.0" href="../feed/archives/1747.html" />
<link rel="alternate" type="application/rdf+xml" title="Linux 系统时间设置问题 &raquo; Marco Nie &raquo; RSS 1.0" href="../feed/rss/archives/1747.html" />
<link rel="alternate" type="application/atom+xml" title="Linux 系统时间设置问题 &raquo; Marco Nie &raquo; ATOM 1.0" href="../feed/atom/archives/1747.html" />
<script type="8bb801a34fb02c9cb5be903b-text/javascript">
(function () {
    window.TypechoComment = {
        dom : function (id) {
            return document.getElementById(id);
        },
    
        create : function (tag, attr) {
            var el = document.createElement(tag);
        
            for (var key in attr) {
                el.setAttribute(key, attr[key]);
            }
        
            return el;
        },

        reply : function (cid, coid) {
            var comment = this.dom(cid), parent = comment.parentNode,
                response = this.dom('respond-post-1747'), input = this.dom('comment-parent'),
                form = 'form' == response.tagName ? response : response.getElementsByTagName('form')[0],
                textarea = response.getElementsByTagName('textarea')[0];

            if (null == input) {
                input = this.create('input', {
                    'type' : 'hidden',
                    'name' : 'parent',
                    'id'   : 'comment-parent'
                });

                form.appendChild(input);
            }

            input.setAttribute('value', coid);

            if (null == this.dom('comment-form-place-holder')) {
                var holder = this.create('div', {
                    'id' : 'comment-form-place-holder'
                });

                response.parentNode.insertBefore(holder, response);
            }

            comment.appendChild(response);
            this.dom('cancel-comment-reply-link').style.display = '';

            if (null != textarea && 'text' == textarea.name) {
                textarea.focus();
            }

            return false;
        },

        cancelReply : function () {
            var response = this.dom('respond-post-1747'),
            holder = this.dom('comment-form-place-holder'), input = this.dom('comment-parent');

            if (null != input) {
                input.parentNode.removeChild(input);
            }

            if (null == holder) {
                return true;
            }

            this.dom('cancel-comment-reply-link').style.display = 'none';
            holder.parentNode.insertBefore(response, holder);
            return false;
        }
    };
})();
</script>
<script type="8bb801a34fb02c9cb5be903b-text/javascript">
(function () {
    var event = document.addEventListener ? {
        add: 'addEventListener',
        triggers: ['scroll', 'mousemove', 'keyup', 'touchstart'],
        load: 'DOMContentLoaded'
    } : {
        add: 'attachEvent',
        triggers: ['onfocus', 'onmousemove', 'onkeyup', 'ontouchstart'],
        load: 'onload'
    }, added = false;

    document[event.add](event.load, function () {
        var r = document.getElementById('respond-post-1747'),
            input = document.createElement('input');
        input.type = 'hidden';
        input.name = '_';
        input.value = (function () {
    var _ErJv = '5c'//'L'
+'5'//'x3F'
+//'7Q'
'0b'+'8'//'Ms'
+'2a9'//'eAB'
+'30'//'55'
+'W'//'W'
+//'8'
'0'+//'N6e'
'c'+//'nAM'
'92'+'Y'//'Y'
+'va6'//'va6'
+//'WD'
'c2'+//'4'
'c02'+'3'//'Zeo'
+//'x'
'6e'+/* 'o'//'o' */''+//'fqL'
'37d'+'66'//'8xY'
+'094'//'sUy'
+''///*'UG'*/'UG'
+//'W7O'
'c', _tmsG760 = [[11,12],[15,16],[15,18]];
    
    for (var i = 0; i < _tmsG760.length; i ++) {
        _ErJv = _ErJv.substring(0, _tmsG760[i][0]) + _ErJv.substring(_tmsG760[i][1]);
    }

    return _ErJv;
})();

        if (null != r) {
            var forms = r.getElementsByTagName('form');
            if (forms.length > 0) {
                function append() {
                    if (!added) {
                        forms[0].appendChild(input);
                        added = true;
                    }
                }
            
                for (var i = 0; i < event.triggers.length; i ++) {
                    var trigger = event.triggers[i];
                    document[event.add](trigger, append);
                    window[event.add](trigger, append);
                }
            }
        }
    });
})();
</script><script async src='../cdn-cgi/challenge-platform/h/b/scripts/invisible.js'></script></head>
<body>
<header>
<div class="head-title">
<h4>Marco Nie</h4>
</div>
<div class="head-action">
<div class="toggle-btn"></div>
<div class="light-btn"></div>
<div class="search-btn"></div>
</div>
<form class="head-search" method="post">
<input type="text" name="s" placeholder="搜索什么？">
</form>
<nav class="head-menu">
<a href="../index.html">首页</a>
<div class="has-child">
<a>分类</a>
<div class="sub-menu">
<a href="../category/Linux/index.html">Linux</a><a href="../category/ubuntu/index.html">ubuntu</a><a href="../category/photo/index.html">Photograph</a><a href="../category/media/index.html">media process</a><a href="../category/ps/index.html">photoshop</a><a href="../category/fxp/index.html">final cut pro</a><a href="../category/lr/index.html">lightroom</a><a href="../category/c4d/index.html">cinema 4D</a><a href="../category/Windows/index.html">Windows</a><a href="../category/macos/index.html">macOS</a><a href="../category/hardware/index.html">hardware</a><a href="../category/router/index.html">router</a><a href="../category/a73/index.html">SONY A7M3</a><a href="../category/essay/index.html">essay</a><a href="../category/other/index.html">other</a><a href="../category/dev/index.html">Development</a><a href="../category/cpp/index.html">c++</a><a href="../category/py/index.html">python</a><a href="../category/go/index.html">go</a><a href="../category/siemens/index.html">siemens</a><a href="../category/web/index.html">web</a><a href="../category/html/index.html">html</a><a href="../category/css/index.html">css</a><a href="../category/js/index.html">javascript</a><a href="../category/node/index.html">node.js</a><a href="../category/react/index.html">react</a><a href="../category/software/index.html">software</a> </div>
</div>
<a href="../start-page.html">关于我</a> </nav>
</header>
<main>
<div class="wrap min">
<section class="post-title">
<h2>Linux 系统时间设置问题</h2>
<div class="post-meta">
<time class="date">2020-09-17</time>
<span class="category"><a href="../category/Linux/index.html">Linux</a></span>
<span class="comments">0</span>
</div>
</section>
<article class="post-content">
<blockquote>这篇文章上次修改于 510 天前，可能其部分内容已经发生变化，如有疑问可询问作者。</blockquote>
<p>昨天重装了 vps 系统，在设置 crontab 定时任务时发现并没有在指定的时间执行脚本。于是就进行排查问题。</p><p>测试在 <code>/etc/crontab</code> 添加一条测试任务:</p><pre><code>30  10    *  *  * root python -V &gt; /root/test.log
</code></pre><p>在 10：30 并没有看到 test.log 文件生成。</p><p>通过 <code>systemctl status cron</code> 查看信息：</p><pre><code>Sep 17 10:21:01 niekun-bandwagon CRON[946]: pam_unix(cron:session): session clos
Sep 17 10:29:01 niekun-bandwagon cron[451]: (*system*) RELOAD (/etc/crontab)</code></pre><p>在 10：29 crontab 脚本已经重新加载过了，但是并没有执行任务。</p><p>通过命令 <code>cat /var/log/syslog | grep cron</code> 查看系统日志：</p><pre><code>Sep 16 21:46:35 niekun-bandwagon cron[451]: (CRON) INFO (pidfile fd = 3)
Sep 16 21:46:35 niekun-bandwagon cron[451]: (CRON) INFO (Running @reboot jobs)
Sep 16 22:29:01 niekun-bandwagon cron[451]: (*system*) RELOAD (/etc/crontab)</code></pre><p>发现日志的时间比我当前时间晚了 12 个小时，会不会就是系统日期问题导致脚本没有达到设定的时间？</p><p>在按装新系统的后，使用 <code>date</code> 命令查看当前系统时间，发现时间是 UTC 时间，我通过 <code>tzselect</code> 命令设置了时区：</p><pre><code>[<a href="../cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b8cad7d7ccf8dcda95cbddcaceddca">[email&#160;protected]</a> ~]# tzselect 
Please identify a location so that time zone rules can be set correctly.
Please select a continent or ocean.
 1) Africa
 2) Americas
 3) Antarctica
 4) Arctic Ocean
 5) Asia
 6) Atlantic Ocean
 7) Australia
 8) Europe
 9) Indian Ocean
10) Pacific Ocean
11) none - I want to specify the time zone using the Posix TZ format.
#? 5
Please select a country.
 1) Afghanistan           18) Israel                35) Palestine
 2) Armenia               19) Japan                 36) Philippines
 3) Azerbaijan            20) Jordan                37) Qatar
 4) Bahrain               21) Kazakhstan            38) Russia
 5) Bangladesh            22) Korea (North)         39) Saudi Arabia
 6) Bhutan                23) Korea (South)         40) Singapore
 7) Brunei                24) Kuwait                41) Sri Lanka
 8) Cambodia              25) Kyrgyzstan            42) Syria
 9) China                 26) Laos                  43) Taiwan
10) Cyprus                27) Lebanon               44) Tajikistan
11) East Timor            28) Macau                 45) Thailand
12) Georgia               29) Malaysia              46) Turkmenistan
13) Hong Kong             30) Mongolia              47) United Arab Emirates
14) India                 31) Myanmar (Burma)       48) Uzbekistan
15) Indonesia             32) Nepal                 49) Vietnam
16) Iran                  33) Oman                  50) Yemen
17) Iraq                  34) Pakistan
#? 9
Please select one of the following time zone regions.
1) east China - Beijing, Guangdong, Shanghai, etc.
2) Heilongjiang (except Mohe), Jilin
3) central China - Sichuan, Yunnan, Guangxi, Shaanxi, Guizhou, etc.
4) most of Tibet &amp; Xinjiang
5) west Tibet &amp; Xinjiang
#? 1
 
The following information has been given:
 
        China
        east China - Beijing, Guangdong, Shanghai, etc.
 
Therefore TZ='Asia/Shanghai' will be used.
Local time is now:      Sun Jan 11 23:31:51 CST 2015.
Universal Time is now:  Sun Jan 11 15:31:51 UTC 2015.
Is the above information OK?
1) Yes
2) No
#? yes
Please enter 1 for Yes, or 2 for No.
#? 1
 
You can make this change permanent for yourself by appending the line
        TZ='Asia/Shanghai'; export TZ
to the file '.profile' in your home directory; then log out and log in again.
 
Here is that TZ value again, this time on standard output so that you
can use the /usr/bin/tzselect command in shell scripts:
Asia/Shanghai</code></pre><p>将 <code>TZ='Asia/Shanghai'; export TZ</code> 写入 <code>~/.profile</code>，并刷新文件：</p><pre><code>source .bash_profile</code></pre><p>测试当前系统时间：</p><pre><code><a href="../cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="41332e2e35012f28242a342f6c23202f253620262e2f">[email&#160;protected]</a>:~# date
Thu Sep 17 10:44:00 CST 2020
</code></pre><p>但是系统日志记录的时间还是不对，这就可能还是时区不对，手动复制亚洲时区文件到目录：</p><pre><code>cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</code></pre><p>更新 rsyslog 进程：</p><pre><code>systemctl restart rsyslog
</code></pre><p>再次测试发现系统日志时间对了，crontab 脚本也可以正确执行。</p><p>也可以使用 timedatectl 命令设置时区：</p><pre><code># 查看当前时区设置
$ timedatectl

# 显示所有可用的时区
$ timedatectl list-timezones                                                                                   

# 设置当前时区
$ sudo timedatectl set-timezone Asia/Shanghai</code></pre> </article>
<section class="post-near">
<ul>
<li>上一篇: <a href="1720.html" title="自由填充 Pattern in Photoshop">自由填充 Pattern in Photoshop</a></li>
<li>下一篇: <a href="1752.html" title="FFmpeg 简单用法">FFmpeg 简单用法</a></li>
</ul>
</section>
<section class="post-comments">
<h3>没有评论</h3>
<div class="comment-form" id="respond-post-1747">
<span class="cancel-comment-reply">
<a id="cancel-comment-reply-link" href="1747.html#respond-post-1747" rel="nofollow" style="display:none" onclick="if (!window.__cfRLUnblockHandlers) return false; return TypechoComment.cancelReply();" data-cf-modified-8bb801a34fb02c9cb5be903b-="">取消回复</a> </span>
<form method="post" action="https://blog.niekun.net/archives/1747.html/comment" role="form">
<div class="row">
<fieldset class="col-m-6">
<input type="text" name="author" placeholder="昵称 *：" value="" required>
<input type="email" name="mail" placeholder="电邮 *：" value="" required>
<input type="url" name="url" placeholder="http://" value="">
</fieldset>
<fieldset class="col-m-6">
<textarea rows="3" name="text" id="textarea" placeholder="快来评论吧 (*≧ω≦)ﾉ" required></textarea>
<button type="submit" class="btn">写好了~</button>
</fieldset>
</div>
</form>
</div>
</section> </div>
</main>
<footer>
<div class="buttons">
<a class="to-top" href="1747.html#"></a>
</div>
<div class="wrap min">
<section class="widget">
<div class="row">
<div class="col-m-4">
<h3 class="title-recent">最新文章：</h3>
<ul>
<li><a href="2403.html" target="_blank">macOS 中给 finder 添加右键打开 vs code 选项</a></li><li><a href="2388.html" target="_blank">获取 JD cookie 方法</a></li><li><a href="2375.html" target="_blank">升级 Xcode 后 QT 编译报错 No rule to make target 解决方法</a></li><li><a href="2353.html" target="_blank">使用 OpenCore Legacy Patcher 为 2015 款 MacBook Pro 激活 AirPlay</a></li><li><a href="2352.html" target="_blank">常用校验类正则表达式大全</a></li><li><a href="2348.html" target="_blank">PT 下载时停留在 99% 问题处理</a></li> </ul>
</div>
<div class="col-m-4">
<h3 class="title-date">时光机：</h3>
<ul>
<li><a href="../2022/01/index.html" rel="nofollow" target="_blank">2022 年 01 月</a></li><li><a href="../2021/12/index.html" rel="nofollow" target="_blank">2021 年 12 月</a></li><li><a href="../2021/11/index.html" rel="nofollow" target="_blank">2021 年 11 月</a></li><li><a href="../2021/10/index.html" rel="nofollow" target="_blank">2021 年 10 月</a></li><li><a href="../2021/09/index.html" rel="nofollow" target="_blank">2021 年 09 月</a></li><li><a href="../2021/08/index.html" rel="nofollow" target="_blank">2021 年 08 月</a></li> </ul>
</div>
<div class="col-m-4">
<h3 class="title-comments">最近评论：</h3>
<ul>
<li>marco nie: <a href="349.html#comment-43" rel="nofollow" target="_blank">好久没看，回顾一下</a></li>
<li>Marc: <a href="../start-page.html#comment-42" rel="nofollow" target="_blank">Hi Marc...</a></li>
<li>admin: <a href="1640.html#comment-41" rel="nofollow" target="_blank">paralle...</a></li>
<li>unswimmingfish: <a href="1640.html#comment-40" rel="nofollow" target="_blank">macbook...</a></li>
<li>marco nie: <a href="1680.html#comment-39" rel="nofollow" target="_blank">给一个文件添加...</a></li>
<li>ch: <a href="1680.html#comment-38" rel="nofollow" target="_blank">你好我想请问一...</a></li>
</ul>
</div>
</div>
</section>
<section class="sub-footer">
<p>© 2022 <a href="../index.html">Marco Nie</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Single" target="_blank" rel="nofollow">Single</a>.</p>
</section>
</div>
</footer>
<script data-cfasync="false" src="../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="../usr/themes/Single/static/kico.js" type="8bb801a34fb02c9cb5be903b-text/javascript"></script>
<script src="../usr/themes/Single/static/single.js" type="8bb801a34fb02c9cb5be903b-text/javascript"></script>
<script src="../usr/themes/Single/static/prism.js" type="8bb801a34fb02c9cb5be903b-text/javascript"></script>
<script type="8bb801a34fb02c9cb5be903b-text/javascript">var single = new Paul_Single({copyright: false, night: true});</script>
<script src="../cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="8bb801a34fb02c9cb5be903b-|49" defer=""></script><script type="text/javascript">(function(){window['__CF$cv$params']={r:'6daf2b6e2fc47b25',m:'BwLo.GuLkMWjAX8gD74rCDJn5BoYERaIa4l3yjEWltw-1644431434-0-AYLEitC++JtwuPBHIxiXratOmhoow1d6X+9DNnfY2BbDwdf4yMsV6dmmvCkRBUe+xhRcQsQsQKftaYcxfMdEksbXRR5w/uYjxrpxH2jj8GjhJtqCN0alylLIkdRFxyKW2MgXxJHO18GMZ+U0f9od69g=',s:[0x5a9556a840,0x57624e8625],u:'/cdn-cgi/challenge-platform/h/b'}})();</script></body>
</html>